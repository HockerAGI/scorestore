[build]
  publish = "."
  command = "npm run build"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "20"

[functions]
  node_bundler = "esbuild"
  included_files = ["data/**"]

# -----------------------
# CACHE: HTML corto, assets largos, JS/CSS razonable
# SW + manifest sin cache
# -----------------------

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=300"

[[headers]]
  for = "/"
  [headers.values]
    Cache-Control = "public, max-age=300"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# ✅ JS/CSS: NO immutable si NO versionas el archivo en el HTML
[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# Catálogo y promos: NO cache (siempre fresco)
[[headers]]
  for = "/data/*"
  [headers.values]
    Cache-Control = "no-store"

# PWA críticos: no cache para que actualice rápido
[[headers]]
  for = "/sw.js"
  [headers.values]
    Cache-Control = "no-store"

[[headers]]
  for = "/site.webmanifest"
  [headers.values]
    Cache-Control = "no-store"

# -----------------------
# Redirects (alineado a tu main.js fallbacks /api/*)
# -----------------------
[[redirects]]
  from = "/api/checkout"
  to = "/.netlify/functions/create_checkout"
  status = 200

[[redirects]]
  from = "/api/quote"
  to = "/.netlify/functions/quote_shipping"
  status = 200

[[redirects]]
  from = "/api/webhook"
  to = "/.netlify/functions/stripe_webhook"
  status = 200

[[redirects]]
  from = "/api/chat"
  to = "/.netlify/functions/chat"
  status = 200