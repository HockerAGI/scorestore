<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#E10600" />
  <title>SCORE | Official Baja Gear</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root{
      --red: #E10600;
      /* Paleta "Desert Ops" */
      --carbon: #1a1a1a;
      --charcoal: #262626;
      --sand: #f0f0f0;
      /* üî• AJUSTE: M√°s transparencia para que se vea el fondo (0.60) */
      --brown-glass: rgba(60, 45, 35, 0.60); 
      
      --fontTitle: "Teko", sans-serif;
      --fontBody: "Inter", sans-serif;
      
      --bgTexture: url("assets/baja1000-texture.png"); 
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    
    body{
      margin:0; font-family: var(--fontBody);
      color: #111; 
      background-color: var(--sand);
      overflow-x:hidden;
      padding-bottom: 90px;
    }

    body::before {
      content: ""; position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.005' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)' opacity='.05'/%3E%3C/svg%3E");
      z-index: -2; pointer-events: none; mix-blend-mode: multiply;
    }

    .wrap{
      width: min(1200px, 94vw); margin: 0 auto;
      padding-top: 90px; padding-bottom: 60px;
    }

    /* === NAVBAR === */
    .topbar{
      position: fixed; top:0; left:0; right:0; z-index: 90;
      background: rgba(245,245,245,0.96);
      border-bottom: 3px solid var(--red);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .topInner{
      width: min(1200px, 94vw); margin: 0 auto; height: 75px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .brandLogo img{ height:55px; display:block; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }

    .navRight{ display:flex; align-items:center; gap:15px; }
    
    .cartTrigger{
      position: relative;
      background: var(--carbon); color: #fff; border: none;
      height: 46px; padding: 0 18px;
      display: flex; align-items: center; gap: 10px;
      font-family: var(--fontTitle); font-weight: 700; font-size: 22px;
      clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
      cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .cartIconImg{ width:28px; height:28px; filter: invert(1); object-fit:contain; }
    .cartCount{
      position: absolute; top: 4px; right: 4px;
      background: var(--red); color:#fff; font-size: 11px; padding: 2px 6px; border-radius: 4px;
      line-height: 1;
    }

    /* === HERO === */
    .hero{
      position: relative; border-radius: 12px; overflow: hidden;
      min-height: 540px; display: flex; align-items: center;
      background: var(--carbon); color: #fff;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    .heroBg{
      position: absolute; inset: 0;
      background: url('assets/hero.png') center/cover no-repeat;
      opacity: 0.95;
    }
    .heroOverlay{
      position: absolute; inset:0;
      background: linear-gradient(to right, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 60%, transparent 100%);
    }
    .heroContent{
      position: relative; z-index: 2; padding: 40px; max-width: 650px;
    }
    .heroTag{
      background: var(--red); color: #fff; padding: 4px 14px;
      font-family: var(--fontTitle); font-size: 22px; font-weight: 700;
      transform: skew(-10deg); display: inline-block; margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .heroTitle{
      font-family: var(--fontTitle); font-size: 85px; line-height: 0.85; margin: 0 0 20px;
      text-transform: uppercase; text-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .heroTitle span{ color: var(--red); }
    .heroSub{
      font-size: 17px; line-height: 1.5; color: #ddd; margin-bottom: 30px;
      border-left: 4px solid var(--red); padding-left: 20px; font-weight:500;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }
    .btnHero{
      background: #fff; color: var(--carbon); border: none;
      padding: 14px 35px; font-family: var(--fontTitle); font-size: 26px; font-weight: 700;
      cursor: pointer; clip-path: polygon(0 0, 100% 0, 95% 100%, 0% 100%);
      transition: transform 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    .btnHero:hover{ transform: translateY(-2px); }

    @media (max-width: 768px){
      .hero{ align-items: flex-end; min-height: 480px; }
      .heroOverlay{ background: linear-gradient(to top, rgba(0,0,0,0.95) 15%, rgba(0,0,0,0.2) 70%, transparent 100%); }
      .heroTitle{ font-size: 55px; }
      .heroContent{ padding: 25px; width: 100%; }
    }

    /* === GRID EDICIONES === */
    .secHeader{
      display: flex; align-items: baseline; justify-content: space-between;
      margin: 60px 0 25px; border-bottom: 2px solid #ccc; padding-bottom: 10px;
    }
    .secTitle{ font-family: var(--fontTitle); font-size: 42px; color: var(--carbon); }
    .secMeta{ font-weight: 700; color: #888; letter-spacing: 1px; }
    
    .gridDrops{ display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }

    /* TARJETA EDICI√ìN MEJORADA */
    .cardDrop{
      position: relative; height: 300px; border-radius: 10px; overflow: hidden;
      cursor: pointer; transition: transform 0.3s;
      background: var(--charcoal);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      border: 1px solid rgba(0,0,0,0.05);
    }
    .cardDrop:hover{ transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }

    .dropBg{
      position: absolute; inset: 0;
      background-image: var(--bgTexture); /* TEXTURA */
      background-size: cover; background-position: center;
      /* Filtro T√°ctico: Tono tierra/polvo oscuro */
      filter: brightness(0.6) sepia(0.25) contrast(1.15); 
      transition: 0.5s;
    }
    .cardDrop:hover .dropBg{ transform: scale(1.05); filter: brightness(0.75); }

    /* FONDO CAF√â TRANSPARENTE (Logos) */
    .dropGlass{
      position: absolute; inset: 15px;
      background: var(--brown-glass); 
      backdrop-filter: blur(4px); /* Blur un poco menor para ver textura */
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px; padding: 25px;
      display: flex; flex-direction: column; justify-content: space-between; align-items: center;
    }

    /* üî• LOGOS CON CONTORNO S√ìLIDO */
    .dropLogo{ 
      height: 90px; width: auto; object-fit: contain; 
      /* Truco CSS para borde blanco s√≥lido */
      filter: 
        drop-shadow(1px 1px 0 white) 
        drop-shadow(-1px 1px 0 white) 
        drop-shadow(1px -1px 0 white) 
        drop-shadow(-1px -1px 0 white);
    }
    
    .dropInfo{ width: 100%; text-align: center; border-top: 1px solid rgba(255,255,255,0.15); padding-top: 15px; }
    .dropInfo h3{ color: #fff; font-size: 34px; line-height: 0.9; margin: 0; letter-spacing: 1px; }
    .dropInfo p{ color: #e0e0e0; font-size: 13px; font-weight: 600; margin: 6px 0 0; text-transform: uppercase; }

    .btnDrop{
      margin-top: 12px; background: transparent; color: #fff; 
      border: 2px solid rgba(255,255,255,0.7);
      padding: 10px 24px; font-weight: 800; font-size: 14px; text-transform: uppercase;
      cursor: pointer; transition: 0.2s;
    }
    .btnDrop:hover{ background: #fff; color: #000; border-color: #fff; }

    .statusBadge{
      position: absolute; top: 12px; left: 12px;
      background: var(--red); color: #fff; font-weight: 800; font-size: 11px; 
      padding: 5px 10px; border-radius: 4px; letter-spacing: 1px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    /* === SPONSORS === */
    .sponsors{
      margin-top: 80px; padding: 40px 0; border-top: 1px solid #ddd;
      text-align: center; opacity: 0.7;
    }
    .spGrid{ display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; margin-top: 25px; }
    .spLogo{ height: 45px; filter: grayscale(1); transition: 0.3s; opacity: 0.7; }
    .spLogo:hover{ filter: grayscale(0); opacity: 1; }

    /* === FOOTER === */
    footer{
      background: var(--charcoal); color: #ccc; padding: 60px 20px 100px;
      border-top: 4px solid var(--red); margin-top: 0;
    }
    .footGrid{
      width: min(1200px, 94vw); margin: 0 auto;
      display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
    }
    @media(max-width:700px){ .footGrid{ grid-template-columns: 1fr; } }
    
    .footTitle{ font-family: var(--fontTitle); font-size: 26px; color: #fff; margin-bottom: 20px; }
    .footText{ line-height: 1.6; font-size: 14px; color: #aaa; }
    
    .fLink{ 
      display: block; color: #999; text-decoration: none; margin-bottom: 8px; 
      font-size: 13px; cursor: pointer; transition: 0.2s; border-bottom: 1px solid transparent; width: fit-content;
    }
    .fLink:hover{ color: #fff; border-color: var(--red); }

    /* === MODAL PRODUCTOS (FULL SCREEN) === */
    .prodModal{
      position: fixed; inset: 0; z-index: 2000;
      background: var(--white-off);
      display: flex; flex-direction: column;
      transform: translateY(100%); transition: transform 0.35s ease-out;
    }
    .prodModal.active{ transform: translateY(0); }

    .pmHead{
      background: var(--carbon); color: #fff; padding: 15px 20px;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 4px solid var(--red); box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .pmTitle{ font-size: 26px; }
    .pmClose{ background: none; border: none; color: #fff; font-size: 32px; cursor: pointer; }

    .pmBody{ flex: 1; overflow-y: auto; padding: 20px; }
    
    .pmGrid{
      display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px;
      max-width: 1000px; margin: 0 auto;
    }

    /* Tarjeta Producto */
    .pCard{
      background: #fff; border-radius: 8px; overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08); transition: 0.2s;
    }
    .pImg{ height: 220px; background: #e5e5e5; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .pImg img{ width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
    .pCard:hover .pImg img{ transform: scale(1.05); }
    
    .pInfo{ padding: 15px; text-align: center; }
    .pName{ font-weight: 800; font-size: 13px; text-transform: uppercase; margin-bottom: 5px; color: #333; }
    .pPrice{ font-family: var(--fontTitle); font-size: 24px; color: var(--red); font-weight: 600; }
    .pBtn{
      width: 100%; margin-top: 10px; background: var(--carbon); color: #fff; border: none;
      padding: 12px; font-weight: 700; font-size: 13px; text-transform: uppercase;
      cursor: pointer; transition: 0.2s;
    }
    .pBtn:hover{ background: var(--red); }

    /* === STICKY PAYBAR === */
    .paybar{
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 1500;
      background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
      border-top: 1px solid #ddd; padding: 15px 20px;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
      display: flex; justify-content: space-between; align-items: center;
      transform: translateY(100%); transition: transform 0.3s;
    }
    .paybar.visible{ transform: translateY(0); }
    
    .pbTotal{ font-size: 12px; color: #666; font-weight: 700; text-transform: uppercase; }
    .pbPrice{ display: block; font-family: var(--fontTitle); font-size: 32px; color: var(--carbon); line-height: 0.9; }
    
    .pbBtn{
      background: var(--red); color: #fff; border: none;
      padding: 12px 30px; font-family: var(--fontTitle); font-size: 24px; font-weight: 700;
      text-transform: uppercase; cursor: pointer; clip-path: polygon(5% 0, 100% 0, 95% 100%, 0% 100%);
    }

    /* === DRAWER CARRITO === */
    .overlay{ position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1900; display: none; }
    .overlay.active{ display: block; }

    .drawer{
      position: fixed; right: 0; top: 0; bottom: 0;
      width: 90vw; max-width: 420px;
      background: #fff; z-index: 2000; transform: translateX(100%); transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: flex; flex-direction: column;
    }
    .drawer.active{ transform: translateX(0); }
    
    .dHead{ background: var(--carbon); color: #fff; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
    .dTitle{ font-family: var(--fontTitle); font-size: 26px; margin: 0; }
    
    .dBody{ flex: 1; overflow-y: auto; padding: 20px; background: #f4f4f4; }
    .cartEmpty{ text-align: center; color: #888; margin-top: 50px; font-weight: 700; }
    
    .cItem{ background: #fff; padding: 10px; border-radius: 6px; display: flex; gap: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .cImg{ width: 70px; height: 70px; background: #eee; object-fit: cover; border-radius: 4px; }
    
    .dFoot{ padding: 20px; background: #fff; border-top: 1px solid #ddd; }
    .dfBtn{ width: 100%; background: var(--carbon); color: #fff; padding: 16px; border: none; font-weight: 800; font-size: 18px; cursor: pointer; clip-path: polygon(2% 0, 100% 0, 98% 100%, 0% 100%); }
    
    .clearLink{ display: block; text-align: center; margin-top: 15px; color: #999; font-size: 12px; font-weight: 700; text-decoration: underline; cursor: pointer; }

    /* Modal Legal Simple */
    .legalBox{ position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; background: #fff; padding: 30px; border-radius: 12px; z-index: 2100; display: none; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .legalBox.active{ display: block; }
  </style>
</head>

<body>
  <div class="overlay" id="globalOverlay"></div>

  <aside class="drawer" id="cartDrawer">
    <div class="dHead">
      <h3 class="dTitle">TU EQUIPO</h3>
      <button class="pmClose" onclick="toggleCart()" style="font-size:28px">&times;</button>
    </div>
    <div class="dBody" id="cartBody">
      <div class="cartEmpty">CARRITO VAC√çO</div>
    </div>
    <div class="dFoot">
      <div class="sumRow"><span>Total:</span><span id="drawerTotal">$0.00</span></div>
      <button class="dfBtn" onclick="goCheckout()">IR A PAGAR</button>
      <a class="clearLink" onclick="clearCart()">Vaciar Carrito</a>
    </div>
  </aside>

  <header class="topbar">
    <div class="topInner">
      <a href="#" class="brandLogo">
        <img src="assets/logo-score.png" alt="SCORE">
      </a>
      <div class="navRight">
        <div class="miniPill">ENV√çOS MX</div>
        <button class="cartTrigger" onclick="toggleCart()">
          <img src="assets/Icono-carrito-compra.png" class="cartIconImg" alt="Cart">
          <span class="cartCount" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="heroBg"></div>
      <div class="heroOverlay"></div>
      <div class="heroContent">
        <div class="heroTag">OFFICIAL GEAR</div>
        <h1 class="heroTitle">LEYENDAS<br><span>DEL DESIERTO</span></h1>
        <p class="heroSub">Colecci√≥n oficial inspirada en la brutalidad de la Baja. Ediciones limitadas disponibles ahora.</p>
        <button class="btnHero" onclick="openProductModal('b1000')">VER DROPS</button>
      </div>
    </section>

    <div class="secHeader">
      <h2 class="secTitle">ACTIVE DROPS</h2>
      <span class="secMeta">2024-25 SERIES</span>
    </div>

    <div class="gridDrops">
      <div class="cardDrop" onclick="openProductModal('b1000')">
        <div class="dropBg"></div>
        <div class="dropGlass">
          <div class="statusBadge">ACTIVO</div>
          <img src="assets/logo-baja1000.png" class="dropLogo" alt="Baja 1000">
          <div class="dropInfo">
            <h3>BAJA 1000</h3>
            <p>La carrera madre. Colecci√≥n completa.</p>
            <button class="btnDrop">VER PRODUCTOS</button>
          </div>
        </div>
      </div>

      <div class="cardDrop">
        <div class="dropBg"></div>
        <div class="dropGlass" style="background:rgba(50,35,25,0.95)">
          <img src="assets/logo-sf250.png" class="dropLogo" style="opacity:0.7" alt="SF250">
          <div class="dropInfo">
            <h3 style="color:#ccc">PR√ìXIMAMENTE</h3>
            <p>San Felipe 250</p>
          </div>
        </div>
      </div>

      <div class="cardDrop">
        <div class="dropBg"></div>
        <div class="dropGlass" style="background:rgba(50,35,25,0.95)">
          <img src="assets/logo-baja500.png" class="dropLogo" style="opacity:0.7" alt="B500">
          <div class="dropInfo">
            <h3 style="color:#ccc">PR√ìXIMAMENTE</h3>
            <p>Baja 500</p>
          </div>
        </div>
      </div>
    </div>

    <section class="sponsors">
      <div style="font-family:var(--fontTitle); font-size:20px; color:#999; margin-bottom:20px; letter-spacing:2px;">OFFICIAL PARTNERS</div>
      <div class="spGrid">
        <img src="assets/logo-bfgoodrich.png" class="spLogo" alt="BFGoodrich" onerror="this.style.display='none'">
        <img src="assets/logo-monster.png" class="spLogo" alt="Monster" onerror="this.style.display='none'">
        <img src="assets/logo-ford.png" class="spLogo" alt="Ford" onerror="this.style.display='none'">
        <img src="assets/logo-king.png" class="spLogo" alt="King" onerror="this.style.display='none'">
        <img src="assets/logo-polaris.png" class="spLogo" alt="Polaris" onerror="this.style.display='none'">
      </div>
    </section>
  </main>

  <footer>
    <div class="footGrid">
      <div>
        <h4 class="footTitle">SCORE INTERNATIONAL</h4>
        <p class="footText">
          Operado por <b>Unico Textil</b>.<br>
          Tijuana, B.C. M√©xico.<br><br>
          ventas.unicotextil@gmail.com<br>
          WhatsApp: 664 236 8701
        </p>
      </div>
      <div>
        <h4 class="footTitle">LEGAL</h4>
        <div>
          <span class="fLink" onclick="showLegal('terms')">T√©rminos</span>
          <span class="fLink" onclick="showLegal('privacy')">Privacidad</span>
          <span class="fLink" onclick="showLegal('returns')">Devoluciones</span>
          <span class="fLink" onclick="showLegal('fiscal')">Facturaci√≥n</span>
        </div>
      </div>
    </div>
  </footer>

  <div class="paybar" id="paybar">
    <div>
      <div class="pbTotal">TOTAL</div>
      <div class="pbPrice" id="pbTotal">$0.00</div>
    </div>
    <button class="pbBtn" onclick="toggleCart()">VER CARRITO</button>
  </div>

  <div class="prodModal" id="pmB1000">
    <div class="pmHead">
      <div class="pmTitle">COLECCI√ìN BAJA 1000</div>
      <button class="pmClose" onclick="closeProductModal()">&times;</button>
    </div>
    <div class="pmBody">
      <div class="pmGrid">
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/chamarra-baja1000.jpg"></div>
          <div class="pInfo">
            <div class="pName">Chamarra Oficial</div>
            <div class="pPrice">$1,490 MXN</div>
            <button class="pBtn" onclick="add('chamarra-baja1000')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/camisa-pits-baja1000.jpg"></div>
          <div class="pInfo">
            <div class="pName">Camisa de Pits</div>
            <div class="pPrice">$899 MXN</div>
            <button class="pBtn" onclick="add('camisa-pits-baja1000')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/camiseta-baja1000-azul.jpg"></div>
          <div class="pInfo">
            <div class="pName">Camiseta Mapa Azul</div>
            <div class="pPrice">$399 MXN</div>
            <button class="pBtn" onclick="add('camiseta-baja1000-azul')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/camiseta-baja1000-cafe.jpg"></div>
          <div class="pInfo">
            <div class="pName">Camiseta Mapa Caf√©</div>
            <div class="pPrice">$399 MXN</div>
            <button class="pBtn" onclick="add('camiseta-baja1000-cafe')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/camiseta-baja1000-negra.jpg"></div>
          <div class="pInfo">
            <div class="pName">Camiseta Mapa Negra</div>
            <div class="pPrice">$399 MXN</div>
            <button class="pBtn" onclick="add('camiseta-baja1000-negra')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/sudadera-world-desert-negra.jpg"></div>
          <div class="pInfo">
            <div class="pName">Sudadera World Desert Negra</div>
            <div class="pPrice">$749 MXN</div>
            <button class="pBtn" onclick="add('sudadera-world-desert-negra')">AGREGAR</button>
          </div>
        </div>
        <div class="pCard">
          <div class="pImg"><img src="assets/EDICION_2025/sudadera-world-desert-cafe.jpg"></div>
          <div class="pInfo">
            <div class="pName">Sudadera World Desert Caf√©</div>
            <div class="pPrice">$749 MXN</div>
            <button class="pBtn" onclick="add('sudadera-world-desert-cafe')">AGREGAR</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="legalBox" id="legalBox">
    <h3 id="lbTitle" style="margin-top:0; color:var(--red);"></h3>
    <p id="lbBody" style="font-size:13px; line-height:1.5; color:#333;"></p>
    <button onclick="closeOverlay()" style="background:#000; color:#fff; border:none; padding:10px; width:100%; cursor:pointer; font-weight:800; margin-top:15px;">CERRAR</button>
  </div>

  <script>
    const STRIPE_PK = 'pk_live_51Se6fsGUCnsKfgrBl99sVAcl';
    const API_URL = '/.netlify/functions/create_checkout';
    
    let cart = JSON.parse(localStorage.getItem('score_cart')) || [];
    let CATALOG = [];

    // Cargar cat√°logo desde JSON real
    async function loadCatalog() {
      try {
        const res = await fetch('data/catalog.json');
        const data = await res.json();
        CATALOG = data.products;
      } catch (e) { console.error("Error loading catalog", e); }
    }

    const overlay = document.getElementById('globalOverlay');
    const drawer = document.getElementById('cartDrawer');
    const legal = document.getElementById('legalBox');
    const pb = document.getElementById('paybar');

    function closeOverlay(){
      overlay.classList.remove('active');
      drawer.classList.remove('active');
      legal.classList.remove('active');
    }
    overlay.addEventListener('click', closeOverlay);

    function openProductModal(id){
      if(id === 'b1000') document.getElementById('pmB1000').classList.add('active');
    }
    function closeProductModal(){
      document.querySelectorAll('.prodModal').forEach(el => el.classList.remove('active'));
    }

    function toggleCart(){
      if(drawer.classList.contains('active')) closeOverlay();
      else {
        overlay.classList.add('active');
        drawer.classList.add('active');
      }
    }

    function add(id){
      if (!CATALOG.length) {
        // Fallback si no ha cargado JSON, usando datos hardcodeados en HTML
        const btn = document.querySelector(`button[onclick="add('${id}')"]`);
        const pCard = btn.closest('.pCard');
        const name = pCard.querySelector('.pName').innerText;
        const priceStr = pCard.querySelector('.pPrice').innerText;
        const price = parseInt(priceStr.replace(/[^0-9]/g, ''));
        const img = pCard.querySelector('img').src;
        
        const exist = cart.find(i => i.id === id);
        if(exist) exist.qty++;
        else cart.push({id, name, price, img, qty:1});
      } else {
        const p = CATALOG.find(x => x.id === id);
        const exist = cart.find(i => i.id === id);
        if(exist) exist.qty++;
        else {
          // Precios calculados: Base + Markup (20%) - Discount (10%)
          const price = Math.round(p.baseMXN * 1.2 * 0.9);
          cart.push({
            id: p.id, 
            name: p.name, 
            price: price, 
            img: p.img, 
            qty: 1
          });
        }
      }
      updateCart();
      alert("Agregado al carrito");
    }

    function updateCart(){
      localStorage.setItem('score_cart', JSON.stringify(cart));
      
      const total = cart.reduce((a,b)=>a+(b.price*b.qty),0);
      const count = cart.reduce((a,b)=>a+b.qty,0);
      const totalFmt = "$" + total.toLocaleString();
      
      document.getElementById('cartCount').innerText = count;
      document.getElementById('pbTotal').innerText = totalFmt;
      document.getElementById('drawerTotal').innerText = totalFmt;
      
      if(total > 0) pb.classList.add('visible');
      else pb.classList.remove('visible');

      const body = document.getElementById('cartBody');
      if(cart.length === 0){
        body.innerHTML = "<div class='cartEmpty'>TU CARRITO EST√Å VAC√çO.</div>";
      } else {
        body.innerHTML = cart.map((i, idx) => `
          <div class="cItem">
            <img src="${i.img}" class="cImg">
            <div style="flex:1">
              <div style="font-weight:800; font-size:13px;">${i.name}</div>
              <div style="color:var(--red); font-weight:700;">$${i.price}</div>
              <div style="font-size:12px; margin-top:5px;">Cant: <b>${i.qty}</b></div>
            </div>
            <button onclick="rem(${idx})" style="border:none; background:none; color:#888; font-weight:900; font-size:18px;">&times;</button>
          </div>
        `).join('');
      }
    }

    function rem(idx){
      cart.splice(idx,1);
      updateCart();
    }
    function clearCart(){
      if(confirm('¬øVaciar carrito?')){ cart=[]; updateCart(); }
    }

    async function goCheckout(){
      if(cart.length===0) return;
      const btn = document.querySelector('.dfBtn');
      btn.innerText = "PROCESANDO..."; 
      
      try {
        const stripe = Stripe(STRIPE_PK);
        const res = await fetch(API_URL, {
          method:'POST', 
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({items:cart})
        });
        const data = await res.json();
        if(data.id) stripe.redirectToCheckout({sessionId: data.id});
        else alert("Error iniciando pago");
      } catch(e){
        alert("Error de conexi√≥n");
      }
      btn.innerText = "IR A PAGAR";
    }

    function showLegal(t){
      const txts = {
        terms: "T√©rminos y condiciones oficiales Unico Textil para productos SCORE.",
        privacy: "Datos personales (Nombre, Direcci√≥n) usados exclusivamente para el env√≠o.",
        returns: "Cambios por defecto de f√°brica (15 d√≠as). Cliente cubre env√≠o en cambios de talla.",
        fiscal: "Para facturar env√≠a tu constancia fiscal y # de pedido a ventas.unicotextil@gmail.com"
      };
      document.getElementById('lbTitle').innerText = t.toUpperCase();
      document.getElementById('lbBody').innerText = txts[t];
      overlay.classList.add('active');
      legal.classList.add('active');
    }

    loadCatalog();
    updateCart();
  </script>
</body>
</html>
