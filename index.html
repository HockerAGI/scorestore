<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="color-scheme" content="light" />

  <title>SCORE Store | Tienda Oficial</title>
  <meta name="description" content="Merch oficial SCORE International. Fabricado en Tijuana por ÚNICO UNIFORMES. Envíos a todo México y USA." />
  
  <link rel="canonical" href="https://scorestore.netlify.app/" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="icon" href="/assets/icons-score.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/assets/logo-score.png" />

  <script src="https://js.stripe.com/v3/"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      /* COLORES "VERDAD" & BRAND */
      --red: #E10600;
      --green: #00C853; /* Color pedido: Verdad/Éxito */
      --dark: #1a1a1a;
      --gray: #f4f6f8;
      --white: #ffffff;
      
      /* UX */
      --radius: 16px;
      --shadow: 0 10px 30px -10px rgba(0,0,0,0.12);
      --fontTitle: "Teko", sans-serif;
      --fontBody: "Inter", sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; padding: 0;
      font-family: var(--fontBody);
      background-color: var(--white);
      color: var(--dark);
      overflow-x: hidden;
      padding-bottom: 100px;
    }
    
    /* --- ANIMACIÓN POLVO (Optimizada Móvil) --- */
    .dust-container {
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      overflow: hidden;
    }
    .dust {
      position: absolute; width: 100%; height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
      opacity: 0.4;
      animation: dustFloat 20s linear infinite;
      will-change: transform;
    }
    @keyframes dustFloat {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }

    /* --- UI ELEMENTS --- */
    .wrap { width: min(1200px, 92vw); margin: 0 auto; position: relative; z-index: 2; }
    
    .btn {
      border: none; cursor: pointer; font-weight: 800; text-transform: uppercase;
      padding: 14px 24px; border-radius: 12px; letter-spacing: 0.05em;
      transition: transform 0.1s; font-size: 14px;
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--dark); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .btn-action { background: var(--red); color: #fff; width: 100%; }
    .btn-outline { background: transparent; border: 2px solid #eee; color: var(--dark); }

    /* --- HEADER --- */
    .topbar {
      position: sticky; top: 0; z-index: 100;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid #eee;
    }
    .nav { height: 70px; display: flex; align-items: center; justify-content: space-between; }
    .brand img { height: 45px; display: block; }
    
    .cart-btn {
      background: #f0f0f0; color: var(--dark);
      padding: 8px 16px; border-radius: 50px;
      display: flex; align-items: center; gap: 8px;
      font-weight: 700; font-size: 13px;
    }
    .cart-badge {
      background: var(--green); color: #fff;
      padding: 2px 6px; border-radius: 6px; font-size: 11px;
    }

    /* --- HERO --- */
    .hero {
      margin-top: 20px; padding: 60px 20px;
      border-radius: 24px; background: #f4f4f4;
      text-align: center; position: relative; overflow: hidden;
    }
    .hero h1 {
      font-family: var(--fontTitle); font-size: clamp(48px, 10vw, 120px);
      line-height: 0.9; margin: 10px 0; color: var(--dark); text-transform: uppercase;
    }
    .hero p { max-width: 600px; margin: 0 auto 30px; color: #666; font-size: 16px; line-height: 1.5; }
    .tag {
      background: var(--green); color: #fff; padding: 4px 12px;
      font-weight: 800; border-radius: 4px; font-size: 12px; text-transform: uppercase;
      display: inline-block; margin-bottom: 10px;
    }

    /* --- GRID --- */
    .section-title { font-family: var(--fontTitle); font-size: 42px; margin: 60px 0 20px; text-transform: uppercase; }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
    
    .card {
      background: #fff; border: 1px solid #eee; border-radius: 20px;
      overflow: hidden; cursor: pointer; transition: 0.2s; position: relative;
    }
    .card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--green); }
    
    .card-bg {
      height: 280px; background: #f9f9f9;
      display: flex; align-items: center; justify-content: center; position: relative;
    }
    .card-bg img { width: 70%; height: auto; object-fit: contain; mix-blend-mode: multiply; }
    
    .card-info { padding: 20px; text-align: center; }
    .card-status {
      position: absolute; top: 15px; left: 15px;
      background: var(--white); color: var(--green);
      font-weight: 800; font-size: 10px; padding: 6px 12px;
      border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      text-transform: uppercase; letter-spacing: 1px;
    }

    /* --- DRAWER (CARRITO) --- */
    .drawer {
      position: fixed; top: 0; right: 0; width: min(420px, 90vw); height: 100%;
      background: #fff; z-index: 200; transform: translateX(110%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      box-shadow: -10px 0 40px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
    }
    .drawer.open { transform: translateX(0); }
    
    .drawer-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .drawer-body { flex: 1; overflow-y: auto; padding: 20px; }
    .drawer-footer { padding: 20px; background: #fafafa; border-top: 1px solid #eee; }

    .cart-item { display: flex; gap: 15px; margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 12px; border: 1px solid #eee; }
    .cart-item img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
    
    /* INPUTS MOBILE FRIENDLY (16px) */
    input, select {
      width: 100%; height: 48px; font-size: 16px; /* Crucial iOS */
      padding: 0 15px; border-radius: 10px; border: 1px solid #ddd;
      margin-bottom: 10px; background: #fff;
    }
    input:focus, select:focus { outline: none; border-color: var(--green); }

    /* --- PAYBAR --- */
    .paybar {
      position: fixed; bottom: 20px; left: 50%; transform: translate(-50%, 100px);
      width: min(600px, 94vw); background: #1a1a1a; color: #fff;
      padding: 12px 20px; border-radius: 16px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 150; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: 0.3s;
    }
    .paybar.visible { transform: translate(-50%, 0); }

    /* --- MODAL --- */
    .modal {
      position: fixed; inset: 0; z-index: 300;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: 0.2s;
    }
    .modal.open { opacity: 1; pointer-events: auto; }
    .modal-bg { position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
    .modal-content {
      width: min(900px, 94vw); height: min(600px, 90vh);
      background: #fff; border-radius: 20px; position: relative;
      display: flex; flex-direction: column; overflow: hidden;
    }

    /* --- FOOTER --- */
    footer { margin-top: 80px; padding: 60px 0; border-top: 1px solid #eee; background: #fafafa; }
    .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; }
    .legal-link {
      display: block; padding: 12px; border-bottom: 1px solid #eee;
      color: #666; text-decoration: none; font-size: 14px; font-weight: 600;
      display: flex; justify-content: space-between;
    }
    .legal-link span { color: var(--green); }
  </style>
</head>
<body>

  <div class="dust-container"><div class="dust"></div></div>

  <header class="topbar">
    <div class="wrap nav">
      <a href="/" class="brand"><img src="/assets/logo-score.png" alt="SCORE"></a>
      <button class="btn cart-btn" onclick="toggleDrawer()">
        TU EQUIPO <span class="cart-badge" id="cartCount">0</span>
      </button>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <span class="tag">Tienda Oficial</span>
      <h1>Score International</h1>
      <p>Fabricado en Tijuana por <b>ÚNICO UNIFORMES</b>. Equipamiento oficial para la Baja 1000, 500 y San Felipe 250. Ediciones limitadas.</p>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-primary" onclick="document.getElementById('catalog').scrollIntoView({behavior:'smooth'})">VER PRODUCTOS</button>
      </div>
    </section>

    <div style="display:flex; justify-content:center; gap:30px; margin: 40px 0; flex-wrap:wrap; opacity:0.6; filter: grayscale(1);">
      <img src="/assets/logo-ford.png" height="30" alt="Ford">
      <img src="/assets/logo-bfgodrich.png" height="30" alt="BFGoodrich">
      <img src="/assets/logo-monster.png" height="30" alt="Monster">
    </div>

    <h2 class="section-title" id="catalog">Ediciones</h2>

    <div class="grid">
      <div class="card" onclick="loadCatalog('EDICION_2025', 'Baja 1000')">
        <div class="card-bg">
          <span class="card-status">● Activo</span>
          <img src="/assets/logo-baja1000.png" alt="Baja 1000">
        </div>
        <div class="card-info">
          <button class="btn btn-outline" style="width:100%">Ver Colección</button>
        </div>
      </div>

      <div class="card" onclick="loadCatalog('BAJA_500', 'Baja 500')">
        <div class="card-bg">
          <span class="card-status">● Disponible</span>
          <img src="/assets/logo-baja500.png" alt="Baja 500">
        </div>
        <div class="card-info">
          <button class="btn btn-outline" style="width:100%">Ver Colección</button>
        </div>
      </div>

      <div class="card" onclick="loadCatalog('BAJA_400', 'Baja 400')">
        <div class="card-bg">
          <span class="card-status">● Disponible</span>
          <img src="/assets/logo-baja400.png" alt="Baja 400">
        </div>
        <div class="card-info">
          <button class="btn btn-outline" style="width:100%">Ver Colección</button>
        </div>
      </div>

       <div class="card" onclick="loadCatalog('SF_250', 'San Felipe 250')">
        <div class="card-bg">
          <span class="card-status">● Disponible</span>
          <img src="/assets/logo-sf250.png" alt="San Felipe">
        </div>
        <div class="card-info">
          <button class="btn btn-outline" style="width:100%">Ver Colección</button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="wrap footer-grid">
      <div>
        <img src="/assets/logo-unico.png" height="40" alt="Unico" style="margin-bottom:20px; opacity:0.8;">
        <p style="color:#666; font-size:14px;">
          <b>Ventas y Soporte:</b><br>
          ventas.unicotextil@gmail.com<br>
          WhatsApp: 664 236 8701<br>
          Tijuana, B.C. México.
        </p>
      </div>
      <div>
        <h4 style="font-family:var(--fontTitle); font-size:24px; color:var(--red);">LEGAL</h4>
        <a href="#" class="legal-link">Términos y Condiciones <span>+</span></a>
        <a href="#" class="legal-link">Política de Envíos <span>+</span></a>
        <a href="#" class="legal-link">Devoluciones <span>+</span></a>
      </div>
    </div>
  </footer>

  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <h3 style="margin:0; font-family:var(--fontTitle); font-size:24px;">TU CARRITO</h3>
      <button class="btn btn-outline" onclick="toggleDrawer()" style="padding:8px 12px;">X</button>
    </div>
    <div class="drawer-body" id="cartItems">
      <div style="text-align:center; padding:40px; color:#999;">Tu carrito está vacío</div>
    </div>
    <div class="drawer-footer">
      <div style="display:flex; justify-content:space-between; font-weight:800; font-size:18px; margin-bottom:15px;">
        <span>Total:</span>
        <span id="cartTotal">$0.00 MXN</span>
      </div>

      <select id="shipMethod">
        <option value="">-- Elige Entrega --</option>
        <option value="pickup">Recoger en Fábrica (Tijuana) - Gratis</option>
        <option value="tj">Envío Local (Tijuana) - $80 MXN</option>
        <option value="mx">Envío Nacional (México) - Cotizar</option>
      </select>

      <div id="shipDetails" style="display:none;">
        <input type="text" id="shipZip" placeholder="Código Postal (5 dígitos)" maxlength="5">
        <input type="text" id="shipState" placeholder="Estado">
        <input type="text" id="shipCity" placeholder="Ciudad">
        <input type="text" id="shipAddress" placeholder="Dirección y Número">
        <input type="text" id="shipName" placeholder="Nombre Completo">
        <button id="quoteBtn" class="btn btn-outline" style="width:100%; margin-bottom:10px;">Cotizar Envío (Envia.com)</button>
      </div>

      <button id="checkoutBtn" class="btn btn-primary" style="width:100%; background:var(--green);" disabled>PAGAR AHORA</button>
    </div>
  </div>

  <div class="paybar" id="paybar">
    <div>
      <div style="font-size:10px; opacity:0.7;">TOTAL A PAGAR</div>
      <div style="font-size:18px; font-weight:800;" id="barTotal">$0</div>
    </div>
    <button class="btn btn-action" style="padding:8px 16px;" onclick="toggleDrawer()">VER CARRITO</button>
  </div>

  <div class="modal" id="modal">
    <div class="modal-bg" onclick="closeModal()"></div>
    <div class="modal-content">
      <div class="drawer-header">
        <h3 id="modalTitle" style="margin:0; font-family:var(--fontTitle); font-size:28px;">PRODUCTOS</h3>
        <button class="btn btn-outline" onclick="closeModal()">Cerrar</button>
      </div>
      <div class="drawer-body" style="background:#f9f9f9;">
        <div class="grid" id="modalGrid"></div>
      </div>
    </div>
  </div>

  <script>
    /* --- CONFIGURACIÓN REAL --- */
    const STRIPE_PK = "pk_live_51Se6fsGUCnsKfgrBdpVBcTbXG99reZVkx8cpzMlJxr0EtUfuJAq0Qe3igAiQYmKhMn0HewZI5SGRcnKqAdTigpqB00fVsfpMYh";
    const API_URL = "/.netlify/functions";
    
    /* --- DATOS (Fallback Seguro) --- */
    const PRODUCTS = [
      { id: "cham-b1000", name: "Chamarra Oficial Baja 1000", price: 1490, img: "/assets/EDICION_2025/chamarra-baja1000.jpg", sizes: ["S","M","L","XL"], cat: "EDICION_2025" },
      { id: "tee-b1000-bk", name: "Playera Baja 1000 Negra", price: 499, img: "/assets/EDICION_2025/camiseta-baja1000-negra.jpg", sizes: ["S","M","L","XL"], cat: "EDICION_2025" },
      { id: "tee-b500", name: "Playera Oficial Baja 500", price: 450, img: "/assets/EDICION_2025/camiseta-baja1000-azul.jpg", sizes: ["S","M","L"], cat: "BAJA_500" },
      { id: "hoodie-sf", name: "Hoodie San Felipe 250", price: 850, img: "/assets/EDICION_2025/sudadera-world-desert-cafe.jpg", sizes: ["S","M","L"], cat: "SF_250" },
      { id: "tee-b400", name: "Tee Baja 400 Desert", price: 450, img: "/assets/EDICION_2025/camiseta-baja1000-cafe.jpg", sizes: ["S","M","L"], cat: "BAJA_400" }
    ];

    let cart = [];
    let shipping = { method: null, cost: 0 };

    /* --- UI LOGIC --- */
    const $ = (id) => document.getElementById(id);

    function toggleDrawer() { 
      $('drawer').classList.toggle('open'); 
      if($('drawer').classList.contains('open')) updateCart(); 
    }
    
    function closeModal() { $('modal').classList.remove('open'); }

    /* --- CATALOG SYSTEM --- */
    function loadCatalog(category, title) {
      $('modalTitle').innerText = title;
      const items = PRODUCTS.filter(p => p.cat === category || p.cat === 'EDICION_2025'); // Fallback inteligente
      
      $('modalGrid').innerHTML = items.map(p => `
        <div class="card" style="border:none; box-shadow:none;">
          <div class="card-bg" style="height:200px; background:#fff; border-radius:12px; border:1px solid #eee;">
            <img src="${p.img}" onerror="this.src='/assets/logo-score.png'">
          </div>
          <div style="padding:10px; text-align:left;">
            <div style="font-weight:700;">${p.name}</div>
            <div style="color:var(--green); font-weight:800; margin:5px 0;">$${p.price} MXN</div>
            <select id="size_${p.id}" style="height:40px; margin:5px 0;">
              ${p.sizes.map(s => `<option>${s}</option>`).join('')}
            </select>
            <button class="btn btn-action" onclick="addToCart('${p.id}')">AGREGAR</button>
          </div>
        </div>
      `).join('');
      
      $('modal').classList.add('open');
    }

    /* --- CART SYSTEM --- */
    function addToCart(id) {
      const prod = PRODUCTS.find(p => p.id === id);
      const size = $(`size_${id}`).value;
      const key = `${id}-${size}`;
      
      const exist = cart.find(c => c.key === key);
      if(exist) exist.qty++;
      else cart.push({ ...prod, size, qty: 1, key });
      
      updateCart();
      toggleDrawer();
      closeModal();
    }

    function updateCart() {
      const totalItems = cart.reduce((a,b) => a + b.qty, 0);
      const subtotal = cart.reduce((a,b) => a + (b.price * b.qty), 0);
      const total = subtotal + shipping.cost;

      $('cartCount').innerText = totalItems;
      $('cartTotal').innerText = `$${total.toLocaleString()} MXN`;
      $('barTotal').innerText = `$${total.toLocaleString()}`;

      $('cartItems').innerHTML = cart.map((item, idx) => `
        <div class="cart-item">
          <img src="${item.img}">
          <div style="flex:1">
            <div style="font-weight:700;">${item.name}</div>
            <div style="font-size:13px; color:#666;">Talla: ${item.size}</div>
            <div style="color:var(--green); font-weight:700;">$${item.price}</div>
          </div>
          <div style="display:flex; flex-direction:column; align-items:end;">
            <button onclick="cart.splice(${idx},1); updateCart()" style="color:red; background:none; border:none; font-weight:bold;">✕</button>
            <span style="margin-top:10px; font-weight:800;">x${item.qty}</span>
          </div>
        </div>
      `).join('') || '<div style="text-align:center; padding:40px; color:#999;">Tu carrito está vacío</div>';

      $('paybar').classList.toggle('visible', totalItems > 0);
      validateCheckout();
    }

    /* --- SHIPPING LOGIC (Envia.com Automation) --- */
    $('shipMethod').addEventListener('change', (e) => {
      const m = e.target.value;
      shipping.method = m;
      
      if(m === 'pickup') { shipping.cost = 0; $('shipDetails').style.display = 'none'; }
      else if(m === 'tj') { shipping.cost = 80; $('shipDetails').style.display = 'none'; }
      else if(m === 'mx') { shipping.cost = 0; $('shipDetails').style.display = 'block'; }
      
      updateCart();
    });

    $('quoteBtn').addEventListener('click', async () => {
      const btn = $('quoteBtn');
      btn.innerText = "Cotizando...";
      
      const zip = $('shipZip').value;
      
      try {
        // Intento de conexión real con tu backend
        const res = await fetch(`${API_URL}/quote_shipping`, {
          method: 'POST',
          body: JSON.stringify({ postal_code: zip, items: cart })
        });
        
        if(res.ok) {
          const data = await res.json();
          shipping.cost = data.rate || 180; // Fallback si la API no devuelve tarifa exacta
        } else {
          throw new Error("API Error");
        }
      } catch (e) {
        // FALLBACK SEGURO: Si falla Envia.com, asigna tarifa plana nacional
        console.warn("Usando tarifa plana por error de API");
        shipping.cost = 250; 
      }
      
      btn.innerText = `Envío Cotizado: $${shipping.cost}`;
      btn.style.background = "var(--green)";
      btn.style.color = "#fff";
      updateCart();
    });

    /* --- STRIPE CHECKOUT --- */
    function validateCheckout() {
      const ok = cart.length > 0 && shipping.method && (shipping.method !== 'mx' || shipping.cost > 0);
      $('checkoutBtn').disabled = !ok;
    }

    $('checkoutBtn').addEventListener('click', async () => {
      const btn = $('checkoutBtn');
      btn.innerText = "Procesando...";
      btn.disabled = true;

      try {
        const stripe = Stripe(STRIPE_PK);
        const payload = {
          items: cart,
          shipping: {
            method: shipping.method,
            cost: shipping.cost,
            details: {
              name: $('shipName').value,
              postal: $('shipZip').value,
              address: $('shipAddress').value
            }
          }
        };

        const res = await fetch(`${API_URL}/create_checkout`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const session = await res.json();
        if(session.url) window.location.href = session.url;
        else alert("Error iniciando pago. Revisa tu conexión.");
        
      } catch (err) {
        alert("Ocurrió un error. Intenta de nuevo.");
        btn.innerText = "PAGAR AHORA";
        btn.disabled = false;
      }
    });

  </script>
</body>
</html>