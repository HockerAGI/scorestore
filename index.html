<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#E10600" />

  <title>SCORE | Official Store</title>
  <meta name="description" content="Equípate con la historia. Drops oficiales inspirados en el desierto. Compra segura en México." />
  <meta name="robots" content="index,follow" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="SCORE | Official Baja Gear" />
  <meta property="og:description" content="Inventario limitado + drops oficiales. Compra rápida, segura y directa en México." />
  <meta property="og:image" content="https://scorestore.netlify.app/assets/hero.png" />
  <meta property="og:url" content="https://scorestore.netlify.app/" />

  <link rel="icon" href="assets/favicon.png" />
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --red: #E10600;
      --carbon: #1a1a1a;
      --charcoal: #262626;
      --sand: #f0f0f0;

      --fontTitle: "Teko", sans-serif;
      --fontBody: "Inter", sans-serif;

      --bgTexture: url("assets/baja1000-texture.png");
      --pageBg: url("assets/fondo-pagina-score.png");

      /* ✅ overlay café */
      --coffeeGlass: rgba(148, 111, 74, 0.12);
      --coffeeGlass2: rgba(120, 86, 55, 0.06);

      --logoOutline: rgba(255,255,255,0.92);

      /* ✅ NUEVO: opacidad del fondo (más suave) */
      --pageBgOpacity: 0.72;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    img{max-width:100%; height:auto; display:block;}

    *{ -webkit-tap-highlight-color: rgba(0,0,0,0); }
    a, button, .cardDrop, .btnDrop, .cartTrigger, .btnHero, .pBtn, .pbBtn, .shipBtn{
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      outline: none;
    }
    button:focus, a:focus, .cardDrop:focus{ outline:none; }
    :focus-visible{
      outline: 3px solid rgba(225, 6, 0, .55);
      outline-offset: 2px;
      border-radius: 10px;
    }

    /* ✅ Fondo ahora por pseudo-elemento para controlar opacidad */
    body{
      margin:0;
      font-family: var(--fontBody);
      color: #111;
      background-color: var(--sand);
      overflow-x:hidden;
      padding-bottom: 95px;
      position: relative;
    }

    /* ✅ BG con opacidad controlada */
    body::after{
      content:"";
      position:fixed; inset:0;
      background-image: var(--pageBg);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: var(--pageBgOpacity);
      z-index:-3;
      pointer-events:none;
    }

    /* ✅ Evita jank en móvil; “fixed” solo en pantallas grandes */
    @media (min-width: 900px){
      body::after{
        background-attachment: fixed;
      }
    }

    body.modalOpen{ overflow:hidden; }

    /* Grano leve encima (muy ligero) */
    body::before{
      content:""; position:fixed; inset:0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.006' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)' opacity='.05'/%3E%3C/svg%3E");
      z-index:-2; pointer-events:none; mix-blend-mode:multiply;
      animation: dustFloat 10s ease-in-out infinite;
      opacity: .9;
    }

    @keyframes dustFloat{
      0%,100%{ transform: translate3d(0,0,0); opacity:.045; }
      50%{ transform: translate3d(0,-6px,0); opacity:.06; }
    }

    .wrap{
      width:min(1200px, 94vw);
      margin:0 auto;
      padding-top: 90px;
      padding-bottom: 60px;
    }

    .topbar{
      position:fixed; top:0; left:0; right:0; z-index:90;
      background: rgba(245,245,245,0.95);
      border-bottom: 3px solid var(--red);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    .topInner{
      width:min(1200px, 94vw);
      margin:0 auto;
      height:76px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brandLogo img{
      height:55px; display:block;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
    }

    .navRight{ display:flex; align-items:center; gap:12px; }

    .miniPill{
      display:flex; align-items:center; justify-content:center;
      height: 38px;
      padding: 0 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(0,0,0,0.08);
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .06em;
      color: #111;
      white-space: nowrap;
    }
    @media (max-width: 520px){
      .miniPill{ display:none; }
    }

    /* ✅ Carrito mejorado */
    .cartTrigger{
      position:relative;
      background: var(--carbon); color:#fff; border:none;
      height:54px; padding:0 18px;
      display:flex; align-items:center; gap:12px;
      font-family: var(--fontTitle); font-weight:700; font-size:22px;
      clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      overflow:hidden;
      isolation:isolate;
      transition: transform .15s ease;
    }
    .cartTrigger:hover{ transform: translateY(-1px); }

    .cartTrigger::after{
      content:"";
      position:absolute; inset:-40% -30%;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.22) 40%, transparent 70%);
      transform: translateX(-120%) rotate(-18deg);
      z-index:0;
      opacity:.0;
    }
    .cartTrigger:hover::after{
      animation: speedSweep .85s ease-out;
      opacity:1;
    }

    .cartIconSvg{
      width:36px;
      height:36px;
      stroke: #fff;
      stroke-width: 2.2;
      fill: none;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.35));
      z-index:1;
    }

    .cartCount{
      position:absolute; top:6px; right:6px;
      background: var(--red);
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 6px;
      line-height:1;
      font-weight:900;
      z-index:1;
    }

    .cartTrigger.bump{ animation: rpmPulse .28s ease-out; }
    @keyframes rpmPulse{
      0%{ transform: scale(1); }
      60%{ transform: scale(1.06); }
      100%{ transform: scale(1); }
    }

    @keyframes speedSweep{
      0%{ transform: translateX(-140%) rotate(-18deg); }
      100%{ transform: translateX(140%) rotate(-18deg); }
    }

    .hero{
      position:relative;
      border-radius: 12px;
      overflow:hidden;
      min-height: 540px;
      display:flex;
      align-items:center;
      background: var(--carbon);
      color:#fff;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    .heroBg{
      position:absolute; inset:0;
      background: url('assets/hero.png') center/cover no-repeat;
      opacity:0.95;
      transform: scale(1.03);
      animation: heroDrift 9s ease-in-out infinite;
    }
    @keyframes heroDrift{
      0%,100%{ transform: scale(1.03) translate3d(0,0,0); }
      50%{ transform: scale(1.05) translate3d(-6px, -4px, 0); }
    }

    .heroOverlay{
      position:absolute; inset:0;
      background:
        linear-gradient(to right, rgba(0,0,0,0.90) 0%, rgba(0,0,0,0.40) 60%, transparent 100%),
        radial-gradient(circle at 70% 30%, rgba(225,6,0,0.18), transparent 45%);
    }
    .heroContent{
      position:relative; z-index:2;
      padding: 50px;
      max-width: 680px;
    }
    .heroTag{
      background: var(--red); color:#fff;
      padding: 6px 16px;
      font-family: var(--fontTitle);
      font-size:22px;
      font-weight:700;
      transform: skew(-10deg);
      display:inline-block;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      letter-spacing: .02em;
      animation: tagIn .55s ease-out both;
    }
    @keyframes tagIn{
      from{ transform: translateY(10px) skew(-10deg); opacity:0; }
      to{ transform: translateY(0) skew(-10deg); opacity:1; }
    }

    .heroTitle{
      font-family: var(--fontTitle);
      font-size: 90px;
      line-height: 0.85;
      margin:0 0 18px;
      text-transform:uppercase;
      text-shadow: 0 5px 20px rgba(0,0,0,0.6);
      animation: titleIn .6s ease-out both;
    }
    @keyframes titleIn{
      from{ transform: translateY(12px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }
    .heroTitle span{ color: var(--red); }

    .heroSub{
      font-size: 17px;
      line-height: 1.5;
      color:#ddd;
      margin-bottom: 26px;
      border-left: 4px solid var(--red);
      padding-left: 18px;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      animation: subIn .7s ease-out both;
    }
    @keyframes subIn{
      from{ transform: translateY(10px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }

    .btnHero{
      background:#fff; color: var(--carbon);
      border:none;
      padding: 14px 35px;
      font-family: var(--fontTitle);
      font-size: 26px;
      font-weight: 700;
      cursor:pointer;
      clip-path: polygon(0 0, 100% 0, 95% 100%, 0% 100%);
      transition: transform .2s;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      position:relative;
      overflow:hidden;
    }
    .btnHero:hover{ transform: translateY(-2px); }
    .btnHero::after{
      content:"";
      position:absolute; inset:-60% -40%;
      background: linear-gradient(90deg, transparent 0%, rgba(0,0,0,.12) 40%, transparent 70%);
      transform: translateX(-120%) rotate(-18deg);
    }
    .btnHero:hover::after{ animation: speedSweep .9s ease-out; }

    @media (max-width: 768px){
      .hero{ align-items:flex-end; min-height: 480px; }
      .heroOverlay{
        background:
          linear-gradient(to top, rgba(0,0,0,0.95) 15%, rgba(0,0,0,0.2) 70%, transparent 100%),
          radial-gradient(circle at 60% 25%, rgba(225,6,0,0.14), transparent 50%);
      }
      .heroTitle{ font-size: 55px; }
      .heroContent{ padding: 25px; width: 100%; }
    }

    /* =========================================================
       ✅ PARTE QUE FALTABA (FIX LAYOUT / DROPS / CART / MODALS)
       ========================================================= */

    /* Overlay global */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      opacity:0; pointer-events:none;
      transition: opacity .18s ease;
      z-index:95;
    }
    .overlay.active{ opacity:1; pointer-events:auto; }

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:110px;
      transform: translateX(-50%);
      background:#111; color:#fff;
      padding:10px 14px;
      border-radius: 14px;
      font-weight:900; font-size:12px;
      letter-spacing:.02em;
      opacity:0; pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index:120;
      max-width:min(520px, 92vw);
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-6px); }

    /* Status banner */
    .statusBanner{
      position:fixed;
      top:88px; left:50%;
      transform: translateX(-50%);
      width:min(560px, 94vw);
      background: rgba(255,255,255,.96);
      border: 1px solid rgba(0,0,0,.08);
      border-left: 6px solid var(--red);
      border-radius: 16px;
      padding: 12px 14px;
      display:none;
      align-items:center;
      gap:12px;
      z-index:110;
      box-shadow: 0 18px 45px rgba(0,0,0,.18);
      backdrop-filter: blur(8px);
    }
    .statusBanner.show{ display:flex; }
    .statusBanner img{
      width:44px; height:44px;
      object-fit:contain;
      flex:0 0 auto;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
    }
    .statusBanner strong{ display:block; font-weight:900; font-size:14px; color:#111; }
    .statusBanner span{ display:block; font-weight:800; font-size:12px; color:#444; }
    .statusBanner button{
      margin-left:auto;
      background:#111; color:#fff;
      border:none;
      border-radius: 12px;
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
    }

    /* Headers secciones */
    .secHeader{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin: 26px 0 14px;
    }
    .secTitle{
      margin:0;
      font-family: var(--fontTitle);
      font-size: 36px;
      letter-spacing:.02em;
      text-transform:uppercase;
      color:#111;
      text-shadow: 0 2px 0 rgba(255,255,255,.65);
    }
    .secMeta{
      font-weight:900;
      font-size:12px;
      color:#555;
      letter-spacing:.06em;
      text-transform:uppercase;
      white-space:nowrap;
    }

    /* DROPS grid */
    .gridDrops{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      margin-bottom: 32px;
    }
    @media (max-width: 980px){
      .gridDrops{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .gridDrops{ grid-template-columns: 1fr; }
    }

    .cardDrop{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      cursor:pointer;
      min-height: 220px;
      box-shadow: 0 18px 45px rgba(0,0,0,.16);
      background: rgba(255,255,255,.75);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .cardDrop:hover{
      transform: translateY(-2px);
      box-shadow: 0 22px 55px rgba(0,0,0,.20);
    }
    .dropBg{
      position:absolute; inset:0;
      background: var(--bgTexture) center/cover no-repeat;
      opacity:.35;
      transform: scale(1.02);
    }
    .dropGlass{
      position:relative;
      height:100%;
      padding:16px;
      display:flex;
      gap:12px;
      align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.58));
      backdrop-filter: blur(12px);
    }
    .statusBadge{
      position:absolute;
      top:12px; right:12px;
      background: var(--red);
      color:#fff;
      font-weight:900;
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      letter-spacing:.06em;
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
    }
    .dropLogo{
      width:92px; height:92px;
      object-fit:contain;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
      flex:0 0 auto;
    }
    .dropInfo{ flex:1; min-width:0; }
    .dropInfo h3{
      margin:0 0 4px;
      font-family: var(--fontTitle);
      font-size: 32px;
      letter-spacing:.02em;
      line-height:1;
      text-transform:uppercase;
      color:#111;
    }
    .dropInfo p{
      margin:0 0 12px;
      color:#333;
      font-weight:800;
      font-size:13px;
      line-height:1.35;
    }
    .btnDrop{
      background:#111;
      color:#fff;
      border:none;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:900;
      cursor:pointer;
      letter-spacing:.04em;
      transition: transform .15s ease;
    }
    .btnDrop:hover{ transform: translateY(-1px); }

    /* Sponsors */
    .sponsors{
      margin-top: 26px;
      padding: 18px;
      border-radius: 18px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.06);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,.10);
    }
    .spGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      align-items:center;
    }
    @media (max-width: 768px){
      .spGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    .spLogo{
      width:100%;
      max-height: 64px;
      object-fit: contain;
      opacity:.9;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.12));
      padding: 6px;
    }

    /* Footer */
    footer{
      margin: 50px 0 24px;
      padding: 0 3vw;
    }
    .footGrid{
      width:min(1200px, 94vw);
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 18px;
      padding: 20px;
      border-radius: 18px;
      background: rgba(0,0,0,.86);
      box-shadow: 0 20px 50px rgba(0,0,0,.22);
    }
    @media (max-width: 900px){
      .footGrid{ grid-template-columns: 1fr; }
    }
    .fLink{
      display:inline-block;
      margin: 6px 14px 6px 0;
      color:#ddd;
      font-weight:900;
      font-size: 13px;
      cursor:pointer;
      opacity:.95;
    }
    .fLink:hover{ color:#fff; text-decoration: underline; }

    /* Paybar */
    .paybar{
      position:fixed; left:0; right:0; bottom:0;
      padding: 12px 12px;
      background: rgba(255,255,255,.96);
      border-top: 1px solid rgba(0,0,0,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      transform: translateY(110%);
      transition: transform .2s ease;
      z-index:88;
      backdrop-filter: blur(10px);
    }
    .paybar.visible{ transform: translateY(0); }
    .pbTotal{
      font-weight: 900;
      font-size: 11px;
      letter-spacing: .08em;
      color:#444;
    }
    .pbPrice{
      font-weight: 900;
      font-size: 16px;
      line-height:1.1;
    }
    .pbPrice small{
      display:block;
      font-weight:900;
      font-size:12px;
      color:#666;
      margin-top: 4px;
    }
    .pbBtn{
      background: var(--carbon);
      color:#fff;
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      cursor:pointer;
      letter-spacing:.04em;
      box-shadow: 0 16px 35px rgba(0,0,0,.18);
    }

    /* Drawer carrito */
    .drawer{
      position:fixed;
      top:0; right:0;
      width:min(420px, 92vw);
      height:100%;
      background:#fff;
      transform: translateX(110%);
      transition: transform .2s ease;
      z-index:100;
      display:flex;
      flex-direction:column;
      box-shadow: -22px 0 45px rgba(0,0,0,.20);
    }
    .drawer.active{ transform: translateX(0); }

    .dHead{
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(0,0,0,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .dTitle{
      margin:0;
      font-family: var(--fontTitle);
      font-size: 30px;
      letter-spacing:.02em;
    }

    .dBody{
      padding: 14px 16px;
      overflow:auto;
      flex:1;
    }
    .cartEmpty{
      font-weight:900;
      color:#666;
      padding: 16px 0;
    }
    .cItem{
      display:flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
      align-items:flex-start;
    }
    .cImg{
      width:72px;
      height:72px;
      object-fit:cover;
      border-radius: 14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
    }
    .cMetaLine{
      margin-top:4px;
      font-size: 12px;
      color:#555;
      font-weight:800;
    }
    .cPrice{
      margin-top: 6px;
      font-weight: 900;
      font-size: 13px;
      color:#111;
    }

    .dFoot{
      padding: 14px 16px 18px;
      border-top: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.98);
    }
    .sumRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:900;
      margin: 6px 0;
      color:#111;
    }

    .shipBox{
      margin: 10px 0 12px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.05);
      border: 1px solid rgba(0,0,0,.06);
    }
    .shipRow{
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .shipInput{
      flex:1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.12);
      font-weight: 900;
      font-size: 14px;
      outline:none;
      background: rgba(255,255,255,.9);
    }
    .shipBtn{
      padding: 12px 14px;
      border-radius: 12px;
      border:none;
      background:#111;
      color:#fff;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }

    .dfBtn{
      width:100%;
      padding: 14px 16px;
      border:none;
      border-radius: 16px;
      background: var(--red);
      color:#fff;
      font-weight: 900;
      cursor:pointer;
      letter-spacing:.04em;
      box-shadow: 0 18px 40px rgba(225,6,0,.22);
    }
    .dfBtn:disabled{ opacity:.55; cursor:not-allowed; }

    .clearLink{
      display:block;
      margin-top: 10px;
      text-align:center;
      font-weight: 900;
      color:#555;
      cursor:pointer;
      text-decoration: underline;
    }

    /* Product modal */
    .prodModal{
      position:fixed;
      left:50%; top:50%;
      transform: translate(-50%, -50%) scale(.98);
      width:min(980px, 94vw);
      max-height: 86vh;
      background: rgba(255,255,255,.96);
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 26px 70px rgba(0,0,0,.22);
      z-index:105;
      display:none;
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .prodModal.active{ display:block; }

    .pmHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.92);
    }
    .pmTitle{
      font-family: var(--fontTitle);
      font-size: 30px;
      letter-spacing:.02em;
      text-transform:uppercase;
    }
    .pmClose{
      background:none;
      border:none;
      cursor:pointer;
      font-weight:900;
      line-height:1;
      color:#111;
    }
    .pmBody{
      padding: 16px;
      overflow:auto;
      max-height: calc(86vh - 64px);
    }

    .pmDivider{
      display:flex;
      align-items:center;
      gap: 12px;
      margin: 16px 0 14px;
      opacity:.9;
    }
    .pmDivider .bar{
      flex:1;
      height: 2px;
      background: rgba(0,0,0,.12);
      border-radius:999px;
    }
    .pmDivider .label{
      font-weight:900;
      font-size: 12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:#444;
      white-space:nowrap;
    }

    .pmGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){
      .pmGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .pmGrid{ grid-template-columns: 1fr; }
    }

    .pCard{
      border-radius: 18px;
      overflow:hidden;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 18px 40px rgba(0,0,0,.10);
      display:flex;
      flex-direction:column;
      min-height: 100%;
    }
    .pImg{
      background: rgba(0,0,0,.06);
      aspect-ratio: 4/3;
      overflow:hidden;
    }
    .pImg img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .pInfo{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      flex:1;
    }
    .pName{
      font-weight:900;
      font-size: 13px;
      line-height:1.25;
      color:#111;
    }
    .pPrice .pWas{
      font-weight:900;
      font-size: 12px;
      color:#777;
      text-decoration: line-through;
    }
    .pPrice .pNow{
      font-weight:900;
      font-size: 16px;
      color:#111;
    }
    .pOff{
      display:inline-block;
      margin-left: 8px;
      background: var(--red);
      color:#fff;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 900;
      vertical-align: middle;
    }
    .pPrice small{
      display:block;
      margin-top: 4px;
      color:#666;
      font-weight:900;
      font-size: 12px;
    }

    .sizeRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sizeRow label{
      font-weight:900;
      font-size: 12px;
      color:#444;
    }
    .sizeSelect{
      flex: 0 0 auto;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.12);
      font-weight: 900;
      background: rgba(255,255,255,.92);
    }

    .pBtn{
      margin-top:auto;
      width:100%;
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      background: #111;
      color:#fff;
      font-weight: 900;
      cursor:pointer;
      letter-spacing:.04em;
    }

    /* Legal modal */
    .legalBox{
      position:fixed;
      left:50%; top:50%;
      transform: translate(-50%, -50%) scale(.98);
      width:min(720px, 94vw);
      max-height: 82vh;
      overflow:auto;
      background: rgba(255,255,255,.96);
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 26px 70px rgba(0,0,0,.22);
      z-index:106;
      display:none;
      padding: 16px;
      backdrop-filter: blur(10px);
    }
    .legalBox.active{ display:block; }
    .legalBox h3{
      margin:0 0 10px;
      font-family: var(--fontTitle);
      font-size: 30px;
      text-transform:uppercase;
    }
    .legalBox p{
      margin: 0 0 10px;
      color:#222;
      font-weight:700;
      line-height:1.55;
      font-size: 14px;
    }

  </style>
</head>
<body>
  <div class="overlay" id="globalOverlay"></div>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="statusBanner" id="statusBanner" aria-live="polite">
    <img src="assets/icono-compra-exitosa.png" alt="Compra exitosa" loading="lazy" decoding="async" onerror="this.style.display='none'">
    <div>
      <strong id="sbTitle">Listo</strong>
      <span id="sbText">Tu pago fue procesado.</span>
    </div>
    <button onclick="hideStatusBanner()">OK</button>
  </div>

  <header class="topbar">
    <div class="topInner">
      <a href="/" class="brandLogo" aria-label="SCORE Official Baja Gear">
        <img src="assets/logo-score.png" alt="SCORE" loading="eager" decoding="async">
      </a>

      <div class="navRight">
        <div class="miniPill" title="México">ENVÍOS MX</div>

        <button class="cartTrigger" id="cartTrigger" onclick="toggleCart()" aria-label="Abrir carrito">
          <svg class="cartIconSvg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M6.5 6h14l-1.6 7.2a2 2 0 0 1-2 1.6H9.2a2 2 0 0 1-2-1.6L5.1 3.8A1.5 1.5 0 0 0 3.6 2.6H2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9.5 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2zM17.5 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="cartCount" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-label="Hero">
      <div class="heroBg"></div>
      <div class="heroOverlay"></div>

      <div class="heroContent">
        <div class="heroTag">MERCH OFICIAL</div>
        <h1 class="heroTitle">LEYENDAS<br><span>DEL DESIERTO</span></h1>
        <p class="heroSub">
          Inventario limitado + drops oficiales. Compra rápida y segura en México (tarjeta y OXXO disponibles en checkout).
        </p>
        <button class="btnHero" onclick="openProductModal('b1000')">VER DROPS</button>
      </div>
    </section>

    <div class="secHeader">
      <h2 class="secTitle">DROPS ACTIVOS</h2>
      <span class="secMeta">MX · Drops Oficiales</span>
    </div>

    <div class="gridDrops">
      <div class="cardDrop" onclick="openProductModal('b1000')">
        <div class="dropBg"></div>
        <div class="dropGlass">
          <div class="statusBadge">ACTIVO</div>

          <img src="assets/logo-baja1000.png" class="dropLogo" alt="Baja 1000" loading="lazy" decoding="async">

          <div class="dropInfo">
            <h3>BAJA 1000</h3>
            <p>Edición 2025 + piezas limitadas.</p>
            <button class="btnDrop" onclick="event.stopPropagation(); openProductModal('b1000')">VER PRODUCTOS</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('San Felipe 250')">
        <div class="dropBg"></div>
        <div class="dropGlass" style="opacity:.92">
          <img src="assets/logo-sf250.png" class="dropLogo" style="opacity:0.82" alt="San Felipe 250" loading="lazy" decoding="async">
          <div class="dropInfo">
            <h3 style="opacity:.9">PRÓXIMAMENTE</h3>
            <p>San Felipe 250</p>
            <button class="btnDrop" onclick="event.stopPropagation(); notifyDrop('San Felipe 250')">AVÍSAME</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('Baja 500')">
        <div class="dropBg"></div>
        <div class="dropGlass" style="opacity:.92">
          <img src="assets/logo-baja500.png" class="dropLogo" style="opacity:0.82" alt="Baja 500" loading="lazy" decoding="async">
          <div class="dropInfo">
            <h3 style="opacity:.9">PRÓXIMAMENTE</h3>
            <p>Baja 500</p>
            <button class="btnDrop" onclick="event.stopPropagation(); notifyDrop('Baja 500')">AVÍSAME</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('Baja 400')">
        <div class="dropBg"></div>
        <div class="dropGlass" style="opacity:.92">
          <img src="assets/logo-baja400.png" class="dropLogo" style="opacity:0.82" alt="Baja 400" loading="lazy" decoding="async">
          <div class="dropInfo">
            <h3 style="opacity:.9">PRÓXIMAMENTE</h3>
            <p>Baja 400</p>
            <button class="btnDrop" onclick="event.stopPropagation(); notifyDrop('Baja 400')">AVÍSAME</button>
          </div>
        </div>
      </div>
    </div>

    <section class="sponsors" aria-label="Partners">
      <div style="font-family:var(--fontTitle); font-size:20px; color:#999; margin-bottom:18px; letter-spacing:2px;">
        OFFICIAL PARTNERS
      </div>
      <div class="spGrid">
        <img src="assets/logo-ford.png" class="spLogo" alt="Ford" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="assets/logo-bfgoodrich.png" class="spLogo" alt="BFGoodrich" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="assets/logo-rzr.png" class="spLogo" alt="RZR" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="assets/logo-unico.png" class="spLogo" alt="Único Uniformes" onerror="this.style.display='none'" loading="lazy" decoding="async">
      </div>
    </section>
  </main>

  <footer>
    <div class="footGrid">
      <div>
        <h4 style="color:#fff; font-family:var(--fontTitle); font-size:28px; margin:0 0 10px;">ÚNICO UNIFORMES</h4>
        <p style="font-size:14px; line-height:1.6; color:#999; margin:0;">
          Fabricante y Patrocinador oficial.<br>
          Palermo 6106 Interior JK, Anexa Roma, 22614 Tijuana, B.C.<br>
          <b>unicouniformes.com</b><br><br>
          ventas.unicotextil@gmail.com<br>
          WhatsApp: 664 236 8701
        </p>

        <p style="margin:14px 0 0; font-size:12px; color:#888; font-weight:800; line-height:1.5;">
          Los productos están sujetos a disponibilidad. Si un artículo se agota, se notificará para reembolso o alternativa.
        </p>

        <p style="margin:10px 0 0; font-size:11px; color:#777; font-weight:900;">
          Pagos: Stripe · Logística: Envia.com
        </p>
      </div>

      <div>
        <h4 style="color:var(--red); font-family:var(--fontTitle); font-size:28px; margin:0 0 10px;">LEGAL</h4>
        <div>
          <span class="fLink" onclick="showLegal('terms')">Términos y condiciones</span>
          <span class="fLink" onclick="showLegal('privacy')">Aviso de privacidad</span>
          <span class="fLink" onclick="showLegal('shipping')">Envíos y entregas</span>
          <span class="fLink" onclick="showLegal('returns')">Cambios y devoluciones</span>
          <span class="fLink" onclick="showLegal('fiscal')">Facturación</span>
          <span class="fLink" onclick="showLegal('cookies')">Cookies</span>
        </div>
      </div>
    </div>
  </footer>

  <div class="paybar" id="paybar" aria-label="Resumen de compra">
    <div>
      <div class="pbTotal">TOTAL (cobro en MXN)</div>
      <div class="pbPrice" id="pbTotal">
        $0 MXN
        <small>$0 USD</small>
      </div>
    </div>
    <button class="pbBtn" onclick="toggleCart()">VER CARRITO</button>
  </div>

  <aside class="drawer" id="cartDrawer" aria-label="Carrito">
    <div class="dHead">
      <h3 class="dTitle">TU EQUIPO</h3>
      <button class="pmClose" onclick="toggleCart()" style="font-size:28px" aria-label="Cerrar">&times;</button>
    </div>

    <div class="dBody" id="cartBody">
      <div class="cartEmpty">CARRITO VACÍO</div>
    </div>

    <div class="dFoot">
      <div class="sumRow"><span>Subtotal:</span><strong id="subTotalLine">$0 MXN</strong></div>
      <div class="sumRow"><span>Envío:</span><strong id="shipTotalLine">$0 MXN</strong></div>
      <div class="sumRow"><span>Total:</span><strong id="grandTotalLine">$0 MXN</strong></div>
      <div style="margin-top:6px; font-size:11px; color:#666; font-weight:900;" id="usdTotalLine">$0 USD</div>

      <div class="shipBox">
        <div style="font-weight:900; font-size:12px; color:#222; letter-spacing:.05em; text-transform:uppercase;">
          Envío (México)
        </div>
        <div style="margin-top:6px; font-size:12px; color:#444; font-weight:700; line-height:1.35;">
          Calculado vía Envia.com (backend). Ingresa tu C.P. para estimar.
        </div>
        <div class="shipRow">
          <input class="shipInput" id="zipInput" inputmode="numeric" maxlength="5" placeholder="C.P. (ej. 22614)">
          <button class="shipBtn" onclick="quoteShipping()">Calcular</button>
        </div>
        <div style="margin-top:8px; font-size:11px; color:#666; font-weight:900;" id="shipNote"></div>
      </div>

      <button class="dfBtn" id="payBtn" onclick="goCheckout()">IR A PAGAR</button>
      <a class="clearLink" onclick="clearCart()">Vaciar Carrito</a>

      <div style="margin-top:10px; font-size:11px; color:#666; font-weight:900; line-height:1.35;">
        Pago seguro con Stripe. Inventario limitado.
      </div>
    </div>
  </aside>

  <div class="prodModal" id="pmB1000" aria-label="Colección Baja 1000">
    <div class="pmHead">
      <div class="pmTitle">COLECCIÓN BAJA 1000</div>
      <button class="pmClose" onclick="closeProductModal()" aria-label="Cerrar">&times;</button>
    </div>

    <div class="pmBody">
      <div class="pmGrid" id="pmGridB1000"></div>
    </div>
  </div>

  <div class="legalBox" id="legalBox" role="dialog" aria-modal="true">
    <h3 id="lbTitle"></h3>
    <div id="lbBody"></div>
    <button onclick="closeOverlay()" style="background:#000; color:#fff; border:none; padding:12px; width:100%; cursor:pointer; font-weight:900; margin-top:14px; border-radius:12px;">
      CERRAR
    </button>
  </div>

<script>
  const FX_MXN_PER_USD = 17.50;

  const API_CHECKOUT = '/.netlify/functions/create_checkout';
  const API_SHIPPING = '/.netlify/functions/quote_shipping';

  const PATH_ED2025 = "assets/EDICION_2025/";
  const PATH_OTRAS  = "assets/OTRAS_EDICIONES/";

  const DISCOUNT_PCT = 0.30;
  const MARKUP_PCT   = 0.30;

  /* ✅ NUEVO: fallback fijo si Envia truena */
  const FALLBACK_SHIPPING_MXN = 149;

  function calcWas(mxn){
    const base = Number(mxn || 0);
    return Math.round(base * (1 + MARKUP_PCT));
  }
  function calcNowFromWas(was){
    const w = Number(was || 0);
    return Math.round(w * (1 - DISCOUNT_PCT));
  }

  const PRODUCTS_ED2025 = [
    { id:"b1000_pits",         name:"Camisa de Pits Oficial · Baja 1000", baseMXN: 989, img: `${PATH_ED2025}camisa-pits-baja1000.jpg` },
    { id:"b1000_tee_azul",     name:"Camiseta Baja 1000 · Azul",          baseMXN: 439, img: `${PATH_ED2025}camiseta-baja1000-azul.jpg` },
    { id:"b1000_tee_cafe",     name:"Camiseta Baja 1000 · Café",          baseMXN: 439, img: `${PATH_ED2025}camiseta-baja1000-cafe.jpg` },
    { id:"b1000_tee_negra",    name:"Camiseta Baja 1000 · Negra",         baseMXN: 439, img: `${PATH_ED2025}camiseta-baja1000-negra.jpg` },
    { id:"b1000_jacket",       name:"Chamarra Baja 1000 · Edición 2025",   wasMXN: 1980, img: `${PATH_ED2025}chamarra-baja1000.jpg` },
    { id:"world_desert_cafe",  name:"Sudadera SCORE · World Desert (Café)",  baseMXN: 824, img: `${PATH_ED2025}sudadera-world-desert-cafe.jpg` },
    { id:"world_desert_negra", name:"Sudadera SCORE · World Desert (Negra)", baseMXN: 824, img: `${PATH_ED2025}sudadera-world-desert-negra.jpg` },
  ];

  const PRODUCTS_OTRAS = [
    { id:"world_desert_roja",  name:"Sudadera SCORE · World Desert (Roja)", baseMXN: 824, img: `${PATH_OTRAS}sudadera-world-desert-roja.jpg` },
    { id:"world_desert_rosa",  name:"Sudadera SCORE · World Desert (Rosa)", baseMXN: 824, img: `${PATH_OTRAS}sudadera-world-desert-rosa.jpg` },
  ];

  const PRODUCTS_B1000 = [...PRODUCTS_ED2025, ...PRODUCTS_OTRAS];

  const SIZES = ["S","M","L","XL","2XL"];
  const LS_KEY = 'score_cart_v2';
  let cart = JSON.parse(localStorage.getItem(LS_KEY)) || [];

  let shippingMXN = 0;
  let shippingQuoted = false;

  function mxnToUsd(mxn){ return Number(mxn || 0) / FX_MXN_PER_USD; }
  function moneyMXN(n){ return Number(n||0).toLocaleString("es-MX", { style:"currency", currency:"MXN" }); }
  function moneyUSD(n){ return Number(n||0).toLocaleString("en-US", { style:"currency", currency:"USD" }); }

  function escapeHtml(str){
    return String(str||"").replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }

  function toast(msg){
    const el = document.getElementById("toast");
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=> el.classList.remove("show"), 2600);
  }

  function showStatusBanner(title, text){
    const b = document.getElementById("statusBanner");
    document.getElementById("sbTitle").textContent = title;
    document.getElementById("sbText").textContent = text;
    b.classList.add("show");
  }
  function hideStatusBanner(){
    document.getElementById("statusBanner").classList.remove("show");
    try{
      const url = new URL(window.location.href);
      url.searchParams.delete("status");
      window.history.replaceState({}, "", url.toString());
    }catch(e){}
  }

  function notifyDrop(dropName){
    const subject = encodeURIComponent(`Avísame cuando salga: ${dropName}`);
    const body = encodeURIComponent(
      `Hola, quiero que me avisen cuando esté disponible el drop "${dropName}".\n\n` +
      `Mi nombre:\nMi WhatsApp:\nMi correo:\n\nGracias.`
    );
    window.location.href = `mailto:ventas.unicotextil@gmail.com?subject=${subject}&body=${body}`;
  }

  const overlay = document.getElementById('globalOverlay');
  const drawer  = document.getElementById('cartDrawer');
  const legal   = document.getElementById('legalBox');
  const pb      = document.getElementById('paybar');

  function closeOverlay(){
    overlay.classList.remove('active');
    drawer.classList.remove('active');
    legal.classList.remove('active');
    closeProductModal();
    document.body.classList.remove("modalOpen");
  }
  overlay.addEventListener('click', closeOverlay);

  function productPricing(p){
    const was = typeof p.wasMXN === "number" ? p.wasMXN : calcWas(p.baseMXN);
    const now = calcNowFromWas(was);
    return { was, now };
  }

  function pmDivider(label){
    return `
      <div class="pmDivider" aria-hidden="true">
        <div class="bar"></div>
        <div class="label">${escapeHtml(label)}</div>
        <div class="bar"></div>
      </div>
    `;
  }

  function cardTpl(p){
    const { was, now } = productPricing(p);
    const usd = mxnToUsd(now);
    const needsSize = /sudadera|camisa|chamarra|chaqueta|hoodie|playera|camiseta/i.test(p.name);

    return `
      <div class="pCard">
        <div class="pImg">
          <img src="${p.img}" alt="${escapeHtml(p.name)}" loading="lazy" decoding="async">
        </div>
        <div class="pInfo">
          <div class="pName">${escapeHtml(p.name)}</div>

          <div class="pPrice">
            <div class="pWas">${moneyMXN(was)} MXN</div>
            <div class="pNow">
              ${moneyMXN(now)} MXN <span class="pOff">-30%</span>
            </div>
            <small>${moneyUSD(usd)} USD</small>
          </div>

          ${needsSize ? `
            <div class="sizeRow">
              <label for="size_${p.id}">Talla</label>
              <select class="sizeSelect" id="size_${p.id}">
                ${SIZES.map(s => `<option value="${s}">${s}</option>`).join("")}
              </select>
            </div>
          ` : ``}

          <button class="pBtn" onclick="addToCart('${p.id}')">AGREGAR</button>
        </div>
      </div>
    `;
  }

  function renderProductsB1000(){
    const grid = document.getElementById("pmGridB1000");
    grid.innerHTML =
      pmDivider("Edición 2025") +
      PRODUCTS_ED2025.map(cardTpl).join("") +
      pmDivider("Otras ediciones") +
      PRODUCTS_OTRAS.map(cardTpl).join("");
  }

  function openProductModal(id){
    if(id === 'b1000'){
      renderProductsB1000();
      document.getElementById('pmB1000').classList.add('active');
      overlay.classList.add('active');
      document.body.classList.add("modalOpen");
    }
  }
  function closeProductModal(){
    document.querySelectorAll('.prodModal').forEach(el => el.classList.remove('active'));
  }

  function toggleCart(){
    if(drawer.classList.contains('active')) closeOverlay();
    else {
      overlay.classList.add('active');
      drawer.classList.add('active');
      document.body.classList.add("modalOpen");
      updateCartUI();
    }
  }

  function bumpCart(){
    const btn = document.getElementById("cartTrigger");
    if(!btn) return;
    btn.classList.remove("bump");
    void btn.offsetWidth;
    btn.classList.add("bump");
  }

  function addToCart(productId){
    const p = PRODUCTS_B1000.find(x => x.id === productId);
    if(!p) return;

    const { was, now } = productPricing(p);

    const sizeEl = document.getElementById(`size_${productId}`);
    const size = sizeEl ? sizeEl.value : "ÚNICA";

    const key = `${p.id}_${size}`;
    const exist = cart.find(i => i.key === key);

    if(exist) exist.qty++;
    else cart.push({
      key,
      id: p.id,
      name: p.name,
      img: p.img,
      size,
      priceMXN: now,
      wasMXN: was,
      qty: 1
    });

    saveCart();
    updateCartUI();
    bumpCart();
    toast("Agregado al carrito (-30%)");
  }

  function saveCart(){ localStorage.setItem(LS_KEY, JSON.stringify(cart)); }
  function cartSubtotalMXN(){ return cart.reduce((a,b)=> a + (Number(b.priceMXN||0) * Number(b.qty||0)), 0); }
  function cartCount(){ return cart.reduce((a,b)=> a + Number(b.qty||0), 0); }

  function rem(idx){
    cart.splice(idx,1);
    saveCart();
    updateCartUI();
    toast("Producto eliminado");
  }

  function clearCart(){
    if(confirm('¿Vaciar carrito?')){
      cart = [];
      shippingMXN = 0;
      shippingQuoted = false;
      document.getElementById("shipNote").textContent = "";
      saveCart();
      updateCartUI();
      toast("Carrito vacío");
    }
  }

  function updateCartUI(){
    const subtotal = cartSubtotalMXN();
    const totalMXN = subtotal + (shippingMXN || 0);
    const totalUSD = mxnToUsd(totalMXN);

    document.getElementById('cartCount').innerText = cartCount();

    document.getElementById('pbTotal').innerHTML = `
      ${moneyMXN(totalMXN)}
      <small>${moneyUSD(totalUSD)} USD</small>
    `;

    document.getElementById("subTotalLine").textContent = moneyMXN(subtotal);
    document.getElementById("shipTotalLine").textContent = moneyMXN(shippingMXN || 0);
    document.getElementById("grandTotalLine").textContent = moneyMXN(totalMXN);
    document.getElementById("usdTotalLine").textContent = `${moneyUSD(totalUSD)} USD`;

    if(totalMXN > 0) pb.classList.add('visible');
    else pb.classList.remove('visible');

    const payBtn = document.getElementById("payBtn");
    payBtn.disabled = cart.length === 0;

    const body = document.getElementById('cartBody');
    if(cart.length === 0){
      body.innerHTML = "<div class='cartEmpty'>TU CARRITO ESTÁ VACÍO.</div>";
    } else {
      body.innerHTML = cart.map((i, idx) => {
        const lineMXN = (i.priceMXN * i.qty);
        const lineUSD = mxnToUsd(lineMXN);
        return `
          <div class="cItem">
            <img src="${i.img}" class="cImg" alt="${escapeHtml(i.name)}" loading="lazy" decoding="async">
            <div style="flex:1">
              <div style="font-weight:900; font-size:13px; line-height:1.2;">${escapeHtml(i.name)}</div>
              <div class="cMetaLine">Talla: <b>${escapeHtml(i.size)}</b> · Cant: <b>${i.qty}</b></div>
              <div class="cPrice">${moneyMXN(lineMXN)} <span style="color:#666; font-weight:900;">/ ${moneyUSD(lineUSD)}</span></div>
            </div>
            <button onclick="rem(${idx})" style="border:none; background:none; color:#888; font-weight:900; font-size:18px; cursor:pointer;">&times;</button>
          </div>
        `;
      }).join('');
    }
  }

  function cleanBackendMsg(any){
    const s = String(any || "").trim();
    if(!s) return "";
    if(s.startsWith("{") || s.startsWith("[")) return "Backend/Envia respondió con error.";
    if(s.length > 120) return s.slice(0, 120) + "…";
    return s;
  }

  async function quoteShipping(){
    const zip = (document.getElementById("zipInput").value || "").trim();
    const note = document.getElementById("shipNote");

    if(!/^\d{5}$/.test(zip)){
      note.textContent = "Pon un C.P. válido de 5 dígitos.";
      return;
    }
    if(cart.length === 0){
      note.textContent = "Primero agrega productos al carrito.";
      return;
    }

    note.textContent = "Calculando envío…";

    try{
      const res = await fetch(API_SHIPPING, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          zip,
          items: cart.map(i => ({ id:i.id, size:i.size, qty:i.qty }))
        })
      });

      const data = await res.json().catch(()=> ({}));

      if(res.ok && typeof data.mxn === "number"){
        shippingMXN = Math.max(0, Math.round(data.mxn));
        shippingQuoted = true;
        note.textContent = cleanBackendMsg(data.note) || "Envío calculado y aplicado al total.";
        updateCartUI();
        return;
      }

      shippingMXN = FALLBACK_SHIPPING_MXN;
      shippingQuoted = false;

      const msg = cleanBackendMsg(data && (data.error || data.message));
      note.textContent = `Envío estimado aplicado (fallback). Motivo: ${msg || "Envia/Backend 500"}`;
      updateCartUI();

      console.warn("Shipping quote failed:", { status: res.status, data });
    }catch(e){
      shippingMXN = FALLBACK_SHIPPING_MXN;
      shippingQuoted = false;
      note.textContent = "Envío estimado aplicado (fallback). Motivo: error de conexión con backend.";
      updateCartUI();
      console.error("Shipping quote network error:", e);
    }
  }

  async function goCheckout(){
    if(cart.length === 0) return;

    const btn = document.getElementById("payBtn");
    btn.innerText = "PROCESANDO...";
    btn.disabled = true;

    try{
      const res = await fetch(API_CHECKOUT, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          items: cart.map(i => ({ id:i.id, size:i.size, qty:i.qty })),
          shippingMXN: shippingMXN || 0,
          fx: FX_MXN_PER_USD,
          meta: {
            source: "score_store",
            shippingQuoted: shippingQuoted,
            zip: (document.getElementById("zipInput").value || "").trim()
          }
        })
      });

      const data = await res.json().catch(()=> ({}));

      if(res.ok && data && data.url){
        window.location.href = data.url;
        return;
      }

      toast("Error iniciando pago. Revisa create_checkout.");
      console.warn("Checkout failed:", { status: res.status, data });
    }catch(e){
      toast("Error de conexión. Revisa Netlify Functions.");
      console.error("Checkout network error:", e);
    }finally{
      btn.innerText = "IR A PAGAR";
      btn.disabled = cart.length === 0;
    }
  }

  function showLegal(t){
    const titleMap = {
      terms: "Términos y condiciones",
      privacy: "Aviso de privacidad",
      shipping: "Envíos y entregas",
      returns: "Cambios y devoluciones",
      fiscal: "Facturación",
      cookies: "Cookies"
    };

    const bodyMap = {
      terms: `
        <p><b>ÚNICO UNIFORMES</b> opera esta tienda como fabricante y patrocinador oficial de productos físicos.</p>
        <p><b>Disponibilidad:</b> inventario limitado. Tu compra queda confirmada cuando el pago sea aprobado.</p>
        <p><b>Precios:</b> se muestran en MXN y referencia en USD (tipo de cambio informativo: <b>${FX_MXN_PER_USD} MXN/USD</b>). El cobro se procesa en MXN.</p>
        <p><b>Pagos:</b> Stripe. No almacenamos datos bancarios en este sitio.</p>
        <p><b>Soporte:</b> <b>ventas.unicotextil@gmail.com</b> / WhatsApp <b>664 236 8701</b>.</p>
      `,
      privacy: `
        <p><b>Responsable:</b> <b>ÚNICO UNIFORMES</b>.</p>
        <p><b>Datos:</b> contacto y envío (nombre, teléfono, correo, domicilio), info de compra (artículos, montos, estado del pago) y datos fiscales si facturas.</p>
        <p><b>Finalidades:</b> procesar compras, generar envíos, soporte, prevención de fraude y facturación.</p>
        <p><b>Proveedores:</b> pago (Stripe) y logística (Envia.com).</p>
        <p><b>Contacto:</b> ventas.unicotextil@gmail.com.</p>
      `,
      shipping: `
        <p><b>Alcance:</b> Envíos dentro de México.</p>
        <p><b>Cotización:</b> se calcula vía Envia.com (backend). Puede variar por C.P. y paquetería.</p>
        <p><b>Rastreo:</b> se compartirá el número de guía cuando el pedido esté listo.</p>
      `,
      returns: `
        <p><b>Defecto/daño:</b> reportar dentro de <b>7 días naturales</b> con fotos y número de pedido.</p>
        <p><b>Cambios:</b> por talla sujetos a disponibilidad. Envíos pueden aplicar.</p>
      `,
      fiscal: `
        <p><b>CFDI:</b> envía tu constancia fiscal y número de pedido a <b>ventas.unicotextil@gmail.com</b>.</p>
        <p>Solicitar dentro del mismo mes de compra.</p>
      `,
      cookies: `
        <p>Usamos almacenamiento local para el carrito.</p>
        <p>Puedes borrarlo desde tu navegador.</p>
      `
    };

    document.getElementById('lbTitle').innerText = titleMap[t] || "LEGAL";
    document.getElementById('lbBody').innerHTML = bodyMap[t] || "<p>Contenido no disponible.</p>";
    overlay.classList.add('active');
    legal.classList.add('active');
    document.body.classList.add("modalOpen");
  }

  updateCartUI();

  (function initStatus(){
    try{
      const st = new URLSearchParams(window.location.search).get("status");
      if(st === "success"){
        showStatusBanner("✅ Compra confirmada", "Pago recibido. Si pagaste en OXXO, puede tardar en reflejarse según Stripe.");
      } else if(st === "cancel"){
        showStatusBanner("⚠️ Pago cancelado", "No se realizó el cobro. Puedes intentarlo de nuevo cuando quieras.");
      }
    }catch(e){}
  })();
</script>
</body>
</html>