<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<link href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2064%2064%22%3E%0A%3Cdefs%3E%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%221%22%20y2%3D%221%22%3E%0A%3Cstop%20offset%3D%220%22%20stop-color%3D%22%23E10600%22/%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%2300C853%22/%3E%3C/linearGradient%3E%3C/defs%3E%0A%3Crect%20width%3D%2264%22%20height%3D%2264%22%20rx%3D%2214%22%20fill%3D%22%230B0F14%22/%3E%0A%3Cpath%20d%3D%22M-8%2052%20L12%2072%20L72%2012%20L52%20-8%20Z%22%20fill%3D%22url%28%23g%29%22%20opacity%3D%220.95%22/%3E%0A%3Ccircle%20cx%3D%2250%22%20cy%3D%2214%22%20r%3D%226%22%20fill%3D%22%23E10600%22/%3E%0A%3C/svg%3E" rel="icon" type="image/svg+xml"/>
<link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAD...REEMPLAZO_COMPLETO_EN_LA_PARTE_2..." rel="apple-touch-icon"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/>
<title>SCORE STORE ‚Äî Tienda Oficial</title>
<meta content="Tienda oficial de merch SCORE. Equipamiento aut√©ntico fabricado en Tijuana por √öNICO UNIFORMES." name="description"/>
<link href="https://scorestore.netlify.app/" rel="canonical"/>
<meta content="#0b0f14" name="theme-color"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="SCORE STORE" name="apple-mobile-web-app-title"/>
<link href="/site.webmanifest" rel="manifest"/>
<link href="/sitemap.xml" rel="sitemap" type="application/xml"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link as="style" href="/css/styles.css" rel="preload"/>
<link href="/css/styles.css" rel="stylesheet"/>
<link as="fetch" crossorigin="" href="/data/catalog.json" rel="preload"/>
<link as="fetch" crossorigin="" href="/data/promos.json" rel="preload"/>
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script async="" defer="" src="https://js.stripe.com/v3/"></script>
</head>
<body>
<div class="bgWrap">
<div aria-hidden="true" class="bgImg"></div>
<div aria-hidden="true" class="bgOverlay"></div>
</div>
<header class="topbar">
<div class="container topbarInner">
<a class="brand" href="/">
<img alt="SCORE STORE" class="brandLogo" decoding="async" height="44" loading="eager" src="/assets/logo-score.webp" width="160"/>
</a>
<nav class="nav">
<button class="navBtn" onclick="scrollToId('drops')" type="button">Drops</button>
<button class="navBtn" onclick="scrollToId('catalog')" type="button">Cat√°logo</button>
<button class="navBtn" onclick="scrollToId('shipping')" type="button">Env√≠os</button>
<button class="navBtn cartBtn" id="openCartBtn" onclick="openDrawer()" type="button">
<span class="cartIcon" aria-hidden="true">üõí</span>
<span id="cartCount">0</span>
</button>
</nav>
</div>
</header>
<main>
<section class="hero" id="top">
<div class="container heroInner">
<div class="heroText">
<h1>SCORE STORE</h1>
<p class="lead">Tienda oficial de merch SCORE. Equipamiento aut√©ntico fabricado en Tijuana por √öNICO UNIFORMES.</p>
<div class="heroActions">
<button class="btn primary" onclick="scrollToId('catalog')" type="button">Comprar ahora</button>
<button class="btn ghost" onclick="scrollToId('drops')" type="button">Ver Drops</button>
</div>
<div class="heroBadges">
<span class="badge">Pagos con tarjeta</span>
<span class="badge">Env√≠o a todo M√©xico</span>
<span class="badge">Drops limitados</span>
</div>
</div>
<div class="heroCard">
<div class="heroCardTop">
<div class="heroCardTitle">Drop destacado</div>
<div class="heroCardTag">LIMITADO</div>
</div>
<div class="heroCardBody">
<div class="heroCardName" id="featuredName">Cargando...</div>
<div class="heroCardPrice" id="featuredPrice"></div>
<div class="heroCardCta">
<button class="btn primary full" id="featuredBtn" type="button">Ver producto</button>
</div>
<div class="heroCardNote">* Stock sujeto a disponibilidad.</div>
</div>
</div>
</div>
</section>
<section class="section" id="drops">
<div class="container">
<div class="sectionHead">
<h2>Drops</h2>
<p>Ediciones limitadas, art√≠culos de colecci√≥n y equipo aut√©ntico del desierto.</p>
</div>
<div class="grid" id="dropsGrid"></div>
</div>
</section>
<section class="section" id="catalog">
<div class="container">
<div class="sectionHead">
<h2>Cat√°logo</h2>
<p>Selecciona tu talla y agrega al carrito. Checkout seguro con Stripe.</p>
</div>
<div class="filters">
<input class="search" id="search" placeholder="Buscar producto..." type="search"/>
<select class="select" id="filterCat">
<option value="all">Todas las categor√≠as</option>
</select>
<select class="select" id="filterSize">
<option value="all">Todas las tallas</option>
</select>
</div>
<div class="grid" id="catalogGrid"></div>
</div>
</section>
<section class="section" id="shipping">
<div class="container">
<div class="sectionHead">
<h2>Env√≠os</h2>
<p>Cotiza tu env√≠o con tu c√≥digo postal (Envia.com).</p>
</div>
<div class="shipBox">
<div class="shipRow">
<label class="lbl" for="zip">C√≥digo postal</label>
<input class="input" id="zip" inputmode="numeric" maxlength="5" placeholder="Ej. 22000" type="text"/>
</div>
<div class="shipRow">
<button class="btn primary" id="quoteBtn" type="button">Cotizar env√≠o</button>
</div>
<div class="shipResult" id="shipResult"></div>
</div>
</div>
</section>
<section class="section partners" id="partners">
<div class="container">
<div class="sectionHead">
<h2>Partners</h2>
<p>Marcas y aliados que impulsan el desierto.</p>
</div>
<div class="partnersGrid">
<img alt="Monster Energy" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-monster.png" width="150"/>
<img alt="√öNICO Uniformes" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-unico.webp" width="150"/>
<img alt="BFGoodrich" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-bfgodrich.webp" width="150"/>
<img alt="Ford" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-ford.webp" width="150"/>
<img alt="RZR" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-rzr.webp" width="150"/>
</div>
</div>
</section>
</main>
<div class="overlay" id="overlay" onclick="closeAll()" aria-hidden="true"></div>
<aside aria-hidden="true" aria-labelledby="drawerTitle" aria-modal="true" class="drawer" id="drawer" role="dialog" tabindex="-1">
<div class="drawerHead">
<h3 class="dTitle" id="drawerTitle">Carrito</h3>
<button aria-label="Cerrar carrito" class="iconBtn" onclick="closeAll()" type="button">‚úï</button>
</div>
<div class="drawerBody">
<div class="cartItems" id="cartItems"></div>
<div class="cartEmpty" id="cartEmpty">Tu carrito est√° vac√≠o.</div>
</div>
<div class="drawerFoot">
<div class="totals">
<div class="row">
<span>Subtotal</span>
<strong id="subTotal">$0</strong>
</div>
<div class="row">
<span>Env√≠o</span>
<strong id="shipTotal">‚Äî</strong>
</div>
<div class="row big">
<span>Total</span>
<strong id="grandTotal">$0</strong>
</div>
</div>
<button class="btn primary full" id="checkoutBtn" type="button">Pagar</button>
<div class="smallNote">Pago seguro con Stripe. Al pagar aceptas nuestros t√©rminos.</div>
</div>
</aside>
<div aria-atomic="true" aria-live="polite" class="toast" id="toast" role="status">Listo</div>
<script>
const DEBUG = (location.hostname === 'localhost' || location.hostname === '127.0.0.1');

/* ===== Helpers ===== */
const $ = (id)=>document.getElementById(id);
const money = (n)=> new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(n||0);

function scrollToId(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:"smooth",block:"start"});
}

/* ===== Drawer ===== */
function openDrawer(){
  $("drawer").classList.add("open");
  $("overlay").classList.add("open");
  document.body.classList.add("lock");
}

function closeAll(){
  $("drawer").classList.remove("open");
  $("overlay").classList.remove("open");
  document.body.classList.remove("lock");
}

/* ===== Toast ===== */
let toastTimer = null;
function showToast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.classList.remove("show"), 2200);
}

/* ===== Cart ===== */
const CART_KEY = "score_cart_v1";
let cart = [];
let catalog = [];
let shipQuote = null;

function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
function loadCart(){
  try{
    cart = JSON.parse(localStorage.getItem(CART_KEY) || "[]");
  }catch(e){
    if (DEBUG) console.error(e);
    cart = [];
  }
}

function cartCount(){
  return cart.reduce((a,i)=>a + (i.qty||0), 0);
}

function cartSubtotal(){
  return cart.reduce((a,i)=>a + (i.price||0)*(i.qty||0), 0);
}

function updateTotals(){
  $("cartCount").textContent = cartCount();
  $("subTotal").textContent = money(cartSubtotal());
  $("shipTotal").textContent = shipQuote ? money(shipQuote.price) : "‚Äî";
  const total = cartSubtotal() + (shipQuote ? shipQuote.price : 0);
  $("grandTotal").textContent = money(total);
}

function renderCart(){
  const wrap = $("cartItems");
  wrap.innerHTML = "";
  $("cartEmpty").style.display = cart.length ? "none" : "block";

  cart.forEach((item, idx)=>{
    const row = document.createElement("div");
    row.className = "cartRow";
    row.innerHTML = `
      <div class="cInfo">
        <div class="cName">${item.name}</div>
        <div class="cMeta">${item.variant || ""}</div>
        <div class="cPrice">${money(item.price)}</div>
      </div>
      <div class="cQty">
        <button class="qtyBtn" type="button" aria-label="Menos" data-act="dec" data-idx="${idx}">‚àí</button>
        <span class="qtyNum">${item.qty}</span>
        <button class="qtyBtn" type="button" aria-label="M√°s" data-act="inc" data-idx="${idx}">+</button>
      </div>
      <button class="iconBtn danger" type="button" aria-label="Eliminar" data-act="del" data-idx="${idx}">üóë</button>
    `;
    wrap.appendChild(row);
  });

  wrap.querySelectorAll("[data-act]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const idx = Number(btn.getAttribute("data-idx"));
      const act = btn.getAttribute("data-act");
      if(!cart[idx]) return;
      if(act==="inc") cart[idx].qty++;
      if(act==="dec") cart[idx].qty = Math.max(1, cart[idx].qty-1);
      if(act==="del") cart.splice(idx,1);
      saveCart();
      renderCart();
      updateTotals();
    });
  });
}

/* ===== Catalog ===== */
function buildFilters(){
  const cats = new Set();
  const sizes = new Set();
  catalog.forEach(p=>{
    if(p.category) cats.add(p.category);
    (p.sizes||[]).forEach(s=> sizes.add(s));
  });

  const catSel = $("filterCat");
  cats.forEach(c=>{
    const o = document.createElement("option");
    o.value = c; o.textContent = c;
    catSel.appendChild(o);
  });

  const sizeSel = $("filterSize");
  sizes.forEach(s=>{
    const o = document.createElement("option");
    o.value = s; o.textContent = s;
    sizeSel.appendChild(o);
  });
}

function matchesFilters(p){
  const q = ($("search").value||"").toLowerCase().trim();
  const cat = $("filterCat").value;
  const size = $("filterSize").value;

  if(q && !(`${p.name} ${p.category||""}`.toLowerCase().includes(q))) return false;
  if(cat !== "all" && p.category !== cat) return false;
  if(size !== "all" && !(p.sizes||[]).includes(size)) return false;
  return true;
}

function renderCatalog(){
  const grid = $("catalogGrid");
  grid.innerHTML = "";

  const filtered = catalog.filter(matchesFilters);
  filtered.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card prodCard";
    const img = p.image || "/assets/logo-score.webp";
    const price = p.price || 0;

    const sizeOptions = (p.sizes||[]).map(s=>`<option value="${s}">${s}</option>`).join("");
    card.innerHTML = `
      <div class="prodImg">
        <img src="${img}" alt="${p.name}" loading="lazy" decoding="async" onerror="this.src='/assets/logo-score.webp'">
      </div>
      <div class="prodBody">
        <div class="prodTop">
          <div class="prodName">${p.name}</div>
          <div class="prodPrice">${money(price)}</div>
        </div>
        <div class="prodMeta">${p.category || ""}</div>
        <div class="prodActions">
          <select class="select sizePick" ${sizeOptions ? "" : "disabled"}>
            ${sizeOptions || `<option value="">Sin talla</option>`}
          </select>
          <button class="btn primary addBtn" type="button">Agregar</button>
        </div>
      </div>
    `;
    card.querySelector(".addBtn").addEventListener("click", ()=>{
      const size = card.querySelector(".sizePick").value || "";
      const variant = size ? `Talla ${size}` : "";
      cart.push({ id:p.id, name:p.name, variant, price, qty:1 });
      saveCart();
      updateTotals();
      renderCart();
      showToast("Agregado al carrito");
    });

    grid.appendChild(card);
  });
}

/* ===== Featured ===== */
function setFeatured(){
  const p = catalog.find(x=>x.featured) || catalog[0];
  if(!p) return;
  $("featuredName").textContent = p.name;
  $("featuredPrice").textContent = money(p.price||0);
  $("featuredBtn").onclick = ()=> scrollToId("catalog");
}

/* ===== Shipping Quote (Envia) ===== */
async function quoteShipping(){
  const zip = ($("zip").value||"").trim();
  if(!/^\d{5}$/.test(zip)){
    showToast("Escribe un CP v√°lido (5 d√≠gitos)");
    return;
  }
  $("shipResult").textContent = "Cotizando...";
  shipQuote = null;
  updateTotals();

  try{
    const res = await fetch("/.netlify/functions/quote_shipping",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ zip })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data?.error || "Error al cotizar");
    shipQuote = data;
    $("shipResult").innerHTML = `<strong>${data.carrier}</strong> ¬∑ ${money(data.price)} ¬∑ ${data.eta || ""}`;
    updateTotals();
  }catch(e){
    if (DEBUG) console.error(e);
    $("shipResult").textContent = "No se pudo cotizar. Intenta de nuevo.";
  }
}

$("quoteBtn").addEventListener("click", quoteShipping);

/* ===== Checkout (Stripe) ===== */
async function checkout(){
  if(!cart.length){
    showToast("Tu carrito est√° vac√≠o");
    return;
  }
  $("checkoutBtn").disabled = true;
  $("checkoutBtn").textContent = "PROCESANDO...";
  try{
    const res = await fetch("/.netlify/functions/create_checkout",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ cart, ship: shipQuote })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data?.error || "No se pudo iniciar checkout");

    const stripe = Stripe(data.publicKey);
    await stripe.redirectToCheckout({ sessionId: data.sessionId });
  }catch(e){
    if (DEBUG) console.error(e);
    showToast("No se pudo iniciar el pago");
  }finally{
    $("checkoutBtn").disabled = false;
    $("checkoutBtn").textContent = "Pagar";
  }
}

$("checkoutBtn").addEventListener("click", checkout);

/* ===== Init ===== */
async function init(){
  loadCart();
  updateTotals();
  renderCart();

  try{
    const res = await fetch("/data/catalog.json", { cache:"no-store" });
    catalog = await res.json();
  }catch(e){
    if (DEBUG) console.log('Usando local');
    catalog = [];
  }

  buildFilters();
  renderCatalog();
  setFeatured();

  ["search","filterCat","filterSize"].forEach(id=>{
    $(id).addEventListener("input", renderCatalog);
    $(id).addEventListener("change", renderCatalog);
  });
}

init();

/* ===== SW Register ===== */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", async ()=>{
    try{
      const reg = await navigator.serviceWorker.register("/sw.js");
      // fuerza actualizaci√≥n si hay nuevo SW
      if (reg.waiting) reg.waiting.postMessage({ type:"SKIP_WAITING" });
    }catch(e){
      if (DEBUG) console.error(e);
    }
  });
}

/* === A11Y: Drawer focus + ESC === */
let _lastFocus = null;
function _getFocusable(container){
  return Array.from(container.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'))
    .filter(el => el.offsetParent !== null);
}
function _setDrawerA11y(isOpen){
  const d = document.getElementById('drawer');
  const o = document.getElementById('overlay');
  if (!d || !o) return;
  d.setAttribute('aria-hidden', String(!isOpen));
  o.setAttribute('aria-hidden', String(!isOpen));
}
document.addEventListener('keydown', (e) => {
  const d = document.getElementById('drawer');
  if (!d) return;
  const isOpen = d.classList.contains('open');
  if (!isOpen) return;

  if (e.key === 'Escape') {
    e.preventDefault();
    closeAll();
    return;
  }
  if (e.key === 'Tab') {
    const focusables = _getFocusable(d);
    if (focusables.length === 0) return;
    const first = focusables[0];
    const last = focusables[focusables.length - 1];
    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault(); last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault(); first.focus();
    }
  }
});

// Patch openDrawer/closeAll sin cambiar tu UX
(function(){
  const _open = window.openDrawer;
  const _close = window.closeAll;
  if (typeof _open === 'function') {
    window.openDrawer = function(){
      _lastFocus = document.activeElement;
      _open();
      _setDrawerA11y(true);
      const d = document.getElementById('drawer');
      if (d) {
        const focusables = _getFocusable(d);
        (focusables[0] || d).focus?.();
      }
    };
  }
  if (typeof _close === 'function') {
    window.closeAll = function(){
      _close();
      _setDrawerA11y(false);
      if (_lastFocus && _lastFocus.focus) _lastFocus.focus();
    };
  }
})();
</script>
<footer class="footer">
<div class="container footerInner">
<div class="fCol">
<div class="fTitle">SCORE STORE</div>
<p class="fText">Merch oficial y equipamiento aut√©ntico del desierto. Fabricado en Tijuana por √öNICO UNIFORMES.</p>
</div>
<div class="fCol">
<div class="fTitle">Links</div>
<a class="fLink" href="#drops">Drops</a>
<a class="fLink" href="#catalog">Cat√°logo</a>
<a class="fLink" href="#shipping">Env√≠os</a>
</div>
<div class="fCol">
<div class="fTitle">Eventos</div>
<div class="events">
<img alt="Baja 1000" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-baja1000.webp" width="150"/>
<img alt="Baja 500" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-baja500.webp" width="150"/>
<img alt="Baja 400" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-baja400.webp" width="150"/>
<img alt="San Felipe 250" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-sf250.webp" width="150"/>
<img alt="World Desert Championship" class="pLogo" decoding="async" height="50" loading="lazy" src="/assets/logo-world-desert.webp" width="150"/>
</div>
</div>
</div>
<div class="copy">¬© 2025 SCORE STORE ‚Äî Fabricante y Patrocinador Oficial de SCORE International. Tijuana B.C.</div>
</footer>
</body>
</html>