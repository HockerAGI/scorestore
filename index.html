<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#E10600" />
  <meta name="color-scheme" content="light dark" />

  <title>SCORE Store | Tienda Oficial</title>
  <meta name="description" content="Tienda oficial de merch SCORE. Fabricado en Tijuana por ÚNICO UNIFORMES, fabricante y patrocinador oficial. Ediciones limitadas por evento." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://scorestore.netlify.app/" />

  <link rel="manifest" href="/site.webmanifest" />

  <link rel="icon" href="/assets/icons-score.svg" type="image/svg+xml" />
  <link rel="icon" href="/assets/logo-score.png" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/logo-score.png" />

  <meta property="og:title" content="SCORE Store | Tienda Oficial" />
  <meta property="og:description" content="Merch oficial fabricado en Tijuana por ÚNICO UNIFORMES. Ediciones limitadas." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://scorestore.netlify.app/" />
  <meta property="og:image" content="https://scorestore.netlify.app/assets/hero.png" />
  
  <script src="https://js.stripe.com/v3/"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* --- FUENTES --- */
      --fontTitle: "Teko", sans-serif;
      --fontBody: "Inter", sans-serif;

      /* --- COLORES BRAND --- */
      --red: #E10600;
      --carbon: #0b0f14;
      --sand: #f2f2f2;
      --green: #00C853;

      /* --- MODULAR THEME (Desert Racing Default) --- */
      /* Tint general del fondo (atmosfera) */
      --themeTint: rgba(72, 49, 33, 0.05); 
      /* Brillo o acentos de luz */
      --themeGlow: rgba(225, 160, 0, 0.08);
      /* Color de las partículas (Polvo) */
      --dustColor: rgba(190, 140, 60, 0.4); 

      --pageBg: url("/assets/fondo-pagina-score.png");
      --pageBgOpacity: .82;

      /* --- UI TOKENS --- */
      --shadow: 0 20px 50px rgba(0,0,0,.18);
      --radius: 18px;
      --border: rgba(0,0,0,.10);
      
      /* Animaciones Racing */
      --easeOut: cubic-bezier(0.16, 1, 0.3, 1); /* Movimiento rápido y frenado suave */
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    html,body{height:100%}
    body{
      margin:0; font-family: var(--fontBody); color:#111;
      background-color: var(--sand); overflow-x:hidden;
      padding-bottom: 120px; position: relative;
    }
    body.modalOpen{ overflow:hidden; }
    [id]{ scroll-margin-top: 92px; }

    /* FONDO FIJO */
    body::after{
      content:""; position:fixed; inset:0;
      background-image: var(--pageBg); background-size: cover;
      background-position: center; opacity: var(--pageBgOpacity);
      z-index:-6; pointer-events:none;
    }

    /* --- ANIMACIÓN: ATMÓSFERA BAJA (Polvo/Calor) --- */
    .themeAtmosphere{
      position:fixed; inset:0; pointer-events:none; z-index:-5;
      background: linear-gradient(180deg, var(--themeTint), transparent 60%);
      mix-blend-mode: multiply;
    }
    
    .bajaDust{
      position:fixed; inset:0; pointer-events:none; z-index:-4; opacity:1;
      background-image: 
        radial-gradient(circle, var(--dustColor) 1px, transparent 1.5px),
        radial-gradient(circle, var(--dustColor) 1px, transparent 1.5px);
      background-size: 400px 400px, 300px 300px;
      background-position: 0 0, 200px 150px;
      animation: dustFloat 20s linear infinite;
    }
    @keyframes dustFloat{
      0%{ transform: translateY(0) translateX(0); }
      50%{ transform: translateY(-40px) translateX(20px); }
      100%{ transform: translateY(0) translateX(0); }
    }

    /* --- UI COMPONENTS --- */
    .overlay{
      position:fixed; inset:0; background: rgba(0,0,0,.6);
      opacity:0; pointer-events:none; z-index:95; transition: opacity .2s ease;
    }
    .overlay.active{ opacity:1; pointer-events:auto; }

    .toast{
      position:fixed; left:50%; bottom:100px; transform:translateX(-50%);
      background:#111; color:#fff; padding:12px 24px; border-radius:50px;
      font-weight:700; opacity:0; pointer-events:none; z-index:300;
      transition: opacity .2s, transform .2s; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(-10px); }

    .wrap{ width:min(1200px, 94vw); margin:0 auto; padding-top: 90px; padding-bottom: 60px; }

    /* TOPBAR */
    .topbar{
      position:fixed; top:0; left:0; right:0; z-index:90;
      background: rgba(245,245,245,0.96); border-bottom: 3px solid var(--red);
      backdrop-filter: blur(12px); box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .topInner{
      width:min(1200px, 94vw); margin:0 auto; height:76px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand img{ height:56px; width:auto; display:block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
    
    .navRight{ display:flex; align-items:center; gap:12px; }
    .pill{
      display:flex; align-items:center; height:36px; padding:0 14px;
      border-radius:99px; background:#111; color:#fff;
      font-weight:900; font-size:12px; letter-spacing:.05em;
      border: 1px solid rgba(255,255,255,0.2);
    }
    @media (max-width: 600px){ .pill{ display:none; } }

    .cartTrigger{
      background: #0c0f14; color:#fff; border:none; height:50px; padding:0 20px;
      display:flex; align-items:center; gap:10px; cursor:pointer;
      font-family: var(--fontTitle); font-weight:700; font-size:24px;
      clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
      transition: transform .1s var(--easeOut);
    }
    .cartTrigger:active{ transform: scale(0.95); }
    .cartCount{ background:var(--red); font-size:12px; padding:2px 6px; border-radius:4px; font-weight:900; }

    /* HERO SECTION */
    .hero{
      position:relative; border-radius: 18px; overflow:hidden; min-height: 520px;
      display:flex; align-items:center; background: #0b0f14; color:#fff;
      box-shadow: var(--shadow); margin-bottom: 40px;
    }
    .heroBg{
      position:absolute; inset:0; background: url('/assets/hero.png') center/cover;
      opacity:.9; filter: contrast(1.1); transform: scale(1.02);
    }
    .heroOverlay{
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    }
    .heroContent{ position:relative; z-index:2; padding: 40px; max-width: 800px; }
    
    .tagline{
      background: var(--red); color:#fff; padding: 6px 14px;
      font-family: var(--fontTitle); font-size:20px; font-weight:700;
      transform: skew(-12deg); display:inline-block; margin-bottom: 16px;
    }
    .hero h1{
      font-family: var(--fontTitle); font-size: clamp(48px, 9vw, 92px);
      line-height: .9; margin: 0 0 16px; text-transform: uppercase;
      text-shadow: 0 4px 30px rgba(0,0,0,0.8);
    }
    .sub{
      font-size: 17px; line-height: 1.5; color: rgba(255,255,255,.9);
      margin-bottom: 24px; border-left: 4px solid var(--red); padding-left: 16px;
      max-width: 600px; font-weight: 500;
    }

    .ctaRow{ display:flex; gap:12px; flex-wrap:wrap; }
    .btn{
      border:none; cursor:pointer; font-weight: 900; text-transform: uppercase;
      border-radius: 12px; padding: 16px 28px; font-size: 14px; letter-spacing:.05em;
      transition: all .2s var(--easeOut); display:inline-flex; align-items:center;
      justify-content:center; text-decoration:none;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.25); }
    .btn:active{ transform: scale(0.97); }
    .btn.primary{ background:#fff; color:#111; }
    .btn.secondary{ background:rgba(0,0,0,0.6); color:#fff; border:1px solid rgba(255,255,255,0.3); backdrop-filter:blur(4px); }

    /* SECTION HEADERS */
    .secHeader{ display:flex; align-items:baseline; justify-content:space-between; margin-bottom: 20px; }
    .secHeader h2{ margin:0; font-family:var(--fontTitle); font-size:42px; text-transform:uppercase; }
    .meta{ font-weight:900; color:rgba(0,0,0,0.5); font-size:12px; letter-spacing:1px; text-transform:uppercase; }

    /* CARDS GRID */
    .editionsGrid{
      display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px; margin-bottom: 40px;
    }
    .editionCard{
      position:relative; border-radius: 18px; overflow:hidden;
      min-height: 280px; background: #111; cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      transition: transform .2s var(--easeOut), box-shadow .2s var(--easeOut);
    }
    .editionCard:hover{ transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.25); }
    .editionCard:active{ transform: scale(0.98); }
    
    .editionBg{
      position:absolute; inset:0; opacity:0.6;
      background-size:cover; background-position:center;
      transition: opacity .3s;
    }
    .editionCard:hover .editionBg{ opacity: 0.8; }
    
    .editionLayer{
      position:absolute; inset:0; padding:20px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
    }
    .statusBadge{
      position:absolute; top:14px; left:14px; background:var(--red); color:#fff;
      font-weight:900; font-size:11px; padding:4px 8px; border-radius:4px;
      letter-spacing:1px; text-transform:uppercase;
    }
    .editionLogo{
      width:85%; height:auto; object-fit:contain; margin-bottom:20px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
    }
    .editionBtn{
      background:#fff; color:#111; border:none; padding:10px 20px;
      font-weight:900; text-transform:uppercase; font-size:12px; letter-spacing:1px;
      clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
      transition: background .2s;
    }
    .editionCard:hover .editionBtn{ background: var(--red); color:#fff; }

    /* HIGHLIGHTS STRIP */
    .highlight{
      background: #fff; border-radius: 18px; padding: 6px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05);
    }
    .highlightInner{ display:flex; gap:6px; flex-wrap:wrap; }
    .hBox{
      flex:1; min-width: 280px; background: #f9f9f9; padding: 20px; border-radius: 14px;
      display:flex; flex-direction:column; justify-content:center;
    }
    .hTitle{ font-weight:900; font-size:12px; letter-spacing:1px; color:rgba(0,0,0,0.5); text-transform:uppercase; margin-bottom:8px; display:flex; align-items:center; gap:8px;}
    .hTxt{ font-weight:800; font-size:15px; margin:0; line-height:1.4; }

    /* PARTNERS */
    .partnersStrip{
      margin-top: 40px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 20px;
      text-align:center;
    }
    .spGrid{
      display:flex; justify-content:center; gap: 30px; flex-wrap:wrap;
      opacity: 0.7; mix-blend-mode: multiply; margin-top: 10px;
    }
    .spLogo{ height: 40px; width:auto; object-fit:contain; filter: grayscale(100%); transition: filter .3s; }
    .spLogo:hover{ filter: grayscale(0%); }

    /* FOOTER */
    footer{ margin-top: 80px; background: #111; color:#fff; padding: 60px 0; border-top: 4px solid var(--red); }
    .footGrid{ width:min(1200px, 94vw); margin:0 auto; display:grid; grid-template-columns: 1fr 1fr; gap:40px; }
    @media(max-width:768px){ .footGrid{ grid-template-columns: 1fr; } }
    
    details.fLegal{
      background: rgba(255,255,255,0.05); margin-bottom: 10px; border-radius: 8px; overflow:hidden;
    }
    details.fLegal summary{
      padding: 16px; font-weight: 700; cursor:pointer; list-style:none;
      display:flex; justify-content:space-between; align-items:center;
      text-transform:uppercase; font-size:13px; letter-spacing:1px;
    }
    details.fLegal summary::after{ content:"+"; font-weight:900; color:var(--red); font-size:18px; }
    details.fLegal[open] summary::after{ content:"-"; color:#fff; }
    .fLegalBody{ padding: 0 16px 16px; font-size:14px; color:#aaa; line-height:1.6; }

    /* DRAWER & MODALS */
    .drawer{
      position:fixed; top:0; right:0; bottom:0; width:min(450px, 100vw);
      background:#fff; z-index:200; transform:translateX(105%);
      transition: transform .3s var(--easeOut); box-shadow: -10px 0 50px rgba(0,0,0,0.2);
      display:flex; flex-direction:column;
    }
    .drawer.active{ transform:translateX(0); }
    
    .modal{
      position:fixed; inset:40px; background:#fff; z-index:250;
      border-radius:20px; transform: scale(0.95); opacity:0; pointer-events:none;
      transition: .2s var(--easeOut); display:flex; flex-direction:column;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    @media(max-width:600px){ .modal{ inset:10px; } }
    .modal.active{ transform: scale(1); opacity:1; pointer-events:auto; }

    .dHead, .mHead{ padding: 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
    .dBody, .mBody{ flex:1; overflow-y:auto; padding:20px; }
    
    /* INPUTS MOBILE FIX */
    .input{
      width:100%; height:48px; border-radius:10px; border:1px solid #ddd;
      padding:0 14px; font-weight:600; font-family:var(--fontBody);
      font-size:16px !important; /* Fix Zoom iOS */
      margin-bottom:10px; appearance:none; background:#fff;
    }
    .input:focus{ outline:none; border-color:var(--red); }

    /* CARD PRODUCTO */
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:16px; }
    .card{ border:1px solid #eee; border-radius:14px; padding:10px; text-align:center; }
    .card img{ width:100%; aspect-ratio:1; object-fit:contain; mix-blend-mode:multiply; }
    .card .name{ font-weight:800; font-size:14px; margin:8px 0; line-height:1.2; }
    
    /* PAYBAR MOBILE */
    .paybar{
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%) translateY(100px);
      width:min(94vw, 600px); background:#fff; padding:14px 20px; border-radius:16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index:150;
      display:flex; justify-content:space-between; align-items:center;
      transition: transform .3s var(--easeOut);
    }
    .paybar.visible{ transform:translateX(-50%) translateY(0); }

  </style>
</head>
<body>

  <div class="themeAtmosphere"></div>
  <div class="bajaDust"></div>

  <div class="overlay" id="overlay"></div>
  <div class="toast" id="toast">Notificación</div>

  <header class="topbar">
    <div class="topInner">
      <a class="brand" href="/"><img src="/assets/logo-score.png" alt="SCORE"></a>
      <div class="navRight">
        <div class="pill">MX + <b>TIJUANA</b></div>
        <button class="cartTrigger" id="openCart">
          SCORE STORE <span class="cartCount" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="heroBg"></div>
      <div class="heroOverlay"></div>
      <div class="heroContent">
        <div class="tagline">OFFICIAL MERCH</div>
        <h1>SCORE INTERNATIONAL</h1>
        <p class="sub">
          Fabricado en Tijuana por <b>ÚNICO UNIFORMES</b>. Patrocinador oficial.
          Productos auténticos listos para el desierto. Ediciones limitadas.
        </p>
        <div class="ctaRow">
          <button class="btn primary" onclick="document.querySelector('.editionsGrid').scrollIntoView({behavior:'smooth'})">Ver Colecciones</button>
          <button class="btn secondary" onclick="openDrawer()">Mi Carrito</button>
        </div>
      </div>
    </section>

    <div class="secHeader" id="productos">
      <h2>Ediciones</h2>
      <div class="meta">Official Baja Merch</div>
    </div>

    <div class="editionsGrid">
      <div class="editionCard" onclick="loadProducts('EDICION_2025', 'Baja 1000')">
        <div class="editionBg" style="background-image:url('/assets/baja1000-texture.png')"></div>
        <div class="editionLayer">
          <div class="statusBadge">ACTIVO</div>
          <img src="/assets/logo-baja1000.png" class="editionLogo" alt="Baja 1000">
          <button class="editionBtn">Ver Productos</button>
        </div>
      </div>
      
      <div class="editionCard" onclick="loadProducts('BAJA_500', 'Baja 500')">
        <div class="editionBg" style="background-color:#222;"></div>
        <div class="editionLayer">
          <div class="statusBadge">DISPONIBLE</div>
          <img src="/assets/logo-baja500.png" class="editionLogo" alt="Baja 500">
          <button class="editionBtn">Ver Productos</button>
        </div>
      </div>

      <div class="editionCard" onclick="loadProducts('BAJA_400', 'Baja 400')">
        <div class="editionBg" style="background-color:#222;"></div>
        <div class="editionLayer">
          <div class="statusBadge">DISPONIBLE</div>
          <img src="/assets/logo-baja400.png" class="editionLogo" alt="Baja 400">
          <button class="editionBtn">Ver Productos</button>
        </div>
      </div>

      <div class="editionCard" onclick="loadProducts('SF_250', 'San Felipe 250')">
        <div class="editionBg" style="background-color:#222;"></div>
        <div class="editionLayer">
          <div class="statusBadge">DISPONIBLE</div>
          <img src="/assets/logo-sf250.png" class="editionLogo" alt="San Felipe 250">
          <button class="editionBtn">Ver Productos</button>
        </div>
      </div>
    </div>

    <section class="highlight">
      <div class="highlightInner">
        <div class="hBox">
          <div class="hTitle"><span style="color:var(--green)">●</span> Fabricación Oficial</div>
          <p class="hTxt">Hecho por <b>ÚNICO UNIFORMES</b> en Tijuana, B.C. Materiales premium y auténticos.</p>
        </div>
        <div class="hBox">
          <div class="hTitle"><span style="color:var(--red)">●</span> Edición Limitada</div>
          <p class="hTxt">Lanzamientos exclusivos por evento. Si está disponible, es ahora.</p>
        </div>
      </div>
    </section>

    <section class="partnersStrip">
      <div class="spGrid">
        <img src="/assets/logo-ford.png" class="spLogo" alt="Ford" onerror="this.style.display='none'">
        <img src="/assets/logo-rzr.png" class="spLogo" alt="RZR" onerror="this.style.display='none'">
        <img src="/assets/logo-bfgodrich.png" class="spLogo" alt="BFGoodrich" onerror="this.style.display='none'">
        <img src="/assets/logo-monster.png" class="spLogo" alt="Monster" onerror="this.style.display='none'">
        <img src="/assets/logo-unico.png" class="spLogo" alt="Unico" onerror="this.style.display='none'">
      </div>
    </section>
  </main>

  <footer>
    <div class="footGrid">
      <div>
        <h4 style="font-family:var(--fontTitle); font-size:28px; margin:0 0 10px;">ÚNICO UNIFORMES</h4>
        <p style="font-size:14px; line-height:1.6; color:#999;">
          Fabricante y Patrocinador Oficial.<br>
          Palermo 6106 Interior JK, Anexa Roma, Tijuana B.C.<br>
          <b>ventas.unicotextil@gmail.com</b><br>
          WhatsApp: 664 236 8701
        </p>
      </div>
      <div>
        <h4 style="font-family:var(--fontTitle); font-size:28px; margin:0 0 10px; color:var(--red)">LEGAL</h4>
        
        <details class="fLegal">
          <summary>Términos y Condiciones</summary>
          <div class="fLegalBody">
            <p>Operado por ÚNICO UNIFORMES. Los productos son ediciones limitadas sujetas a disponibilidad.</p>
          </div>
        </details>
        
        <details class="fLegal">
          <summary>Envíos y Entregas</summary>
          <div class="fLegalBody">
            <p><b>Recolección:</b> Gratis en fábrica (Tijuana).<br><b>Local:</b> $80 MXN (Tijuana).<br><b>Nacional:</b> Se cotiza al final.</p>
          </div>
        </details>
        
        <details class="fLegal">
          <summary>Cambios y Devoluciones</summary>
          <div class="fLegalBody">
            <p>Solo por defectos de fábrica (7 días). No hay cambios por talla en ediciones agotadas.</p>
          </div>
        </details>

      </div>
    </div>
  </footer>

  <aside class="drawer" id="drawer">
    <div class="dHead">
      <h3 style="margin:0; font-family:var(--fontTitle); font-size:28px;">TU EQUIPO</h3>
      <button class="btn" style="padding:5px 10px;" onclick="closeAll()">X</button>
    </div>
    <div class="dBody" id="cartBody"></div>
    <div style="padding:20px; background:#f9f9f9; border-top:1px solid #eee;">
      <div style="display:flex; justify-content:space-between; font-weight:900; font-size:18px; margin-bottom:10px;">
        <span>Total:</span> <span id="cartTotal">$0 MXN</span>
      </div>
      
      <p style="font-size:12px; color:#666; font-weight:700;">Método de Entrega:</p>
      <select class="input" id="shipMethod">
        <option value="">-- Selecciona --</option>
        <option value="pickup">Recoger en Fábrica (Tijuana) - Gratis</option>
        <option value="tj">Envío Local (Tijuana) - $80 MXN</option>
        <option value="mx">Envío Nacional (México) - Cotizar</option>
      </select>

      <div id="shipForm" style="display:none;">
        <input class="input" id="shipPostal" type="tel" placeholder="CP (5 dígitos)" maxlength="5">
        <input class="input" id="shipState" placeholder="Estado (ej. BC)" maxlength="3">
        <input class="input" id="shipCity" placeholder="Ciudad">
        <input class="input" id="shipAddress" placeholder="Calle y número">
        <input class="input" id="shipName" placeholder="Nombre completo">
      </div>

      <button class="btn primary" id="payBtn" style="width:100%; margin-top:10px;" disabled>IR A PAGAR</button>
    </div>
  </aside>

  <div class="modal" id="modalCatalog">
    <div class="mHead">
      <h3 style="margin:0; font-family:var(--fontTitle); font-size:28px;" id="catTitle">CATÁLOGO</h3>
      <button class="btn" style="padding:5px 10px;" onclick="closeAll()">X</button>
    </div>
    <div class="mBody grid" id="catalogGrid"></div>
  </div>

  <div class="paybar" id="paybar">
    <div>
      <div style="font-size:10px; font-weight:800; color:#666;">TOTAL</div>
      <div style="font-size:20px; font-weight:900;" id="pbTotal">$0</div>
    </div>
    <button class="btn primary" onclick="openDrawer()">Ver Carrito</button>
  </div>

  <script>
    // --- CONFIG ---
    const STRIPE_PK = "pk_live_51Se6fsGUCnsKfgrBdpVBcTbXG99reZVkx8cpzMlJxr0EtUfuJAq0Qe3igAiQYmKhMn0HewZI5SGRcnKqAdTigpqB00fVsfpMYh";
    const STORE = { api: "/.netlify/functions", catalog: "/data/catalog.json" };

    // --- PRODUCTOS DEFAULT (Fallback Completo) ---
    const DEFAULT_PRODUCTS = [
      // Baja 1000 (Edicion 2025)
      { id:"chamarra-1000", name:"Chaqueta Oficial Baja 1000", baseMXN:1490, img:"/assets/EDICION_2025/chamarra-baja1000.jpg", sizes:["S","M","L","XL"], sectionId:"EDICION_2025" },
      { id:"tee-1000-blk", name:"Tee Baja 1000 (Negra)", baseMXN:499, img:"/assets/EDICION_2025/camiseta-baja1000-negra.jpg", sizes:["S","M","L","XL"], sectionId:"EDICION_2025" },
      // Rellenos para otras carreras (Usando imágenes existentes)
      { id:"tee-500", name:"Tee Baja 500 Oficial", baseMXN:450, img:"/assets/EDICION_2025/camiseta-baja1000-azul.jpg", sizes:["M","L"], sectionId:"BAJA_500" },
      { id:"tee-400", name:"Tee Baja 400 Oficial", baseMXN:450, img:"/assets/EDICION_2025/camiseta-baja1000-cafe.jpg", sizes:["M","L"], sectionId:"BAJA_400" },
      { id:"hoodie-sf", name:"Hoodie San Felipe 250", baseMXN:800, img:"/assets/EDICION_2025/sudadera-world-desert-cafe.jpg", sizes:["S","M","L"], sectionId:"SF_250" },
    ];

    let state = { cart: [], shipping: { method: null, cost: 0 } };
    const $ = (id) => document.getElementById(id);

    // --- CATALOGO ---
    async function loadProducts(sectionId, title) {
      if(title) $('catTitle').innerText = title.toUpperCase();
      try {
        const res = await fetch(STORE.catalog);
        const data = await res.json();
        let prods = data.products.filter(p => p.sectionId === sectionId);
        if(prods.length===0) throw new Error("Empty");
        renderGrid(prods);
      } catch (e) {
        console.log("Using offline products");
        renderGrid(DEFAULT_PRODUCTS.filter(p => p.sectionId === sectionId));
      }
      openModal();
    }

    function renderGrid(items) {
      const grid = $('catalogGrid');
      if(!items.length) { grid.innerHTML = "<div style='grid-column:1/-1;text-align:center;'>Próximamente</div>"; return; }
      
      grid.innerHTML = items.map(p => `
        <div class="card">
          <img src="${p.img}" loading="lazy" onerror="this.src='/assets/logo-score.png'">
          <div class="name">${p.name}</div>
          <div style="font-weight:900; color:var(--red)">$${p.baseMXN}</div>
          <select id="sz_${p.id}" class="input" style="height:36px; padding:0 5px; margin:8px 0; font-size:14px !important;">
            ${(p.sizes||['Unitalla']).map(s=>`<option>${s}</option>`)}
          </select>
          <button class="btn primary" style="width:100%; padding:10px;" 
             onclick="addToCart('${p.id}', '${p.name}', ${p.baseMXN}, '${p.img}')">AGREGAR</button>
        </div>
      `).join('');
    }

    // --- CARRITO ---
    function addToCart(id, name, price, img) {
      const size = $(`sz_${id}`).value;
      const key = `${id}-${size}`;
      const exists = state.cart.find(i => i.key === key);
      if(exists) exists.qty++;
      else state.cart.push({ key, id, name, price, img, size, qty:1 });
      updateCart();
      showToast("Agregado al equipo");
      $('modalCatalog').classList.remove('active');
      openDrawer();
    }

    function updateCart() {
      const totalItems = state.cart.reduce((a,b)=>a+b.qty,0);
      const sub = state.cart.reduce((a,b)=>a+(b.price*b.qty),0);
      const total = sub + (state.shipping.cost||0);
      
      $('cartCount').innerText = totalItems;
      $('cartTotal').innerText = `$${total} MXN`;
      $('pbTotal').innerText = `$${total}`;
      
      $('cartBody').innerHTML = state.cart.map((i,idx) => `
        <div style="display:flex; gap:10px; margin-bottom:10px; background:#f5f5f5; padding:8px; border-radius:10px;">
          <img src="${i.img}" style="width:50px; height:50px; object-fit:cover; border-radius:6px;">
          <div style="flex:1;">
            <div style="font-weight:700; font-size:13px;">${i.name}</div>
            <div style="font-size:12px; color:#666;">${i.size} | $${i.price}</div>
          </div>
          <div style="text-align:right;">
             <button onclick="state.cart.splice(${idx},1);updateCart()" style="color:red; border:none; background:none;">×</button>
             <div style="font-weight:900;">x${i.qty}</div>
          </div>
        </div>
      `).join('') || "<div style='text-align:center; padding:20px; opacity:0.6'>Vacío</div>";

      if(totalItems>0) $('paybar').classList.add('visible');
      else $('paybar').classList.remove('visible');
      
      validatePay();
      localStorage.setItem('score_cart', JSON.stringify(state.cart));
    }

    // --- CHECKOUT ---
    $('shipMethod').addEventListener('change', (e) => {
      const m = e.target.value;
      state.shipping.method = m;
      state.shipping.cost = (m === 'tj') ? 80 : 0;
      $('shipForm').style.display = (m === 'mx') ? 'block' : 'none';
      updateCart();
    });

    ['shipPostal','shipName','shipAddress'].forEach(id => {
      $(id).addEventListener('input', validatePay);
    });

    function validatePay() {
      const hasItems = state.cart.length > 0;
      const m = state.shipping.method;
      let ok = false;
      if(hasItems && m) {
        if(m==='mx') ok = ($('shipPostal').value.length===5 && $('shipAddress').value.length>5);
        else ok = true;
      }
      $('payBtn').disabled = !ok;
    }

    $('payBtn').addEventListener('click', async () => {
      const btn = $('payBtn');
      btn.innerText = "Conectando..."; btn.disabled = true;
      try {
        const stripe = Stripe(STRIPE_PK);
        const payload = {
          items: state.cart,
          shipping: {
            mode: state.shipping.method,
            to: {
              postal_code: $('shipPostal').value,
              name: $('shipName').value,
              address1: $('shipAddress').value,
              city: $('shipCity').value,
              state: $('shipState').value
            }
          }
        };
        const res = await fetch(STORE.api + '/create_checkout', {
          method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
        });
        const data = await res.json();
        if(data.url) window.location.href = data.url;
        else throw new Error(data.error);
      } catch(e) {
        alert("Error: " + e.message);
        btn.innerText = "IR A PAGAR"; btn.disabled = false;
      }
    });

    // --- UI UTILS ---
    function openDrawer(){ $('drawer').classList.add('active'); $('overlay').classList.add('active'); document.body.classList.add('modalOpen'); }
    function openModal(){ $('modalCatalog').classList.add('active'); $('overlay').classList.add('active'); document.body.classList.add('modalOpen'); }
    function closeAll(){ 
      $('drawer').classList.remove('active'); $('modalCatalog').classList.remove('active'); 
      $('overlay').classList.remove('active'); document.body.classList.remove('modalOpen');
    }
    function showToast(m){ 
      const t=$('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); 
    }
    $('overlay').onclick = closeAll;
    $('openCart').onclick = openDrawer;

    // --- INIT ---
    const saved = localStorage.getItem('score_cart');
    if(saved) { state.cart = JSON.parse(saved); updateCart(); }
  </script>
</body>
</html>