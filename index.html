<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <title>SCORE | Official Baja Gear</title>
  <meta name="description" content="Merch oficial del desierto. Drops limitados. Compra segura en M√©xico. Usa SCORE10 para descuento." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://scorestore.netlify.app/" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="SCORE | Official Baja Gear" />
  <meta property="og:description" content="Inventario limitado + drops oficiales. Compra segura en M√©xico. Cup√≥n SCORE10 disponible." />
  <meta property="og:image" content="https://scorestore.netlify.app/assets/hero.png" />
  <meta property="og:url" content="https://scorestore.netlify.app/" />

  <link rel="icon" href="/assets/favicon.png" />
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <link rel="preload" as="image" href="/assets/hero.png" />
  <link rel="preload" as="image" href="/assets/fondo-pagina-score.png" />

  <style>
    :root{
      --fontTitle:"Teko",sans-serif;
      --fontBody:"Inter",sans-serif;
      --red:#E10600;
      --carbon:#0b0f14;
      --sand:#f0f0f0;
      --pageBg:url("/assets/fondo-pagina-score.png");
      --pageBgOpacity:.78;
      --shadow:0 20px 50px rgba(0,0,0,.18);
      --shadow2:0 12px 30px rgba(0,0,0,.22);
      --radius:16px;

      /* overlays */
      --cardGlassA: rgba(255,255,255,.10);
      --cardGlassB: rgba(255,255,255,.05);
      --cardVignette: rgba(0,0,0,.60);

      /* hero caf√© oscuro para legibilidad */
      --heroCafeA: rgba(72,49,33,.90);
      --heroCafeB: rgba(72,49,33,.44);
      --heroCafeC: rgba(0,0,0,.18);

      /* season */
      --seasonTint: rgba(105, 180, 255, .10);
      --seasonGlow: rgba(255,255,255,.18);
      --partnersTint: rgba(105, 180, 255, .10);
    }

    body[data-theme="halloween"]{
      --seasonTint: rgba(255, 132, 0, .14);
      --seasonGlow: rgba(255, 80, 0, .10);
      --partnersTint: rgba(255, 132, 0, .10);
    }
    body[data-theme="patrio"]{
      --seasonTint: rgba(0, 180, 90, .12);
      --seasonGlow: rgba(255,255,255,.10);
      --partnersTint: rgba(0, 180, 90, .09);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--fontBody);
      color:#111;
      background-color:var(--sand);
      overflow-x:hidden;
      padding-bottom:95px;
      position:relative;
    }
    body.modalOpen{overflow:hidden}

    /* Fondo base */
    body::after{
      content:"";
      position:fixed; inset:0;
      background-image:var(--pageBg);
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      opacity:var(--pageBgOpacity);
      z-index:-6;
      pointer-events:none;
    }

    /* Tinte temporada */
    .seasonTint{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 20% 10%, var(--seasonGlow), transparent 48%),
        radial-gradient(circle at 80% 0%, var(--seasonGlow), transparent 52%),
        linear-gradient(180deg, var(--seasonTint), transparent 55%);
      z-index:-5;
      pointer-events:none;
      mix-blend-mode:multiply;
      opacity:.95;
    }

    /* ‚ùÑÔ∏è Nieve sutil (solo navidad) */
    .seasonSnow{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-4;
      opacity:.22;
      background-image:
        radial-gradient(circle, rgba(255,255,255,.95) 1px, transparent 2px),
        radial-gradient(circle, rgba(255,255,255,.80) 1px, transparent 2px),
        radial-gradient(circle, rgba(255,255,255,.65) 1px, transparent 2px);
      background-size: 240px 240px, 360px 360px, 520px 520px;
      background-position: 0 0, 80px 120px, 160px 40px;
      animation: snowFall 10.5s linear infinite;
      display:none;
    }
    body[data-theme="xmas"] .seasonSnow{display:block}
    @keyframes snowFall{from{transform:translateY(-24px)}to{transform:translateY(240px)}}

    /* ‚ú® Sparkles ultra sutiles */
    .seasonSparkles{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-3;
      opacity:.18;
      display:none;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.65) 0 1px, transparent 2px),
        radial-gradient(circle at 78% 22%, rgba(255,255,255,.55) 0 1px, transparent 2px),
        radial-gradient(circle at 36% 62%, rgba(255,255,255,.50) 0 1px, transparent 2px),
        radial-gradient(circle at 64% 78%, rgba(255,255,255,.55) 0 1px, transparent 2px),
        radial-gradient(circle at 88% 64%, rgba(255,255,255,.45) 0 1px, transparent 2px);
      animation: twinkle 3.2s ease-in-out infinite alternate;
    }
    body[data-theme="xmas"] .seasonSparkles{display:block}
    @keyframes twinkle{from{opacity:.14;transform:translateY(0)}to{opacity:.22;transform:translateY(2px)}}

    /* Grano */
    body::before{
      content:""; position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.006' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)' opacity='.05'/%3E%3C/svg%3E");
      z-index:-2; pointer-events:none; mix-blend-mode:multiply; opacity:.62;
    }

    a,button{outline:none}
    :focus-visible{outline:3px solid rgba(225,6,0,.55);outline-offset:2px;border-radius:10px}

    .wrap{width:min(1200px,94vw);margin:0 auto;padding-top:92px;padding-bottom:60px}

    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      opacity:0; pointer-events:none;
      z-index:95;
      transition:opacity .18s ease;
    }
    .overlay.active{opacity:1;pointer-events:auto}

    .toast{
      position:fixed;left:50%;bottom:92px;transform:translateX(-50%);
      background:rgba(0,0,0,.88);color:#fff;padding:10px 14px;border-radius:999px;
      font-size:12px;font-weight:900;letter-spacing:.02em;
      box-shadow:var(--shadow2);
      opacity:0;pointer-events:none;z-index:130;
      transition:opacity .18s ease, transform .18s ease;
      max-width:min(92vw,520px);text-align:center;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}

    .topbar{
      position:fixed;top:0;left:0;right:0;z-index:90;
      background:rgba(245,245,245,.96);
      border-bottom:3px solid var(--red);
      backdrop-filter:blur(10px);
      box-shadow:0 4px 15px rgba(0,0,0,.05);
    }
    .topInner{
      width:min(1200px,94vw);margin:0 auto;height:76px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brandLogo img{height:55px;width:auto;display:block;filter:drop-shadow(0 2px 2px rgba(0,0,0,.1))}
    .navRight{display:flex;align-items:center;gap:10px}

    .promoPill{
      display:flex;align-items:center;justify-content:center;height:38px;padding:0 12px;border-radius:999px;
      background:rgba(0,0,0,.92);
      border:1px solid rgba(255,255,255,.10);
      font-weight:900;font-size:12px;letter-spacing:.08em;color:#fff;white-space:nowrap;
    }
    .promoPill span{color:rgba(255,255,255,.86)}
    @media (max-width:520px){.promoPill{display:none}}

    .cartTrigger{
      position:relative;
      background:#0c0f14;color:#fff;border:none;
      height:54px;padding:0 18px;display:flex;align-items:center;gap:12px;
      font-family:var(--fontTitle);font-weight:700;font-size:22px;
      clip-path:polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
      cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.25);overflow:hidden;
      transition:transform .15s ease;
    }
    .cartTrigger:hover{transform:translateY(-1px)}
    .cartIconSvg{width:36px;height:36px;stroke:#fff;stroke-width:2.2;fill:none;filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
    .cartCount{position:absolute;top:6px;right:6px;background:var(--red);font-size:11px;padding:2px 6px;border-radius:6px;line-height:1;font-weight:900}

    /* HERO */
    .hero{
      position:relative;border-radius:var(--radius);overflow:hidden;min-height:540px;
      display:flex;align-items:center;background:var(--carbon);color:#fff;box-shadow:var(--shadow);
    }
    .heroBg{position:absolute;inset:0;background:url('/assets/hero.png') center/cover no-repeat;opacity:.96;transform:scale(1.03)}
    .heroOverlay{
      position:absolute;inset:0;
      background:
        linear-gradient(to right, var(--heroCafeA) 0%, var(--heroCafeB) 66%, transparent 100%),
        radial-gradient(circle at 78% 18%, rgba(225,6,0,0.12), transparent 52%),
        radial-gradient(circle at 18% 74%, rgba(255,255,255,0.10), transparent 56%);
    }
    .heroDecor{position:absolute;inset:0;pointer-events:none;z-index:1;display:none;opacity:.22}
    body[data-theme="xmas"] .heroDecor{
      display:block;
      background:
        radial-gradient(circle at 88% 20%, rgba(255,255,255,.20) 0 2px, transparent 3px),
        radial-gradient(circle at 92% 28%, rgba(255,255,255,.16) 0 2px, transparent 3px),
        radial-gradient(circle at 84% 34%, rgba(255,255,255,.14) 0 2px, transparent 3px),
        radial-gradient(circle at 78% 16%, rgba(255,255,255,.10) 0 2px, transparent 3px);
      animation:decorFloat 4.4s ease-in-out infinite alternate;
    }
    @keyframes decorFloat{from{transform:translateY(0)}to{transform:translateY(4px)}}

    .seasonRibbon{
      position:absolute;top:18px;right:18px;z-index:3;
      background:rgba(255,255,255,.92);color:#111;font-weight:900;font-size:12px;
      letter-spacing:.10em;padding:10px 12px;border-radius:14px;
      border:1px solid rgba(0,0,0,.10);box-shadow:0 12px 22px rgba(0,0,0,.16);
      text-transform:uppercase;text-align:center;
    }
    .seasonRibbon b{color:var(--red)}
    body[data-theme="xmas"] .seasonRibbon::before{content:"üéÑ "}

    .heroContent{position:relative;z-index:2;padding:50px;max-width:720px}
    .heroTag{
      background:var(--red);color:#fff;padding:6px 16px;font-family:var(--fontTitle);
      font-size:22px;font-weight:700;transform:skew(-10deg);display:inline-block;margin-bottom:18px;
      box-shadow:0 4px 10px rgba(0,0,0,.3);letter-spacing:.02em;text-transform:uppercase;
    }
    .heroTitle{font-family:var(--fontTitle);font-size:90px;line-height:.85;margin:0 0 16px;text-transform:uppercase;text-shadow:0 5px 20px rgba(0,0,0,.55)}
    .heroSub{
      font-size:17px;line-height:1.5;color:rgba(255,255,255,.92);margin-bottom:18px;
      border-left:4px solid var(--red);padding-left:18px;font-weight:800;text-shadow:0 2px 4px rgba(0,0,0,.65);
    }
    .heroActions{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btnHero{
      background:#fff;color:#111;border:none;padding:14px 34px;font-family:var(--fontTitle);font-size:26px;font-weight:700;
      cursor:pointer;clip-path:polygon(0 0, 100% 0, 95% 100%, 0% 100%);transition:transform .2s;box-shadow:0 10px 20px rgba(0,0,0,.3);
    }
    .btnHero:hover{transform:translateY(-2px)}
    .heroHint{
      font-weight:900;font-size:12px;letter-spacing:.10em;color:rgba(255,255,255,.90);text-transform:uppercase;
      background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.14);padding:10px 12px;border-radius:14px;
      backdrop-filter:blur(8px);max-width:min(92vw,420px);
    }
    @media (max-width:768px){
      .hero{align-items:flex-end;min-height:520px}
      .heroOverlay{
        background:
          linear-gradient(to top, rgba(74,50,33,.92) 18%, rgba(74,50,33,.40) 62%, transparent 100%),
          radial-gradient(circle at 60% 25%, rgba(225,6,0,0.10), transparent 52%);
      }
      .heroTitle{font-size:56px}
      .heroContent{padding:22px;width:100%}
      .seasonRibbon{top:14px;right:14px}
    }

    .secHeader{margin:26px 4px 12px;display:flex;align-items:baseline;justify-content:space-between;gap:12px}
    .secTitle{margin:0;font-family:var(--fontTitle);font-size:34px;letter-spacing:.03em;text-transform:uppercase;color:#111}
    .secMeta{font-weight:900;font-size:12px;letter-spacing:.12em;color:rgba(0,0,0,.55);text-transform:uppercase;white-space:nowrap}

    .gridDrops{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:22px}
    @media (max-width:980px){.gridDrops{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.gridDrops{grid-template-columns:1fr}}

    .cardDrop{
      position:relative;border-radius:var(--radius);overflow:hidden;cursor:pointer;min-height:240px;
      box-shadow:var(--shadow2);background:var(--carbon);transform:translateZ(0);
      transition:transform .18s ease, box-shadow .18s ease;border:1px solid rgba(255,255,255,.10);
    }
    .cardDrop:hover{transform:translateY(-2px);box-shadow:0 18px 44px rgba(0,0,0,.28)}

    .dropBg{
      position:absolute;inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.10), transparent 52%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.34)),
        url("/assets/baja1000-texture.png");
      background-size:cover;background-position:center;
      opacity:.95;filter:saturate(1.05) contrast(1.05);
    }
    .dropBg::after{
      content:"";position:absolute;inset:0;
      background:
        radial-gradient(circle at 50% 30%, transparent 30%, var(--cardVignette) 100%),
        linear-gradient(180deg, rgba(0,0,0,.28) 0%, rgba(0,0,0,.58) 88%);
      opacity:.92;
    }

    /* overlay transparente para ver fondo */
    .dropGlass{
      position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;padding:14px;
      background:linear-gradient(135deg, var(--cardGlassA) 0%, var(--cardGlassB) 62%, rgba(0,0,0,.08) 100%);
      backdrop-filter:blur(8px);
    }

    /* centrado total */
    .dropContent{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:10px;padding:6px 6px 10px}
    .statusBadge{
      align-self:flex-start;background:var(--red);color:#fff;font-weight:900;font-size:11px;letter-spacing:.12em;padding:6px 10px;border-radius:999px;
      text-transform:uppercase;box-shadow:0 10px 18px rgba(0,0,0,.25);
    }
    .dropLogo{width:160px;height:64px;object-fit:contain;filter:drop-shadow(0 12px 16px rgba(0,0,0,.35));opacity:.96;margin:0 auto}
    .dropInfo h3{margin:6px 0 0;font-family:var(--fontTitle);font-size:30px;letter-spacing:.02em;color:#fff;text-transform:uppercase}
    .dropInfo p{margin:0;color:rgba(255,255,255,.88);font-weight:800;font-size:13px;line-height:1.35;max-width:26ch}
    .btnDrop{
      border:none;background:#fff;color:#111;font-weight:900;padding:10px 14px;border-radius:14px;cursor:pointer;width:fit-content;
      transition:transform .15s ease;letter-spacing:.04em;text-transform:uppercase;
    }
    .btnDrop:hover{transform:translateY(-1px)}

    .partnersStrip{
      margin-top:22px;padding:18px 6px 6px;border-top:3px solid rgba(225,6,0,.85);border-bottom:3px solid rgba(225,6,0,.25);
      background:linear-gradient(180deg, var(--partnersTint), transparent 72%);border-radius:18px;
    }
    .partnersTitle{
      font-family:var(--fontTitle);font-size:20px;letter-spacing:2px;color:rgba(0,0,0,.55);
      margin:0 0 16px;text-transform:uppercase;padding:0 12px;text-align:center;
    }
    .spGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;align-items:center;padding:0 12px 12px}
    @media (max-width:760px){.spGrid{grid-template-columns:repeat(2,1fr)}}
    .spLogo{width:100%;height:48px;object-fit:contain;filter:grayscale(1) contrast(1.05);opacity:.92}

    footer{margin-top:28px;background:#080b10;color:#fff;padding:28px 0;border-top:3px solid var(--red)}
    .footGrid{width:min(1200px,94vw);margin:0 auto;display:grid;grid-template-columns:1.3fr .7fr;gap:18px}
    @media (max-width:820px){.footGrid{grid-template-columns:1fr}}
    .fLink{display:block;padding:10px 0;color:rgba(255,255,255,.86);font-weight:800;cursor:pointer;text-decoration:underline;text-underline-offset:3px}
    .fLink:hover{color:#fff}

    .paybar{
      position:fixed;left:50%;transform:translateX(-50%);bottom:16px;width:min(1200px,94vw);
      display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:18px;
      background:rgba(255,255,255,.92);border:1px solid rgba(0,0,0,.10);box-shadow:var(--shadow2);
      opacity:0;pointer-events:none;z-index:120;transition:opacity .18s ease, transform .18s ease;
    }
    .paybar.visible{opacity:1;pointer-events:auto}
    .pbTotal{font-weight:900;font-size:11px;color:rgba(0,0,0,.60);letter-spacing:.12em;text-transform:uppercase}
    .pbPrice{font-weight:900;font-size:18px;margin-top:2px;color:#111}
    .pbPrice small{display:block;font-size:12px;color:rgba(0,0,0,.55);font-weight:900;margin-top:2px}
    .pbBtn{border:none;background:#111;color:#fff;font-weight:900;padding:12px 14px;border-radius:14px;cursor:pointer;letter-spacing:.06em;text-transform:uppercase}

    .drawer{
      position:fixed;top:0;right:0;width:min(420px,92vw);height:100%;
      background:rgba(255,255,255,.96);border-left:1px solid rgba(0,0,0,.10);box-shadow:-20px 0 50px rgba(0,0,0,.22);
      transform:translateX(102%);transition:transform .2s ease;z-index:110;display:flex;flex-direction:column;
    }
    .drawer.active{transform:translateX(0)}
    .dHead{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 10px;border-bottom:1px solid rgba(0,0,0,.08)}
    .dTitle{margin:0;font-family:var(--fontTitle);font-size:30px;letter-spacing:.03em}
    .pmClose{border:none;background:transparent;cursor:pointer;font-weight:900;line-height:1;padding:6px 10px;border-radius:12px}
    .dBody{padding:12px 16px;overflow:auto;flex:1}
    .cartEmpty{font-weight:900;color:rgba(0,0,0,.55);text-align:center;padding:24px 0;letter-spacing:.08em}

    .cItem{display:flex;gap:10px;padding:10px;border-radius:14px;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.06);margin-bottom:10px}
    .cImg{width:66px;height:66px;border-radius:12px;object-fit:cover;background:rgba(0,0,0,.08)}
    .cMetaLine{margin-top:6px;font-size:12px;color:rgba(0,0,0,.65);font-weight:800}
    .cPrice{margin-top:6px;font-weight:900;font-size:13px}

    .dFoot{padding:12px 16px 16px;border-top:1px solid rgba(0,0,0,.08)}
    .sumRow{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:rgba(0,0,0,.70);font-weight:800;margin:6px 0}
    .sumRow strong{color:#111;font-weight:900}

    .promoBox{margin-top:12px;padding:12px;border-radius:14px;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.06)}
    .promoRow{display:flex;gap:10px;margin-top:8px}
    .promoInput{flex:1;height:42px;border-radius:12px;border:1px solid rgba(0,0,0,.14);padding:0 12px;font-weight:900;letter-spacing:.06em;text-transform:uppercase}
    .promoBtn{height:42px;border-radius:12px;border:none;background:#111;color:#fff;font-weight:900;padding:0 14px;cursor:pointer;letter-spacing:.06em;text-transform:uppercase}
    .promoNote{margin-top:8px;font-size:11px;color:rgba(0,0,0,.68);font-weight:900;line-height:1.35}

    .shipRow{display:flex;gap:10px;margin-top:10px}
    .shipInput{flex:1;height:42px;border-radius:12px;border:1px solid rgba(0,0,0,.14);padding:0 12px;font-weight:900;letter-spacing:.08em}
    .shipTag{min-width:110px;display:flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid rgba(0,0,0,.06);background:rgba(255,255,255,.8);font-weight:900;font-size:12px}

    .dfBtn{width:100%;margin-top:12px;border:none;background:#111;color:#fff;font-weight:900;padding:14px 14px;border-radius:14px;cursor:pointer;letter-spacing:.06em;text-transform:uppercase}
    .dfBtn:disabled{opacity:.5;cursor:not-allowed}
    .clearLink{display:block;text-align:center;margin-top:10px;color:rgba(0,0,0,.65);font-weight:900;cursor:pointer;text-decoration:underline;text-underline-offset:3px}

    /* modal cat√°logo */
    .prodModal{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);
      width:min(980px,94vw);height:min(86vh,760px);
      background:rgba(255,255,255,.98);
      border-radius:18px;border:1px solid rgba(0,0,0,.10);
      box-shadow:var(--shadow2);
      z-index:120;opacity:0;pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      display:flex;flex-direction:column;overflow:hidden;
    }
    .prodModal.active{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1)}
    .pmHead{
      position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;
      padding:14px 16px;border-bottom:1px solid rgba(0,0,0,.08);
      background:rgba(255,255,255,.92);backdrop-filter:blur(10px);z-index:2;
    }
    .pmTitle{font-family:var(--fontTitle);font-size:30px;letter-spacing:.03em;text-transform:uppercase}
    .pmBody{padding:14px 16px;overflow:auto;flex:1}
    .pmGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:980px){.pmGrid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){
      .prodModal{width:96vw;height:88vh;border-radius:16px}
      .pmGrid{grid-template-columns:1fr}
      .pmBody{padding:12px}
    }

    .pCard{border-radius:16px;overflow:hidden;background:#fff;border:1px solid rgba(0,0,0,.10);box-shadow:0 10px 22px rgba(0,0,0,.10);display:flex;flex-direction:column}
    .pImg{width:100%;aspect-ratio:4/5;background:rgba(0,0,0,.04);overflow:hidden}
    .pImg img{width:100%;height:100%;object-fit:cover;display:block}
    .pInfo{padding:12px}
    .pName{font-weight:900;font-size:13px;line-height:1.25;color:#111;text-align:center}
    .pPrice{margin-top:10px;text-align:center;font-weight:900;font-size:16px}
    .pCoupon{
      margin-top:10px;display:flex;justify-content:space-between;align-items:center;
      font-size:12px;font-weight:900;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.06);
      padding:10px 10px;border-radius:12px;
    }
    .pCoupon b{color:var(--red)}
    .pBtn{width:100%;margin-top:10px;border:none;background:#111;color:#fff;font-weight:900;padding:12px 12px;border-radius:14px;cursor:pointer;letter-spacing:.06em;text-transform:uppercase}
    .pBtn:disabled{opacity:.55;cursor:not-allowed}
  </style>
</head>

<body data-theme="xmas">
  <div class="seasonTint" aria-hidden="true"></div>
  <div class="seasonSnow" aria-hidden="true"></div>
  <div class="seasonSparkles" aria-hidden="true"></div>

  <div class="overlay" id="globalOverlay"></div>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <header class="topbar">
    <div class="topInner">
      <a href="/" class="brandLogo" aria-label="SCORE Official Baja Gear">
        <img src="/assets/logo-score.png" alt="SCORE" loading="eager" decoding="async">
      </a>

      <div class="navRight">
        <div class="promoPill" title="Cup√≥n disponible">
          <span>10% OFF con</span>&nbsp;<b>SCORE10</b>
        </div>

        <button class="cartTrigger" id="cartTrigger" type="button" onclick="toggleCart()" aria-label="Abrir carrito">
          <svg class="cartIconSvg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M6.5 6h14l-1.6 7.2a2 2 0 0 1-2 1.6H9.2a2 2 0 0 1-2-1.6L5.1 3.8A1.5 1.5 0 0 0 3.6 2.6H2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9.5 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2zM17.5 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="cartCount" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-label="Hero">
      <div class="heroBg" aria-hidden="true"></div>
      <div class="heroOverlay" aria-hidden="true"></div>
      <div class="heroDecor" aria-hidden="true"></div>

      <div class="seasonRibbon"><b>NAVIDAD</b> ¬∑ A√±o Nuevo</div>

      <div class="heroContent">
        <div class="heroTag">MERCH OFICIAL</div>
        <h1 class="heroTitle">LEYENDAS<br><span>DEL DESIERTO</span></h1>

        <p class="heroSub">Drops limitados. Compra segura en M√©xico. Entra, elige y listo.</p>

        <div class="heroActions">
          <button class="btnHero" type="button" onclick="openProductModal('ALL')">VER DROPS</button>
          <div class="heroHint">Tip r√°pido: si ya traes cup√≥n, apl√≠calo al final. <b>SCORE10</b> te baja el total.</div>
        </div>
      </div>
    </section>

    <div class="secHeader">
      <h2 class="secTitle">DROPS</h2>
      <span class="secMeta">MX ¬∑ Official Baja Gear</span>
    </div>

    <div class="gridDrops">
      <div class="cardDrop" onclick="openProductModal('ALL')" role="button" tabindex="0" aria-label="Abrir cat√°logo">
        <div class="dropBg" aria-hidden="true"></div>
        <div class="dropGlass">
          <div class="statusBadge">ACTIVO</div>

          <div class="dropContent">
            <img src="/assets/logo-baja1000.png" class="dropLogo" alt="Baja 1000" loading="lazy" decoding="async">
            <div class="dropInfo">
              <h3>BAJA 1000</h3>
              <p>Edici√≥n 2025 ¬∑ piezas limitadas.</p>
            </div>
            <button class="btnDrop" type="button" onclick="event.stopPropagation(); openProductModal('ALL')">VER PRODUCTOS</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('San Felipe 250')" role="button" tabindex="0" aria-label="Av√≠same San Felipe 250">
        <div class="dropBg" aria-hidden="true"></div>
        <div class="dropGlass">
          <div class="dropContent">
            <img src="/assets/logo-sf250.png" class="dropLogo" alt="San Felipe 250" loading="lazy" decoding="async" style="opacity:.92">
            <div class="dropInfo">
              <h3>PR√ìXIMAMENTE</h3>
              <p>San Felipe 250</p>
            </div>
            <button class="btnDrop" type="button" onclick="event.stopPropagation(); notifyDrop('San Felipe 250')">AV√çSAME</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('Baja 500')" role="button" tabindex="0" aria-label="Av√≠same Baja 500">
        <div class="dropBg" aria-hidden="true"></div>
        <div class="dropGlass">
          <div class="dropContent">
            <img src="/assets/logo-baja500.png" class="dropLogo" alt="Baja 500" loading="lazy" decoding="async" style="opacity:.92">
            <div class="dropInfo">
              <h3>PR√ìXIMAMENTE</h3>
              <p>Baja 500</p>
            </div>
            <button class="btnDrop" type="button" onclick="event.stopPropagation(); notifyDrop('Baja 500')">AV√çSAME</button>
          </div>
        </div>
      </div>

      <div class="cardDrop" onclick="notifyDrop('Baja 400')" role="button" tabindex="0" aria-label="Av√≠same Baja 400">
        <div class="dropBg" aria-hidden="true"></div>
        <div class="dropGlass">
          <div class="dropContent">
            <img src="/assets/logo-baja400.png" class="dropLogo" alt="Baja 400" loading="lazy" decoding="async" style="opacity:.92">
            <div class="dropInfo">
              <h3>PR√ìXIMAMENTE</h3>
              <p>Baja 400</p>
            </div>
            <button class="btnDrop" type="button" onclick="event.stopPropagation(); notifyDrop('Baja 400')">AV√çSAME</button>
          </div>
        </div>
      </div>
    </div>

    <section class="partnersStrip" aria-label="Partners">
      <div class="partnersTitle">OFFICIAL PARTNERS</div>
      <div class="spGrid">
        <img src="/assets/logo-ford.png" class="spLogo" alt="Ford" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="/assets/logo-rzr.png" class="spLogo" alt="RZR" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="/assets/logo-bfgoodrich.png" class="spLogo" alt="BFGoodrich" onerror="this.style.display='none'" loading="lazy" decoding="async">
        <img src="/assets/logo-unico.png" class="spLogo" alt="√önico Uniformes" onerror="this.style.display='none'" loading="lazy" decoding="async">
      </div>
    </section>
  </main>

  <footer>
    <div class="footGrid">
      <div>
        <h4 style="color:#fff; font-family:var(--fontTitle); font-size:28px; margin:0 0 10px;">√öNICO UNIFORMES</h4>
        <p style="font-size:14px; line-height:1.6; color:#b9b9b9; margin:0;">
          Fabricante y Patrocinador oficial.<br>
          Palermo 6106 Interior JK, Anexa Roma, 22614 Tijuana, B.C.<br>
          <b>unicouniformes.com</b><br><br>
          ventas.unicotextil@gmail.com<br>
          WhatsApp: 664 236 8701
        </p>
      </div>

      <div>
        <h4 style="color:var(--red); font-family:var(--fontTitle); font-size:28px; margin:0 0 10px;">LEGAL</h4>
        <div>
          <a class="fLink" href="/#terms" data-legal="terms">T√©rminos y condiciones</a>
          <a class="fLink" href="/#privacy" data-legal="privacy">Aviso de privacidad</a>
          <a class="fLink" href="/#shipping" data-legal="shipping">Env√≠os y entregas</a>
          <a class="fLink" href="/#returns" data-legal="returns">Cambios y devoluciones</a>
          <a class="fLink" href="/#fiscal" data-legal="fiscal">Facturaci√≥n</a>
          <a class="fLink" href="/#cookies" data-legal="cookies">Cookies</a>
        </div>
      </div>
    </div>
  </footer>

  <div class="paybar" id="paybar" aria-label="Resumen de compra">
    <div>
      <div class="pbTotal" id="pbLabel">TOTAL (MXN)</div>
      <div class="pbPrice" id="pbTotal">$0 MXN <small>$0 USD</small></div>
    </div>
    <button class="pbBtn" type="button" onclick="toggleCart()">VER CARRITO</button>
  </div>

  <aside class="drawer" id="cartDrawer" aria-label="Carrito">
    <div class="dHead">
      <h3 class="dTitle">TU EQUIPO</h3>
      <button class="pmClose" type="button" onclick="toggleCart()" style="font-size:28px" aria-label="Cerrar">&times;</button>
    </div>

    <div class="dBody" id="cartBody">
      <div class="cartEmpty">CARRITO VAC√çO</div>
    </div>

    <div class="dFoot">
      <div class="sumRow"><span>Subtotal:</span><strong id="subTotalLine">$0 MXN</strong></div>
      <div class="sumRow" id="promoLine" style="display:none;"><span>Descuento:</span><strong id="promoTotalLine">-$0 MXN</strong></div>
      <div class="sumRow" id="shipLine" style="display:none;"><span>Env√≠o:</span><strong id="shipTotalLine">$0 MXN</strong></div>
      <div class="sumRow"><span>Total:</span><strong id="grandTotalLine">$0 MXN</strong></div>
      <div style="margin-top:6px; font-size:11px; color:#666; font-weight:900;" id="usdTotalLine">$0 USD</div>
      <div style="margin-top:4px; font-size:11px; color:#666; font-weight:900;" id="shipEtaLine" aria-live="polite"></div>

      <div class="promoBox" aria-label="C√≥digo de promoci√≥n">
        <div style="font-weight:900; font-size:12px; color:#222; letter-spacing:.05em; text-transform:uppercase;">
          ¬øTienes cup√≥n?
        </div>
        <div class="promoRow">
          <input class="promoInput" id="promoInput" maxlength="24" placeholder="SCORE10" autocomplete="off" inputmode="text">
          <button class="promoBtn" type="button" onclick="applyPromo()">APLICAR</button>
        </div>
        <div class="promoNote" id="promoNote">Puedes probar <b>SCORE10</b> para bajar el total.</div>

        <div class="shipRow" aria-label="C√≥digo Postal para env√≠o">
          <input class="shipInput" id="postalInput" maxlength="5" placeholder="C.P. (5 d√≠gitos)" inputmode="numeric" autocomplete="postal-code">
          <div class="shipTag" id="shipTag">ENV√çO</div>
        </div>
        <div class="promoNote" id="shipNote">Escribe tu C.P. para calcular env√≠o real.</div>
      </div>

      <button class="dfBtn" id="payBtn" type="button" onclick="goCheckout()">IR A PAGAR</button>
      <a class="clearLink" onclick="clearCart()">Vaciar Carrito</a>

      <div style="margin-top:12px; font-size:11px; color:#666; font-weight:900; line-height:1.35;">
        Temporada:
        <span style="text-decoration:underline; cursor:pointer" onclick="setTheme('xmas')">Navidad</span> ¬∑
        <span style="text-decoration:underline; cursor:pointer" onclick="setTheme('halloween')">Halloween</span> ¬∑
        <span style="text-decoration:underline; cursor:pointer" onclick="setTheme('patrio')">Patrio</span>
      </div>
    </div>
  </aside>

  <div class="prodModal" id="pmAll" aria-label="Cat√°logo">
    <div class="pmHead">
      <div class="pmTitle" id="pmAllTitle">CAT√ÅLOGO</div>
      <button class="pmClose" type="button" onclick="closeProductModal()" aria-label="Cerrar">&times;</button>
    </div>
    <div class="pmBody">
      <div class="pmGrid" id="pmGridAll"></div>
    </div>
  </div>
<script>
  /* =========================
     SCORE STORE ‚Äî JS (PRO)
     Precios: baseMXN (cat√°logo) +20%
     Cup√≥n visible: SCORE10 = -10%
     Cup√≥n secreto (NO sugerido): GRTS10 = productos GRATIS (env√≠o se cobra si aplica)
     Promo extra: ENVIOFREE = env√≠o gratis
     Promo extra: BAJA200 = -$200 MXN
     Temas: xmas/halloween/patrio (modular)
     Env√≠o real: /.netlify/functions/quote_shipping
     ========================= */

  // PWA
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    });
  }

  let FX_MXN_PER_USD = 17.50;

  // reglas precio
  const PRICE_MARKUP = 0.20;
  const PUBLIC_COUPON = "SCORE10";
  const PUBLIC_PCT = 0.10;
  const SECRET_FREE_CODE = "GRTS10";

  const API_CHECKOUT = "/.netlify/functions/create_checkout";
  const API_SHIPPING = "/.netlify/functions/quote_shipping";
  const LS_KEY = "score_cart_v7";
  const THEME_KEY = "score_theme";
  const POSTAL_KEY = "score_postal";
  const SIZES = ["S","M","L","XL","2XL"];

  let cart = JSON.parse(localStorage.getItem(LS_KEY)) || [];
  let CATALOG = null;
  let PROMOS = null;

  let promoApplied = null; // { code, type, value }
  let shipping = { postalCode:"", shippingMXN:0, eta:"", zone:"", ok:false };

  function mxnToUsd(mxn){ return Number(mxn || 0) / FX_MXN_PER_USD; }
  function moneyMXN(n){ return Number(n||0).toLocaleString("es-MX", { style:"currency", currency:"MXN" }); }
  function moneyUSD(n){ return Number(n||0).toLocaleString("en-US", { style:"currency", currency:"USD" }); }
  function escapeHtml(str){
    return String(str||"").replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }
  function normCode(s){
    return String(s||"").toUpperCase().replace(/[^A-Z0-9_-]/g,"").trim();
  }
  function roundMXN(n){ return Math.round(Number(n||0)); }

  function toast(msg){
    const el = document.getElementById("toast");
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=> el.classList.remove("show"), 2400);
  }

  // Temas
  function setTheme(theme){
    document.body.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);
    toast(`Tema: ${theme}`);
  }
  (function initTheme(){
    const saved = localStorage.getItem(THEME_KEY);
    if(saved) document.body.setAttribute("data-theme", saved);
  })();

  const overlay = document.getElementById("globalOverlay");
  const drawer  = document.getElementById("cartDrawer");
  const pb      = document.getElementById("paybar");

  function closeOverlay(){
    overlay.classList.remove("active");
    drawer.classList.remove("active");
    closeProductModal();
    document.body.classList.remove("modalOpen");
  }
  overlay.addEventListener("click", closeOverlay);
  document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeOverlay(); });

  function saveCart(){ localStorage.setItem(LS_KEY, JSON.stringify(cart)); }
  function cartCount(){ return cart.reduce((a,b)=> a + Number(b.qty||0), 0); }
  function cartSubtotalMXN(){ return cart.reduce((a,b)=> a + (Number(b.priceMXN||0) * Number(b.qty||0)), 0); }

  function toggleCart(){
    if(drawer.classList.contains("active")) closeOverlay();
    else{
      overlay.classList.add("active");
      drawer.classList.add("active");
      document.body.classList.add("modalOpen");
      updateCartUI();
    }
  }

  document.addEventListener("keydown", (e)=>{
    const el = e.target;
    if(!el) return;
    if((e.key === "Enter" || e.key === " ") && el.classList?.contains("cardDrop")){
      e.preventDefault(); el.click();
    }
  });

  function notifyDrop(dropName){
    const subject = encodeURIComponent(`Av√≠same cuando salga: ${dropName}`);
    const body = encodeURIComponent(
      `Hola, quiero que me avisen cuando est√© disponible el drop "${dropName}".\n\n` +
      `Mi nombre:\nMi WhatsApp:\nMi correo:\n\nGracias.`
    );
    window.location.href = `mailto:ventas.unicotextil@gmail.com?subject=${subject}&body=${body}`;
  }

  function needsSize(name){
    return /sudadera|camisa|chamarra|chaqueta|hoodie|playera|camiseta/i.test(String(name||""));
  }

  // Pricing
  function priceListFromBase(baseMXN){
    return roundMXN(Number(baseMXN||0) * (1 + PRICE_MARKUP));
  }
  function priceWithPercent(listMXN, pct){
    return roundMXN(Number(listMXN||0) * (1 - Number(pct||0)));
  }

  async function loadCatalog(){
    const v = Date.now().toString().slice(-6);
    const res = await fetch(`/data/catalog.json?v=${v}`, { cache:"no-store" });
    CATALOG = await res.json();

    if(CATALOG?.site?.fx_mxn_per_usd){
      const fx = Number(CATALOG.site.fx_mxn_per_usd);
      if(!Number.isNaN(fx) && fx > 0) FX_MXN_PER_USD = fx;
    }
  }

  async function loadPromos(){
    const v = Date.now().toString().slice(-6);
    const res = await fetch(`/data/promos.json?v=${v}`, { cache:"no-store" }).catch(()=>null);
    if(!res || !res.ok) return;
    PROMOS = await res.json().catch(()=>null);
  }

  function pmDivider(label){
    return `
      <div style="grid-column:1/-1; display:flex; align-items:center; gap:10px; margin:10px 0 2px; opacity:.9;">
        <div style="flex:1; height:1px; background: rgba(0,0,0,.16);"></div>
        <div style="font-weight:900; letter-spacing:.12em; font-size:11px; color: rgba(0,0,0,.65); text-transform:uppercase; white-space: nowrap; text-align:center;">
          ${escapeHtml(label)}
        </div>
        <div style="flex:1; height:1px; background: rgba(0,0,0,.16);"></div>
      </div>
    `;
  }

  function cardTpl(p){
    const base = Number(p.baseMXN||0);
    const list = priceListFromBase(base);
    const withScore10 = priceWithPercent(list, PUBLIC_PCT);
    const sized = needsSize(p.name);

    const canBuy = list > 0;

    return `
      <div class="pCard">
        <div class="pImg">
          <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" loading="lazy" decoding="async" width="900" height="1125">
        </div>
        <div class="pInfo">
          <div class="pName">${escapeHtml(p.name)}</div>

          <div class="pPrice">${canBuy ? `${moneyMXN(list)} MXN` : `PRECIO POR DEFINIR`}</div>

          <div class="pCoupon" title="Cup√≥n disponible">
            <span>Con <b>${PUBLIC_COUPON}</b></span>
            <span><b>${canBuy ? moneyMXN(withScore10) : "--"}</b></span>
          </div>

          ${sized ? `
            <div style="margin-top:10px; display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <label style="font-size:12px; font-weight:900; color: rgba(0,0,0,.70);" for="size_${p.id}">Talla</label>
              <select style="flex:1; height:40px; border-radius:12px; border:1px solid rgba(0,0,0,.14); padding:0 10px; font-weight:900; letter-spacing:.06em;"
                      id="size_${p.id}">
                ${SIZES.map(s => `<option value="${s}">${s}</option>`).join("")}
              </select>
            </div>
          ` : ``}

          <button class="pBtn" type="button" onclick="${canBuy ? `addToCart('${escapeHtml(p.id)}')` : `notifyDrop('${escapeHtml(p.name)}')`}" ${canBuy ? "" : "disabled"}>
            ${canBuy ? "AGREGAR" : "PR√ìXIMAMENTE"}
          </button>
        </div>
      </div>
    `;
  }

  function renderCatalogAll(){
    const grid = document.getElementById("pmGridAll");
    if(!CATALOG || !Array.isArray(CATALOG.products)){
      grid.innerHTML = `<div style="grid-column:1/-1; padding:10px; font-weight:900; color:#111;">
        No se pudo cargar el cat√°logo. Revisa <code>/data/catalog.json</code>.
      </div>`;
      return;
    }

    const sections = Array.isArray(CATALOG.sections) ? [...CATALOG.sections] : [];
    sections.sort((a,b)=> (a.order||0) - (b.order||0));

    const products = CATALOG.products;
    let html = "";

    if(sections.length){
      for(const s of sections){
        const items = products.filter(p => String(p.sectionId||"") === String(s.id||""));
        if(!items.length) continue;
        html += pmDivider(s.title || s.id);
        html += items.map(cardTpl).join("");
      }
      const orphan = products.filter(p => !p.sectionId);
      if(orphan.length){
        html += pmDivider("M√°s productos");
        html += orphan.map(cardTpl).join("");
      }
    } else {
      html = products.map(cardTpl).join("");
    }

    grid.innerHTML = html || `<div style="grid-column:1/-1; padding:10px; font-weight:900; color:#111;">
      Cat√°logo vac√≠o.
    </div>`;
  }

  function openProductModal(id){
    if(id === "ALL"){
      renderCatalogAll();
      document.getElementById("pmAll").classList.add("active");
      overlay.classList.add("active");
      document.body.classList.add("modalOpen");
    }
  }
  function closeProductModal(){
    document.querySelectorAll(".prodModal").forEach(el => el.classList.remove("active"));
  }

  function addToCart(productId){
    if(!CATALOG || !Array.isArray(CATALOG.products)){
      toast("Cat√°logo no cargado‚Ä¶");
      return;
    }
    const p = CATALOG.products.find(x => String(x.id) === String(productId));
    if(!p) return;

    const base = Number(p.baseMXN||0);
    const list = priceListFromBase(base);
    if(!list){
      toast("Este producto a√∫n no tiene precio.");
      return;
    }

    const sizeEl = document.getElementById(`size_${productId}`);
    const size = sizeEl ? sizeEl.value : "√öNICA";

    const key = `${p.id}_${size}`;
    const exist = cart.find(i => i.key === key);

    if(exist) exist.qty++;
    else cart.push({
      key,
      id: p.id,
      name: p.name,
      img: p.img,
      size,
      priceMXN: list,
      qty: 1
    });

    saveCart();
    updateCartUI();
    toast("Agregado al carrito");
  }

  function rem(idx){
    cart.splice(idx,1);
    saveCart();
    updateCartUI();
    toast("Producto eliminado");
  }

  function clearCart(){
    if(confirm("¬øVaciar carrito?")){
      cart = [];
      promoApplied = null;
      saveCart();
      updateCartUI();
      toast("Carrito vac√≠o");
    }
  }

  function findPromoRule(code){
    const c = normCode(code);
    if(!c) return null;

    // secreto: NO se sugiere ni se muestra
    if(c === SECRET_FREE_CODE){
      return { code:c, type:"free_total", value:0, active:true };
    }

    // promos.json
    const rules = PROMOS?.rules;
    if(Array.isArray(rules)){
      const r = rules.find(x => normCode(x.code) === c && x.active);
      if(r) return r;
    }

    // fallback p√∫blico fijo (por si promos.json falla)
    if(c === PUBLIC_COUPON){
      return { code:c, type:"percent", value:PUBLIC_PCT, active:true };
    }

    return null;
  }

  function computeDiscount(subtotal){
    if(!promoApplied) return 0;
    if(promoApplied.type === "percent"){
      return Math.max(0, roundMXN(subtotal * Number(promoApplied.value||0)));
    }
    if(promoApplied.type === "fixed_mxn"){
      return Math.max(0, roundMXN(Number(promoApplied.value||0)));
    }
    if(promoApplied.type === "free_total"){
      return subtotal; // productos gratis
    }
    return 0;
  }

  function applyPromo(){
    const input = document.getElementById("promoInput");
    const note  = document.getElementById("promoNote");
    const code  = normCode(input.value);

    const rule = findPromoRule(code);

    if(!rule){
      promoApplied = null;
      note.textContent = code ? "C√≥digo no v√°lido." : "Escribe un c√≥digo para aplicarlo.";
      toast(code ? "C√≥digo no v√°lido" : "Escribe un c√≥digo");
      updateCartUI();
      return;
    }

    promoApplied = { code: normCode(rule.code), type: rule.type, value: Number(rule.value||0) };

    // NO revelar el secreto
    note.innerHTML = `‚úÖ Cup√≥n aplicado.`;

    toast("Cup√≥n aplicado");
    updateCartUI();
  }

  async function quoteShipping(postalCode){
    const pc = String(postalCode||"").replace(/\D/g,"").slice(0,5);
    const shipNote = document.getElementById("shipNote");
    const shipTag  = document.getElementById("shipTag");

    if(pc.length !== 5){
      shipping = { postalCode: pc, shippingMXN: 0, eta:"", zone:"", ok:false };
      shipTag.textContent = "ENV√çO";
      shipNote.textContent = "Escribe tu C.P. para calcular env√≠o real.";
      updateCartUI();
      return;
    }

    shipTag.textContent = "‚Ä¶";
    shipNote.textContent = "Calculando env√≠o‚Ä¶";

    try{
      const res = await fetch(API_SHIPPING, {
        method:"POST",
        headers:{ "content-type":"application/json" },
        body: JSON.stringify({ postalCode: pc, pieces: cartCount() || 1 })
      });
      const data = await res.json();

      if(!data?.ok) throw new Error(data?.error || "Shipping error");

      shipping = {
        postalCode: pc,
        shippingMXN: Number(data.shippingMXN||0),
        eta: String(data.eta||""),
        zone: String(data.zone||""),
        ok: true
      };

      shipTag.textContent = "OK";
      shipNote.textContent = shipping.eta ? `Entrega estimada: ${shipping.eta}` : "Env√≠o calculado.";
      updateCartUI();
    } catch(e){
      shipping = { postalCode: pc, shippingMXN: 0, eta:"", zone:"", ok:false };
      shipTag.textContent = "ERR";
      shipNote.textContent = "No se pudo calcular env√≠o (intenta de nuevo).";
      updateCartUI();
    }
  }

  function updateCartUI(){
    const count = cartCount();
    document.getElementById("cartCount").innerText = count;

    // body items
    const body = document.getElementById("cartBody");
    if(!cart.length){
      body.innerHTML = `<div class="cartEmpty">CARRITO VAC√çO</div>`;
    } else {
      body.innerHTML = cart.map((it,idx)=>`
        <div class="cItem">
          <img class="cImg" src="${escapeHtml(it.img)}" alt="${escapeHtml(it.name)}" loading="lazy" decoding="async">
          <div style="flex:1; min-width:0;">
            <div style="font-weight:900; font-size:13px; line-height:1.2;">${escapeHtml(it.name)}</div>
            <div class="cMetaLine">Talla: <b>${escapeHtml(it.size||"√öNICA")}</b> ¬∑ Cant: <b>${it.qty}</b></div>
            <div class="cPrice">${moneyMXN(it.priceMXN)} MXN</div>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button class="promoBtn" type="button" style="height:34px; padding:0 10px;" onclick="chgQty(${idx},-1)">-</button>
              <button class="promoBtn" type="button" style="height:34px; padding:0 10px;" onclick="chgQty(${idx},+1)">+</button>
              <button class="promoBtn" type="button" style="height:34px; padding:0 10px; background: var(--red);" onclick="rem(${idx})">X</button>
            </div>
          </div>
        </div>
      `).join("");
    }

    // totals
    const subtotal = cartSubtotalMXN();
    const off = computeDiscount(subtotal);
    const itemsTotalMXN = Math.max(0, subtotal - off);

    // shipping rule: only if CP valid and has items
    let shipMXN = (count > 0 && shipping?.ok) ? Number(shipping.shippingMXN||0) : 0;

    // ENVIOFREE => free shipping
    if(promoApplied?.type === "free_shipping"){
      shipMXN = 0;
    }

    const totalMXN = itemsTotalMXN + shipMXN;
    const totalUSD = mxnToUsd(totalMXN);

    // paybar
    pb.classList.toggle("visible", count > 0);
    document.getElementById("pbLabel").textContent = promoApplied ? "TOTAL (MXN) ¬∑ Cup√≥n aplicado" : "TOTAL (MXN)";
    document.getElementById("pbTotal").innerHTML = `${moneyMXN(totalMXN)} <small>${moneyUSD(totalUSD)} USD</small>`;

    // drawer totals
    document.getElementById("subTotalLine").textContent = moneyMXN(subtotal);

    const promoLine = document.getElementById("promoLine");
    if(off > 0){
      promoLine.style.display = "flex";
      document.getElementById("promoTotalLine").textContent = `- ${moneyMXN(off)}`;
    } else {
      promoLine.style.display = "none";
    }

    const shipLine = document.getElementById("shipLine");
    const shipEtaLine = document.getElementById("shipEtaLine");
    if(shipMXN > 0){
      shipLine.style.display = "flex";
      document.getElementById("shipTotalLine").textContent = moneyMXN(shipMXN);
      shipEtaLine.textContent = shipping?.eta ? `Entrega estimada: ${shipping.eta}` : "";
    } else {
      shipLine.style.display = "none";
      shipEtaLine.textContent = "";
    }

    document.getElementById("grandTotalLine").textContent = moneyMXN(totalMXN);
    document.getElementById("usdTotalLine").textContent = `${moneyUSD(totalUSD)} USD`;

    // pay button state
    const payBtn = document.getElementById("payBtn");
    payBtn.disabled = (count === 0);
  }

  function chgQty(idx, delta){
    const it = cart[idx];
    if(!it) return;
    it.qty = Math.max(1, Math.min(20, Number(it.qty||1) + Number(delta||0)));
    saveCart();
    // re-quote shipping because pieces changed
    if(shipping?.postalCode?.length === 5){
      quoteShipping(shipping.postalCode);
    } else {
      updateCartUI();
    }
  }

  async function goCheckout(){
    if(!cart.length){ toast("Carrito vac√≠o"); return; }

    const postalCode = String(document.getElementById("postalInput").value || "").replace(/\D/g,"").slice(0,5);
    if(postalCode.length !== 5){
      toast("Escribe tu C.P. (5 d√≠gitos) para calcular env√≠o");
      return;
    }

    const payBtn = document.getElementById("payBtn");
    payBtn.disabled = true;
    payBtn.textContent = "PROCESANDO‚Ä¶";

    try{
      const payload = {
        items: cart.map(it => ({ id: it.id, qty: it.qty, size: it.size })),
        promoCode: promoApplied?.code || "",
        postalCode
      };

      const res = await fetch(API_CHECKOUT, {
        method:"POST",
        headers:{ "content-type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if(!data?.ok || !data?.url) throw new Error(data?.error || "Checkout error");
      window.location.href = data.url;
    } catch(e){
      toast("No se pudo iniciar el pago. Revisa configuraci√≥n de pago.");
      console.error(e);
    } finally {
      payBtn.disabled = false;
      payBtn.textContent = "IR A PAGAR";
    }
  }

  // Init postal input
  (function initPostal(){
    const postalInput = document.getElementById("postalInput");
    const saved = localStorage.getItem(POSTAL_KEY) || "";
    if(saved) postalInput.value = saved;

    let t = null;
    postalInput.addEventListener("input", ()=>{
      const pc = postalInput.value.replace(/\D/g,"").slice(0,5);
      postalInput.value = pc;
      localStorage.setItem(POSTAL_KEY, pc);
      shipping.postalCode = pc;

      clearTimeout(t);
      t = setTimeout(()=> quoteShipping(pc), 350);
    });

    if(postalInput.value.replace(/\D/g,"").length === 5){
      quoteShipping(postalInput.value);
    }
  })();

  // Boot
  (async function init(){
    try{
      await Promise.all([loadCatalog(), loadPromos()]);
    } catch(e){
      console.error(e);
    }
    updateCartUI();
  })();

</script>
</body>
</html>