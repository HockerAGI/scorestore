<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SCORE STORE | Official Merchandise</title>
  <meta name="description" content="Merch Oficial SCORE International. Equipamiento aut√©ntico fabricado en Tijuana por √öNICO UNIFORMES." />
  
  <link rel="icon" href="/icons-score.svg" type="image/svg+xml" />
  <link rel="manifest" href="/site.webmanifest" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="preload" href="/assets/hero.webp" as="image">
  <script src="https://js.stripe.com/v3" async defer></script>
</head>

<body>
  <div class="page-overlay"></div> <header class="topbar">
    <div class="container topbarInner">
      <a href="/" class="brand" aria-label="Inicio">
        <img src="/assets/logo-score.webp" alt="SCORE International" class="brandLogo">
      </a>

      <nav class="nav">
        <div class="navLinks desktop-only" style="display:flex; gap:20px;">
          <button class="navBtn" onclick="scrollToId('drops')">DROPS</button>
          <button class="navBtn" onclick="scrollToId('catalog')">CAT√ÅLOGO</button>
          <button class="navBtn" onclick="scrollToId('shipping')">ENV√çOS</button>
        </div>
        
        <button class="cartBtn" onclick="openDrawer()" aria-label="Carrito">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
          <span id="cartCount">0</span>
        </button>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" id="top">
      <div class="heroBg"></div>
      <div class="heroOverlay"></div>
      
      <div class="container heroInner">
        <div class="heroText">
          <div class="tag-line">
            <span class="tag-badge">OFICIAL</span>
            <span>MERCHANDISE</span>
          </div>
          
          <h1>SCORE<br><span>INTERNATIONAL</span></h1>
          
          <p class="lead">
            Equipamiento oficial de las carreras m√°s duras del mundo.<br>
            <strong>√öNICO UNIFORMES:</strong> Patrocinador y Fabricante Oficial.
          </p>
          
          <div class="heroActions">
            <button class="btn primary" onclick="scrollToId('catalog')">COMPRAR AHORA</button>
            <button class="btn ghost" onclick="scrollToId('drops')">VER DROPS</button>
          </div>
          
          <div class="heroBadges">
            <span class="badge">üí≥ Pagos Seguros</span>
            <span class="badge">üì¶ Env√≠os Nacionales</span>
            <span class="badge">üèÅ Baja 1000</span>
          </div>
        </div>
        
        <div class="heroCard">
          <div class="heroCardTop">
            <div class="heroCardTitle">DESTACADO</div>
            <div class="heroCardTag">LIMITADO</div>
          </div>
          <div class="heroCardBody">
            <div class="heroCardName" id="featuredName">Cargando...</div>
            <div class="heroCardPrice" id="featuredPrice"></div>
            <img id="featuredImg" src="" style="width:100%; height:200px; object-fit:contain; margin:15px 0; mix-blend-mode:multiply; display:none;">
            <div style="margin-top:20px;">
                <button class="btn primary full" id="featuredBtn">VER PRODUCTO</button>
            </div>
            <div class="heroCardNote">* Stock sujeto a disponibilidad.</div>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="drops">
      <div class="container">
        <div class="section-head">
          <div>
            <h2>DROPS <span>LIMITADOS</span></h2>
            <div style="height:4px; width:60px; background:var(--red); margin-top:10px;"></div>
          </div>
          <p>Ediciones especiales y lanzamientos exclusivos de temporada.</p>
        </div>
        <div class="grid" id="dropsGrid"></div>
      </div>
    </section>

    <section class="section" id="catalog">
      <div class="container">
        <div class="section-head">
          <div>
            <h2>CAT√ÅLOGO <span>OFICIAL</span></h2>
            <div style="height:4px; width:60px; background:var(--red); margin-top:10px;"></div>
          </div>
          
          <div class="filters">
            <input class="inputField" id="search" placeholder="Buscar producto..." type="search" style="min-width:250px;"/>
            <select class="inputField" id="filterCat">
              <option value="all">Todas las Categor√≠as</option>
            </select>
          </div>
        </div>
        
        <div class="grid" id="catalogGrid"></div>
      </div>
    </section>

    <section class="section" id="shipping">
      <div class="container" style="display:flex; justify-content:center;">
        <div class="shipBox">
          <div style="text-align:center; margin-bottom:30px;">
            <h2 style="font-size:36px; margin-bottom:10px;">COTIZAR <span>ENV√çO</span></h2>
            <p style="color:#666;">Calcula el costo real de env√≠o a tu domicilio.</p>
          </div>
          
          <div class="shipRow">
            <label class="lbl" for="zip">C√ìDIGO POSTAL (5 D√çGITOS)</label>
            <div style="display:flex; gap:10px;">
               <input class="inputField" id="zipQuote" inputmode="numeric" maxlength="5" placeholder="Ej. 22000" type="text" style="flex:1;">
               <button class="btn primary" id="quoteBtn" style="padding:10px 20px; font-size:16px;">CALCULAR</button>
            </div>
          </div>
          <div class="shipResult" id="shipResult"></div>
        </div>
      </div>
    </section>

    <section class="section partners">
      <div class="container">
        <div class="partnersGrid">
          <img src="/assets/logo-ford.webp" class="pLogo" alt="Ford">
          <img src="/assets/logo-rzr.webp" class="pLogo" alt="Polaris">
          <img src="/assets/logo-bfgodrich.webp" class="pLogo" alt="BFGoodrich">
          <img src="/assets/logo-unico.webp" class="pLogo" alt="Unico" style="opacity:1; filter:none; height:50px;">
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container footerInner">
      <div class="fCol">
        <img src="/assets/logo-unico.webp" alt="Unico" class="footerUnico">
        <p class="fText">
          Operador, Fabricante y Distribuidor Oficial de Merchandise SCORE International.
        </p>
      </div>
      <div class="fCol">
        <div class="fTitle">SOPORTE</div>
        <a class="fLink" href="#" onclick="openLegal('shipping');return false;">Rastreo de Env√≠os</a>
        <a class="fLink" href="#" onclick="openLegal('returns');return false;">Devoluciones</a>
        <a class="fLink" href="#" onclick="openLegal('billing');return false;">Facturaci√≥n</a>
      </div>
      <div class="fCol">
        <div class="fTitle">LEGAL</div>
        <a class="fLink" href="#" onclick="openLegal('terms');return false;">T√©rminos</a>
        <a class="fLink" href="#" onclick="openLegal('privacy');return false;">Privacidad</a>
      </div>
      <div class="fCol">
        <div class="fTitle">CONTACTO</div>
        <p class="fText" style="color:#fff;">Palermo 6106 Interior JK, Anexa Roma, 22614, Tijuana B.C.</p>
        <a href="https://wa.me/526642368701" style="color:#00C853; text-decoration:none; display:block; margin-top:10px; font-weight:700;">
          WhatsApp: 664 236 8701
        </a>
        <a href="mailto:ventas.unicotextil@gmail.com" class="fLink" style="margin-top:5px;">ventas.unicotextil@gmail.com</a>
      </div>
    </div>
    <div class="copy">SCORE Store ¬© 2025 ¬∑ Powered by √önico Uniformes</div>
  </footer>

  <div class="overlay" id="overlay" onclick="closeAll()"></div>
  <aside class="drawer" id="drawer">
    <div class="drawerHead">
      <h3 class="dTitle">TU CARRITO</h3>
      <button class="iconBtn" onclick="closeAll()">‚úï</button>
    </div>
    <div class="drawerBody">
      <div class="cartItems" id="cartItems"></div>
      <div class="cartEmpty" id="cartEmpty" style="display:none; text-align:center; padding:40px; color:#999;">Tu carrito est√° vac√≠o.</div>
    </div>
    <div class="drawerFoot">
      <div class="totals">
        <div class="row"><span>Subtotal</span><strong id="subTotal">$0</strong></div>
        <div class="row"><span>Env√≠o</span><strong id="shipTotal">‚Äî</strong></div>
        <div class="row big"><span>TOTAL</span><strong id="grandTotal">$0</strong></div>
      </div>
      <button class="btn primary full" id="checkoutBtn" onclick="checkout()">PAGAR AHORA</button>
      <div class="smallNote">üîí Pagos procesados por Stripe.</div>
    </div>
  </aside>

  <section id="legalModal" class="drawer" style="width:min(600px, 100vw);">
    <div class="drawerHead"><h3 class="dTitle">INFO</h3><button class="iconBtn" onclick="closeAll()">‚úï</button></div>
    <div class="drawerBody" style="padding:40px;">
        <div class="legalBlock" data-legal-block="shipping" style="display:none">
            <h4 style="color:var(--red);margin-bottom:10px;">Env√≠os</h4>
            <p style="color:#555;">Env√≠os nacionales v√≠a FedEx/Estafeta (3-7 d√≠as). Pickup gratis en Tijuana.</p>
        </div>
        </div>
  </section>

  <div class="toast" id="toast">Notificaci√≥n</div>

  <script>
    const DEBUG = (location.hostname === 'localhost');
    const API_BASE = (location.hostname.includes('netlify')) ? '/.netlify/functions' : '/api';
    const CART_KEY = "score_cart_v3";

    let cart = [];
    let catalog = [];
    let shipQuote = null;

    /* --- HELPERS --- */
    const $ = (id) => document.getElementById(id);
    const money = (n) => new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(n||0);
    function scrollToId(id){ const el=$(id); if(el) el.scrollIntoView({behavior:"smooth",block:"start"}); }
    function toast(msg){ const t=$("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),2500); }

    /* --- CATALOGO --- */
    async function init(){
        loadCart(); updateTotals(); renderCart();
        try {
            const res = await fetch("/data/catalog.json");
            const data = await res.json();
            catalog = data.products || [];
            
            // Filtros
            const cats = new Set();
            catalog.forEach(p => { if(p.category) cats.add(p.category); });
            const sel = $("filterCat");
            cats.forEach(c => { const o=document.createElement("option"); o.value=c; o.text=c; sel.appendChild(o); });

            renderCatalog();
            renderDrops();
            setFeatured();
        } catch(e) { console.error("Error loading catalog"); }
        
        $("search").addEventListener("input", renderCatalog);
        $("filterCat").addEventListener("change", renderCatalog);
    }

    function renderCatalog() {
        const grid = $("catalogGrid");
        grid.innerHTML = "";
        const q = $("search").value.toLowerCase();
        const cat = $("filterCat").value;

        const filtered = catalog.filter(p => {
            if(q && !p.name.toLowerCase().includes(q)) return false;
            if(cat !== "all" && p.category !== cat) return false;
            return true;
        });

        if(!filtered.length) { grid.innerHTML = "<div style='text-align:center; grid-column:1/-1; padding:40px; color:#999;'>No hay productos.</div>"; return; }

        filtered.forEach(p => grid.appendChild(createCard(p)));
    }

    function renderDrops() {
        const grid = $("dropsGrid");
        const drops = catalog.filter(p => p.tags && (p.tags.includes('limited') || p.tags.includes('drop')));
        if(!drops.length) return;
        drops.forEach(p => grid.appendChild(createCard(p)));
    }

    function createCard(p) {
        const div = document.createElement("div");
        div.className = "card prodCard";
        
        // Tallas Pill
        const sizes = p.sizes || ["Unitalla"];
        const sizeBtns = sizes.map(s => `<div class="size-pill" onclick="selectSize(this, '${s}')">${s}</div>`).join("");

        div.innerHTML = `
            <div class="prodImg"><img src="${p.img}" alt="${p.name}" loading="lazy"></div>
            <div class="prodBody">
                <div class="prodName">${p.name}</div>
                <div class="prodPrice">${money(p.baseMXN)}</div>
                
                <div class="size-selector-row" id="sizes_${p.id}" data-selected="">${sizeBtns}</div>
                <div class="prodActions">
                    <button class="btn primary full" style="font-size:14px; padding:10px;" onclick="add('${p.id}')">AGREGAR</button>
                </div>
            </div>
        `;
        return div;
    }

    function setFeatured() {
        const p = catalog.find(x => x.tags && x.tags.includes('featured')) || catalog[0];
        if(!p) return;
        $("featuredName").innerText = p.name;
        $("featuredPrice").innerText = money(p.baseMXN);
        const img = $("featuredImg"); img.src = p.img; img.style.display="block";
        $("featuredBtn").onclick = () => scrollToId("catalog");
    }

    /* --- UI LOGIC --- */
    window.selectSize = (el, size) => {
        const parent = el.parentElement;
        parent.setAttribute("data-selected", size);
        parent.querySelectorAll(".size-pill").forEach(b => b.classList.remove("active"));
        el.classList.add("active");
    };

    window.add = (id) => {
        const sizeContainer = document.getElementById(`sizes_${id}`);
        let s = sizeContainer.getAttribute("data-selected");
        if(!s && sizeContainer.children.length === 1) s = sizeContainer.children[0].innerText;
        
        if(!s) { toast("‚ö†Ô∏è Selecciona una talla"); return; }
        
        const p = catalog.find(x=>x.id===id);
        const key = `${id}_${s}`;
        const exist = cart.find(i=>i.key===key);
        if(exist) exist.qty++; else cart.push({key, id, name:p.name, variant:`Talla: ${s}`, price:p.baseMXN, qty:1});
        
        saveCart(); renderCart(); openDrawer(); toast("Producto agregado");
    };

    /* --- CART & CHECKOUT --- */
    function loadCart(){ try{cart=JSON.parse(localStorage.getItem(CART_KEY)||"[]")}catch(e){cart=[]} }
    function saveCart(){ localStorage.setItem(CART_KEY,JSON.stringify(cart)); }
    function cartCount(){ return cart.reduce((a,b)=>a+b.qty,0); }
    function subtotal(){ return cart.reduce((a,b)=>a+(b.price*b.qty),0); }

    function renderCart(){
        const wrap = $("cartItems");
        const count = cartCount();
        $("cartCount").innerText = count;
        $("cartCount").style.display = count>0?"flex":"none";
        
        if(!cart.length) { 
            wrap.innerHTML=""; $("cartEmpty").style.display="block"; 
            updateTotals(); return; 
        }
        $("cartEmpty").style.display="none";
        
        wrap.innerHTML = cart.map((i,x) => `
            <div class="cartRow">
                <div class="cInfo"><div class="cName">${i.name}</div><div class="cMeta">${i.variant}</div><div class="cPrice">${money(i.price)}</div></div>
                <div class="cQty"><button class="qtyBtn" onclick="modCart(${x},-1)">-</button><span class="qtyNum">${i.qty}</span><button class="qtyBtn" onclick="modCart(${x},1)">+</button></div>
                <button class="iconBtn" onclick="delCart(${x})" style="margin-left:10px; color:#E10600;">&times;</button>
            </div>
        `).join("");
        updateTotals();
    }

    window.modCart = (x,d) => { cart[x].qty += d; if(cart[x].qty<1) cart[x].qty=1; saveCart(); renderCart(); };
    window.delCart = (x) => { cart.splice(x,1); saveCart(); renderCart(); };

    function updateTotals(){
        $("subTotal").innerText = money(subtotal());
        const ship = shipQuote ? shipQuote.mxn : 0;
        $("shipTotal").innerText = shipQuote ? money(ship) : "Cotizar al pagar";
        $("grandTotal").innerText = money(subtotal() + ship);
    }

    /* --- QUOTE & CHECKOUT --- */
    $("quoteBtn")?.addEventListener("click", async () => {
        const zip = $("zipQuote").value;
        const res = $("shipResult");
        res.innerHTML = "Calculando...";
        if(zip.length!==5) { res.innerHTML="CP Inv√°lido"; return; }
        
        try {
            const r = await fetch(`${API_BASE}/quote_shipping`, { method:"POST", body:JSON.stringify({postal_code:zip, items:1})});
            const d = await r.json();
            if(d.ok) { shipQuote=d; res.innerHTML = `<span style="color:green; font-weight:700">${d.label}: ${money(d.mxn)}</span>`; updateTotals(); }
            else { shipQuote={mxn:250}; res.innerHTML = "Est√°ndar: $250.00"; updateTotals(); }
        } catch(e) { res.innerHTML="Error conexi√≥n"; }
    });

    window.checkout = async () => {
        if(!cart.length) return;
        const btn = $("checkoutBtn"); btn.disabled=true; btn.innerText="PROCESANDO...";
        try {
            const r = await fetch(`${API_BASE}/create_checkout`, { method:"POST", body:JSON.stringify({items:cart, mode:"mx"})});
            const d = await r.json();
            if(d.url) location.href=d.url; else throw new Error();
        } catch(e) { toast("Error checkout"); btn.disabled=false; btn.innerText="PAGAR AHORA"; }
    };

    window.openDrawer=()=>{ $("drawer").classList.add("open"); $("overlay").classList.add("open"); document.body.classList.add("lock"); };
    window.closeAll=()=>{ document.querySelectorAll(".open").forEach(e=>e.classList.remove("open")); document.body.classList.remove("lock"); };
    window.openLegal=(t)=>{ $("legalModal").classList.add("open"); $("overlay").classList.add("open"); document.querySelectorAll(".legalBlock").forEach(b=>b.style.display=(b.dataset.legalBlock===t)?"block":"none"); };

    init();
    if("serviceWorker" in navigator) navigator.serviceWorker.register("/sw.js");
  </script>
</body>
</html>
