<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SCORE STORE | Official Merchandise</title>
  <meta name="description" content="Merch Oficial SCORE International. Equipamiento aut칠ntico fabricado en Tijuana por 칔NICO UNIFORMES." />
  
  <link rel="icon" href="/icons-score.svg" type="image/svg+xml" />
  <link rel="manifest" href="/site.webmanifest" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="preload" href="/assets/hero.webp" as="image">
  <link rel="preload" href="/assets/fondo-pagina-score.webp" as="image">
  
  <script src="https://js.stripe.com/v3" async defer></script>
</head>

<body>
  <div class="page-bg"></div>

  <header class="topbar">
    <div class="container topbarInner">
      <a href="/" class="brand" aria-label="Inicio">
        <img src="/assets/logo-score.webp" alt="SCORE International" width="160" height="46" loading="eager">
      </a>

      <nav class="navRight">
        <div class="navLinks desktop-only">
          <button onclick="scrollToId('drops')">DROPS</button>
          <button onclick="scrollToId('catalog')">CAT츼LOGO</button>
          <button onclick="scrollToId('shipping')">ENV칈OS</button>
        </div>

        <div class="location-pill">MX 췅 <b>TIJUANA</b></div>
        
        <button class="cartTrigger" onclick="openDrawer()" aria-label="Carrito">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-7-16L4 4 2 2M4 4h16l-2 10H6L4 4z"></path></svg>
          <span id="cartCount" class="cartCount" style="display:none">0</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="wrap">

    <section class="hero" id="top">
      <div class="heroBg"></div>
      <div class="heroOverlay"></div>
      
      <img class="heroSeal" src="/assets/logo-world-desert.webp" alt="World Desert" width="90" height="90">

      <div class="heroContent">
        <div class="tag-line">
          <span class="tag-badge">OFICIAL</span>
          <span>MERCHANDISE 2025</span>
        </div>
        
        <h1>SCORE<br><span>INTERNATIONAL</span></h1>
        
        <div class="marketing-copy">
          Equipamiento oficial de las carreras m치s exigentes del mundo.<br>
          <strong>칔NICO UNIFORMES:</strong> Patrocinador y Fabricante Oficial.
        </div>

        <div class="ctaRow">
          <button class="btn primary" onclick="scrollToId('catalog')">COMPRAR AHORA</button>
          <button class="btn secondary" onclick="scrollToId('drops')">VER DROPS</button>
        </div>
      </div>
    </section>

    <section class="section" id="drops">
      <div class="section-head">
        <h2>DROPS <span>LIMITADOS</span></h2>
        <p>Ediciones especiales y lanzamientos exclusivos.</p>
      </div>
      <div class="catalogGrid" id="dropsGrid"></div>
    </section>

    <section class="section" id="catalog">
      <div class="section-head">
        <h2>CAT츼LOGO <span>COMPLETO</span></h2>
        
        <div class="filters">
          <input class="inputField searchInput" id="search" placeholder="Buscar producto..." type="search"/>
          <select class="inputField select" id="filterCat">
            <option value="all">Todas las Categor칤as</option>
          </select>
        </div>
      </div>

      <div class="catalogGrid" id="catalogGrid"></div>
    </section>

    <section class="section partners" id="shipping">
      <div class="partners-content shipping-box">
        <div class="section-head" style="border:none; margin-bottom:20px;">
          <h2>COTIZAR <span>ENV칈O</span></h2>
        </div>
        <p style="color:#aaa; margin-bottom:20px;">Calcula el costo real de env칤o a tu domicilio con nuestra integraci칩n oficial de Envia.com.</p>
        
        <div class="ship-calculator">
          <input class="inputField" id="zipQuote" inputmode="numeric" maxlength="5" placeholder="C칩digo Postal (5 d칤gitos)" type="text" style="max-width:200px;">
          <button class="btn secondary" id="quoteBtn">COTIZAR</button>
        </div>
        <div id="shipResult" class="ship-result"></div>
      </div>
    </section>

    <section class="partners">
      <h3>OFFICIAL PARTNERS</h3>
      <div class="partnerGrid">
        <img src="/assets/logo-ford.webp" alt="Ford" loading="lazy">
        <img src="/assets/logo-rzr.webp" alt="Polaris" loading="lazy">
        <img src="/assets/logo-bfgodrich.webp" alt="BFGoodrich" loading="lazy">
        <img src="/assets/logo-unico.webp" alt="Unico Uniformes" style="height:55px; opacity:1; filter:none;">
      </div>
    </section>

  </main>

  <footer class="footer">
    <div class="footerCard">
      <div class="footerTop">
        
        <div class="footerCol">
          <div class="unico-brand">
            <img src="/assets/logo-unico.webp" alt="칔nico Uniformes" class="footerUnico">
          </div>
          <p class="footerDesc">
            Operador, Fabricante y Distribuidor Oficial de Merchandise SCORE International.
          </p>
        </div>

        <div class="footerCol">
          <h4>SOPORTE</h4>
          <div class="footerLinks">
            <button onclick="openLegal('shipping')">Rastreo de Env칤os</button>
            <button onclick="openLegal('returns')">Pol칤tica de Devoluci칩n</button>
            <button onclick="openLegal('billing')">Facturaci칩n 4.0</button>
          </div>
        </div>

        <div class="footerCol">
          <h4>LEGAL</h4>
          <div class="footerLinks">
            <button onclick="openLegal('terms')">T칠rminos del Servicio</button>
            <button onclick="openLegal('privacy')">Aviso de Privacidad</button>
          </div>
        </div>

        <div class="footerCol">
          <h4>CONTACTO</h4>
          <div class="addressBlock">
            <b>칔nico Uniformes</b>
            Palermo 6106 Interior JK,<br>
            Anexa Roma, 22614<br>
            Tijuana, B.C.
          </div>
          <div style="margin-top:15px; font-size:14px;">
            <a href="https://wa.me/526642368701" target="_blank" style="color:#00C853; text-decoration:none; font-weight:700;">
              WhatsApp: 664 236 8701
            </a>
            <a href="mailto:ventas.unicotextil@gmail.com" style="color:#aaa; display:block; margin-top:5px; text-decoration:none;">
              ventas.unicotextil@gmail.com
            </a>
          </div>
        </div>

      </div>
    </div>
    <div class="footerBottom">
      SCORE Store 춸 2025 췅 Powered by 칔nico Uniformes
    </div>
  </footer>

  <div id="overlay" class="overlay" onclick="closeAll()"></div>

  <aside id="drawer" class="drawer">
    <div class="dHead">
      <h3 class="dTitle">TU EQUIPO</h3>
      <button class="closeBtn" onclick="closeAll()">칑</button>
    </div>
    
    <div id="cartBody" class="dBody"></div>
    
    <div class="dFoot">
      <div style="display:flex; gap:10px; margin-bottom:15px;">
        <input id="promoInput" type="text" placeholder="C칍DIGO PROMO" class="inputField" style="margin:0; text-transform:uppercase;">
        <button id="promoApplyBtn" class="btn-sm-black">OK</button>
      </div>

      <div class="sumRow"><span>Subtotal</span><span id="lnSub">$0</span></div>
      <div class="sumRow" id="rowDiscount" style="display:none; color:var(--neon-green);"><span>Desc.</span><span id="lnDiscount">-$0</span></div>
      <div class="sumRow total"><span>TOTAL</span><span id="lnTotal">$0</span></div>
      
      <button id="payBtn" class="btn primary full" style="width:100%; margin-top:15px;" onclick="checkout()">
        PAGAR
      </button>
      <div style="text-align:center; font-size:11px; color:#888; margin-top:10px;">
        游 Pago seguro v칤a Stripe. Env칤os calculados al siguiente paso.
      </div>
    </div>
  </aside>

  <section id="legalModal" class="modal" style="height:auto; min-height:400px;">
    <div class="dHead"><h3 class="dTitle">INFORMACI칍N</h3><button class="closeBtn" onclick="closeLegal()">칑</button></div>
    <div class="dBody">
      <div class="legalBlock" data-legal-block="shipping" style="display:none">
        <h4 style="color:var(--score-red);">Env칤os y Entregas</h4>
        <p>Env칤os nacionales v칤a FedEx o Estafeta (3-7 d칤as). Pickup gratuito en nuestras oficinas de Tijuana.</p>
      </div>
      <div class="legalBlock" data-legal-block="returns" style="display:none">
        <h4 style="color:var(--score-red);">Garant칤as</h4>
        <p>7 d칤as naturales por defectos de fabricaci칩n. Productos de liquidaci칩n son venta final.</p>
      </div>
      </div>
  </section>

  <div id="toast" class="toast">Notificaci칩n</div>

  <script>
    const DEBUG = (location.hostname === 'localhost');
    const API_BASE = (location.hostname.includes("netlify")) ? "/.netlify/functions" : "/api";
    const CART_KEY = "score_cart_v3";
    
    // Estado
    let cart = JSON.parse(localStorage.getItem(CART_KEY) || "[]");
    let catalog = [];
    let promoState = null;

    // Helpers
    const $ = (id) => document.getElementById(id);
    const money = (n) => new Intl.NumberFormat("es-MX", { style: "currency", currency: "MXN" }).format(n||0);
    function scrollToId(id){ const el=$(id); if(el) el.scrollIntoView({behavior:"smooth", block:"start"}); }

    function toast(msg) {
      const t = $("toast"); t.textContent = msg; t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 3000);
    }

    /* --- CATALOGO LOGIC --- */
    async function init() {
      renderCart();
      try {
        // Carga de cat치logo real
        const res = await fetch("/data/catalog.json");
        const data = await res.json();
        catalog = data.products || [];
        
        buildFilters();
        renderCatalog(); // Render inicial
        renderDrops();   // Render secci칩n drops
      } catch(e) {
        console.error("Error loading catalog", e);
      }
    }

    function buildFilters() {
      const cats = new Set();
      catalog.forEach(p => { if(p.category) cats.add(p.category); });
      const sel = $("filterCat");
      cats.forEach(c => {
        const o = document.createElement("option"); o.value = c; o.text = c;
        sel.appendChild(o);
      });
      // Listeners
      $("search").addEventListener("input", renderCatalog);
      $("filterCat").addEventListener("change", renderCatalog);
    }

    function renderCatalog() {
      const grid = $("catalogGrid");
      grid.innerHTML = "";
      
      const q = $("search").value.toLowerCase();
      const cat = $("filterCat").value;

      const filtered = catalog.filter(p => {
        if(q && !p.name.toLowerCase().includes(q)) return false;
        if(cat !== "all" && p.category !== cat) return false;
        return true;
      });

      if(!filtered.length) { grid.innerHTML = "<div style='grid-column:1/-1; text-align:center; padding:40px; color:#aaa;'>No se encontraron productos.</div>"; return; }

      // Generaci칩n de Tarjetas "Gold Ops"
      grid.innerHTML = filtered.map(p => createCardHTML(p)).join("");
    }

    function renderDrops() {
      const dropsGrid = $("dropsGrid");
      // Filtramos productos marcados como "featured" o "limited" en el JSON
      const drops = catalog.filter(p => p.tags && (p.tags.includes("limited") || p.tags.includes("drop"))).slice(0, 4);
      
      if(!drops.length) { 
        // Fallback: Mostrar los primeros 4 si no hay drops definidos
        dropsGrid.innerHTML = catalog.slice(0,4).map(p => createCardHTML(p)).join("");
        return;
      }
      dropsGrid.innerHTML = drops.map(p => createCardHTML(p)).join("");
    }

    function createCardHTML(p) {
      // Pill Buttons para tallas
      const sizes = p.sizes || ["Unitalla"];
      const sizeBtns = sizes.map(s => `<button class="size-pill" onclick="selectSize(this, '${s}')">${s}</button>`).join("");

      return `
        <div class="champItem prodCard" id="card_${p.id}">
          <div class="card-bg-texture"></div>
          <div class="card-content-wrap">
            <div class="tags-container">
               ${p.tags?.includes('new') ? '<span class="badge new">NUEVO</span>' : ''}
               ${p.tags?.includes('limited') ? '<span class="badge limit">EDICI칍N LIMITADA</span>' : ''}
            </div>
            
            <img src="${p.img}" alt="${p.name}" class="prod-img" loading="lazy">
            
            <div class="prod-info">
              <div class="prod-name">${p.name}</div>
              <div class="prod-price">${money(p.baseMXN)}</div>
              
              <div class="size-selector-row" id="sizes_${p.id}" data-selected="">
                ${sizeBtns}
              </div>
              
              <button class="btn primary full btn-add" onclick="addToCart('${p.id}')">
                AGREGAR +
              </button>
            </div>
          </div>
        </div>
      `;
    }

    /* --- UI INTERACTION --- */
    window.selectSize = (btn, size) => {
      // Deseleccionar hermanos
      const parent = btn.parentElement;
      parent.setAttribute("data-selected", size);
      parent.querySelectorAll(".size-pill").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    };

    window.addToCart = (id) => {
      const sizeContainer = $(`sizes_${id}`);
      let s = sizeContainer.getAttribute("data-selected");
      
      // Auto-select si es Unitalla
      if(!s && sizeContainer.children.length === 1) { s = sizeContainer.children[0].innerText; }
      
      if(!s) { toast("丘멆잺 Por favor selecciona una talla"); return; }

      const p = catalog.find(x => x.id === id);
      const key = `${id}_${s}`;
      const exist = cart.find(i => i.key === key);
      
      if(exist) exist.qty++;
      else cart.push({ key, id, name:p.name, price:p.baseMXN, img:p.img, size:s, qty:1 });
      
      saveCart();
      renderCart();
      openDrawer();
      toast("Producto agregado");
    };

    /* --- CART & SHIPPING --- */
    function saveCart() { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    
    function renderCart() {
      const body = $("cartBody");
      const countEl = $("cartCount");
      
      // Update count
      const count = cart.reduce((a,b) => a+b.qty, 0);
      if(countEl) { countEl.innerText = count; countEl.style.display = count > 0 ? "flex" : "none"; }

      if(!cart.length) {
        body.innerHTML = "<div style='text-align:center; padding:40px; color:#aaa;'>Tu carrito est치 vac칤o.</div>";
        $("payBtn").disabled = true;
        updateTotals(0);
        return;
      }

      body.innerHTML = cart.map((i, idx) => `
        <div class="cartItem">
          <img src="${i.img}" class="cartThumb">
          <div style="flex:1;">
            <div style="font-weight:700; font-size:14px; margin-bottom:4px;">${i.name}</div>
            <div style="font-size:11px; background:#f0f0f0; padding:2px 6px; border-radius:4px; display:inline-block;">${i.size}</div>
            <div style="color:var(--score-red); font-weight:700; margin-top:4px;">${money(i.price)}</div>
          </div>
          <div style="text-align:right;">
            <button onclick="removeFromCart(${idx})" class="iconBtn" style="color:#aaa;">&times;</button>
            <div style="font-weight:700; font-size:13px; margin-top:5px;">x${i.qty}</div>
          </div>
        </div>
      `).join("");
      
      updateTotals();
      $("payBtn").disabled = false;
    }

    window.removeFromCart = (idx) => { cart.splice(idx, 1); saveCart(); renderCart(); };

    function updateTotals() {
      const sub = cart.reduce((a,b) => a + (b.price*b.qty), 0);
      let disc = 0;
      if(promoState?.type === "pct") disc = Math.round(sub * (promoState.value/100));
      
      const total = Math.max(0, sub - disc);
      
      $("lnSub").innerText = money(sub);
      $("lnTotal").innerText = money(total);
      
      if(disc > 0) {
        $("rowDiscount").style.display = "flex";
        $("lnDiscount").innerText = `- ${money(disc)}`;
      } else {
        $("rowDiscount").style.display = "none";
      }
    }

    /* --- QUOTE SHIPPING (ON PAGE) --- */
    $("quoteBtn")?.addEventListener("click", async () => {
      const zip = $("zipQuote").value;
      const resDiv = $("shipResult");
      
      if(zip.length !== 5) { toast("C칩digo postal inv치lido"); return; }
      
      resDiv.innerHTML = "Calculando...";
      
      try {
        const res = await fetch(`${API_BASE}/quote_shipping`, {
          method: "POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ postal_code: zip, items: 1 })
        });
        const data = await res.json();
        
        if(data.ok) {
          resDiv.innerHTML = `<div style="color:var(--neon-green); font-weight:700; margin-top:10px;">${data.label}: ${money(data.mxn)}</div>`;
        } else {
          resDiv.innerHTML = `<div style="color:var(--score-red); margin-top:10px;">Env칤o Nacional: $250.00 MXN</div>`;
        }
      } catch(e) {
        resDiv.innerHTML = "Error al cotizar.";
      }
    });

    /* --- CHECKOUT --- */
    window.checkout = async () => {
      const btn = $("payBtn");
      btn.innerText = "PROCESANDO..."; btn.disabled = true;
      
      // Obtenemos info del formulario del drawer (opcional)
      const shipMode = document.querySelector('input[name="shipMode"]:checked')?.value || "mx";
      
      try {
        const res = await fetch(`${API_BASE}/create_checkout`, {
          method: "POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ 
            items: cart, 
            mode: "mx", // Por defecto enviamos a MX para que Stripe pida direcci칩n
            promoCode: promoState?.code
          })
        });
        const d = await res.json();
        if(d.url) location.href = d.url; else throw new Error("Error iniciando pago");
      } catch(e) {
        alert("Error de conexi칩n");
        btn.innerText = "PAGAR"; btn.disabled = false;
      }
    };

    /* --- NAVIGATION --- */
    window.openDrawer = () => { $("drawer").classList.add("open"); $("overlay").classList.add("open"); document.body.classList.add("modalOpen"); };
    window.closeAll = () => { 
      document.querySelectorAll(".open").forEach(e => e.classList.remove("open")); 
      document.body.classList.remove("modalOpen");
    };
    
    window.openLegal = (type) => {
      $("legalModal").classList.add("open"); $("overlay").classList.add("open");
      document.querySelectorAll(".legalBlock").forEach(b => b.style.display = (b.dataset.legalBlock === type) ? "block" : "none");
    };
    window.closeLegal = closeAll;

    // Start
    init();
    if ("serviceWorker" in navigator) navigator.serviceWorker.register("/sw.js");
  </script>
</body>
</html>
