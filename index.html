<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#E10600" />
  <title>SCORE | Official Baja Gear</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@500;600;700&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root{
      --red: #E10600;
      --carbon: #1a1a1a;
      --charcoal: #262626;
      --sand: #f0f0f0;
      --brown-glass: rgba(60, 45, 35, 0.90);
      --fontTitle: "Teko", sans-serif;
      --fontBody: "Inter", sans-serif;
      --bgTexture: url("assets/baja1000-texture.png"); 
    }
    *{box-sizing:border-box} body{margin:0;font-family:var(--fontBody);background:var(--sand);padding-bottom:90px;}
    
    .topbar{position:fixed;top:0;left:0;right:0;z-index:90;background:rgba(245,245,245,0.96);border-bottom:3px solid var(--red);}
    .topInner{width:min(1200px,94vw);margin:0 auto;height:75px;display:flex;align-items:center;justify-content:space-between;}
    .brandLogo img{height:55px;}
    .cartTrigger{background:var(--carbon);color:#fff;border:none;height:46px;padding:0 18px;display:flex;align-items:center;gap:10px;font-family:var(--fontTitle);font-size:22px;clip-path:polygon(10% 0,100% 0,100% 100%,0% 100%);cursor:pointer;}
    
    .hero{margin-top:90px;position:relative;min-height:540px;display:flex;align-items:center;background:var(--carbon);color:#fff;overflow:hidden;}
    .heroBg{position:absolute;inset:0;background:url('assets/hero.png') center/cover;opacity:.95;}
    .heroOverlay{position:absolute;inset:0;background:linear-gradient(to right,rgba(0,0,0,0.85),transparent);}
    .heroContent{position:relative;z-index:2;padding:40px;max-width:650px;margin:0 auto;width:min(1200px,94vw);}
    .heroTitle{font-family:var(--fontTitle);font-size:85px;line-height:0.85;margin:0 0 20px;}
    .heroTitle span{color:var(--red);}
    .btnHero{background:#fff;color:var(--carbon);padding:14px 35px;font-family:var(--fontTitle);font-size:26px;border:none;cursor:pointer;clip-path:polygon(0 0,100% 0,95% 100%,0% 100%);}

    .gridDrops{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;max-width:1200px;margin:40px auto;padding:0 20px;}
    .cardDrop{position:relative;height:300px;border-radius:10px;overflow:hidden;cursor:pointer;background:var(--charcoal);}
    .dropBg{position:absolute;inset:0;background:var(--bgTexture) center/cover;filter:brightness(0.6);}
    .dropGlass{position:absolute;inset:15px;background:var(--brown-glass);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.15);border-radius:8px;padding:25px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;}
    
    /* LOGOS SÓLIDOS */
    .dropLogo{height:90px;object-fit:contain;filter:drop-shadow(0 2px 0 #fff) drop-shadow(0 -2px 0 #fff) drop-shadow(2px 0 0 #fff) drop-shadow(-2px 0 0 #fff);}
    
    .btnDrop{background:transparent;color:#fff;border:2px solid #fff;padding:10px 24px;font-weight:800;cursor:pointer;}
    .btnDrop:hover{background:#fff;color:#000;}

    footer{background:var(--charcoal);color:#ccc;padding:60px 20px;border-top:4px solid var(--red);margin-top:60px;}
    .paybar{position:fixed;bottom:0;left:0;right:0;z-index:150;background:#fff;padding:15px 20px;border-top:1px solid #ddd;display:flex;justify-content:space-between;align-items:center;}
    
    /* MODAL */
    .prodModal{position:fixed;inset:0;z-index:200;background:#fff;transform:translateY(100%);transition:0.3s;display:flex;flex-direction:column;}
    .prodModal.active{transform:translateY(0);}
    .pmHead{background:var(--carbon);color:#fff;padding:15px;display:flex;justify-content:space-between;}
    .pmGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:20px;padding:20px;overflow-y:auto;}
    .pCard{background:#fff;border:1px solid #eee;border-radius:8px;overflow:hidden;}
    .pImg{height:220px;background:#eee;} .pImg img{width:100%;height:100%;object-fit:cover;}
    .pInfo{padding:10px;text-align:center;}
    .pBtn{width:100%;background:var(--carbon);color:#fff;padding:10px;border:none;cursor:pointer;margin-top:10px;}

    .drawer{position:fixed;right:0;top:0;bottom:0;width:90vw;max-width:400px;background:#fff;z-index:200;transform:translateX(100%);transition:0.3s;display:flex;flex-direction:column;}
    .drawer.active{transform:translateX(0);}
  </style>
</head>
<body>

<header class="topbar">
  <div class="topInner">
    <div class="brandLogo"><img src="assets/logo-score.png" alt="SCORE"></div>
    <button class="cartTrigger" onclick="toggleCart()">
      CARRITO (<span id="cartCount">0</span>)
    </button>
  </div>
</header>

<div class="hero">
  <div class="heroBg"></div>
  <div class="heroOverlay"></div>
  <div class="heroContent">
    <h1 class="heroTitle">LEYENDAS<br><span>DEL DESIERTO</span></h1>
    <button class="btnHero" onclick="openProductModal()">VER DROPS</button>
  </div>
</div>

<div class="gridDrops">
  <div class="cardDrop" onclick="openProductModal()">
    <div class="dropBg"></div>
    <div class="dropGlass">
      <img src="assets/logo-baja1000.png" class="dropLogo" alt="Baja 1000">
      <div style="text-align:center;color:#fff">
        <h3 style="font-family:var(--fontTitle);font-size:34px;margin:0">BAJA 1000</h3>
        <p style="margin:5px 0">EDICIÓN 2025</p>
      </div>
      <button class="btnDrop">VER PRODUCTOS</button>
    </div>
  </div>
</div>

<footer>
  <div style="max-width:1200px;margin:0 auto;">
    <h4 style="color:#fff;font-family:var(--fontTitle);font-size:26px">SCORE INTERNATIONAL</h4>
    <p>Operado por Unico Textil.<br>ventas.unicotextil@gmail.com</p>
  </div>
</footer>

<div class="paybar">
  <div style="font-family:var(--fontTitle);font-size:32px" id="pbTotal">$0.00</div>
  <button onclick="toggleCart()" style="background:var(--red);color:#fff;border:none;padding:10px 30px;font-weight:bold;cursor:pointer">VER CARRITO</button>
</div>

<div class="prodModal" id="prodModal">
  <div class="pmHead">
    <span style="font-family:var(--fontTitle);font-size:28px">COLECCIÓN 2025</span>
    <button onclick="closeProductModal()" style="background:none;border:none;color:#fff;font-size:30px">&times;</button>
  </div>
  <div class="pmGrid" id="catalogGrid"></div>
</div>

<div class="drawer" id="cartDrawer">
  <div style="padding:20px;background:var(--carbon);color:#fff;display:flex;justify-content:space-between">
    <span>TU EQUIPO</span>
    <button onclick="toggleCart()" style="color:#fff;background:none;border:none;font-size:24px">&times;</button>
  </div>
  <div style="flex:1;padding:20px;overflow-y:auto" id="cartBody"></div>
  <div style="padding:20px;border-top:1px solid #ddd">
    <button onclick="goCheckout()" style="width:100%;background:var(--carbon);color:#fff;padding:15px;border:none;font-weight:bold">IR A PAGAR</button>
  </div>
</div>

<script>
  let cart = JSON.parse(localStorage.getItem('score_cart')) || [];
  let CATALOG = [];

  async function loadCatalog() {
    try {
      const res = await fetch('data/catalog.json');
      const data = await res.json();
      CATALOG = data.products;
      renderCatalog();
    } catch(e) { console.error(e); }
  }

  function renderCatalog(){
    const grid = document.getElementById('catalogGrid');
    const items = CATALOG.filter(p => p.sectionId === 'EDICION_2025');
    grid.innerHTML = items.map(p => `
      <div class="pCard">
        <div class="pImg"><img src="${p.img}" alt="${p.name}"></div>
        <div class="pInfo">
          <div style="font-weight:bold;font-size:13px">${p.name}</div>
          <div style="color:var(--red);font-weight:bold;font-size:18px">$${Math.round(p.baseMXN * 1.2)}</div>
          <button class="pBtn" onclick="add('${p.id}')">AGREGAR</button>
        </div>
      </div>
    `).join('');
  }

  function add(id){
    const p = CATALOG.find(x => x.id === id);
    const exist = cart.find(x => x.id === id);
    if(exist) exist.qty++; else cart.push({ ...p, qty: 1 });
    updateCart();
    alert("Agregado");
  }

  function updateCart(){
    localStorage.setItem('score_cart', JSON.stringify(cart));
    const total = cart.reduce((a,b) => a + (Math.round(b.baseMXN * 1.2) * b.qty), 0);
    const count = cart.reduce((a,b) => a + b.qty, 0);
    
    document.getElementById('cartCount').innerText = count;
    document.getElementById('pbTotal').innerText = "$" + total.toLocaleString();
    
    const body = document.getElementById('cartBody');
    body.innerHTML = cart.length ? cart.map((i,idx) => `
      <div style="display:flex;gap:10px;margin-bottom:10px">
        <img src="${i.img}" style="width:60px;height:60px;object-fit:cover">
        <div>
          <div style="font-size:12px;font-weight:bold">${i.name}</div>
          <div>$${Math.round(i.baseMXN * 1.2)} x ${i.qty}</div>
        </div>
        <button onclick="rem(${idx})" style="margin-left:auto;border:none;background:none;color:red">X</button>
      </div>
    `).join('') : '<div style="text-align:center;margin-top:20px">Vacío</div>';
  }

  function rem(idx){ cart.splice(idx,1); updateCart(); }
  function toggleCart(){ document.getElementById('cartDrawer').classList.toggle('active'); }
  function openProductModal(){ document.getElementById('prodModal').classList.add('active'); }
  function closeProductModal(){ document.getElementById('prodModal').classList.remove('active'); }

  async function goCheckout(){
    if(!cart.length) return;
    try {
      const stripe = Stripe('pk_live_51Se6fsGUCnsKfgrBl99sVAcl');
      const res = await fetch('/.netlify/functions/create_checkout', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ items: cart.map(i => ({ id: i.id, qty: i.qty, size: 'Única' })) })
      });
      const data = await res.json();
      if(data.url) window.location.href = data.url;
      else alert("Error: " + (data.error || "Desconocido"));
    } catch(e){ alert("Error de conexión"); }
  }

  loadCatalog();
  updateCart();
</script>
</body>
</html>
