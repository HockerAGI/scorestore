<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SCORE STORE | Official Merchandise</title>
  <meta name="description" content="Merchandise Oficial SCORE International. Fabricado por √öNICO UNIFORMES." />

  <link rel="icon" href="/icons-score.svg" type="image/svg+xml" />
  <link rel="manifest" href="/site.webmanifest" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/styles.css">
  <link rel="preload" href="/assets/hero.webp" as="image">
  <script src="https://js.stripe.com/v3" async defer></script>
</head>

<body>
  <header class="topbar">
    <div class="container topbarInner">
      <a href="/" class="brand">
        <img src="/assets/logo-score.webp" alt="SCORE International" class="brandLogo">
      </a>
      
      <nav class="nav">
        <a href="#drops" class="navLink" style="font-size:18px;">Drops</a>
        <a href="#catalog" class="navLink" style="font-size:18px;">Cat√°logo</a>
        
        <button class="cartBtn" onclick="openDrawer()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
          <span id="cartCount">0</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    
    <section class="hero" id="top">
      <div class="heroBg"></div>
      
      <div class="heroContent">
        <div class="heroTag">OFFICIAL MERCHANDISE</div>
        <h1>SCORE<br><span style="color:var(--red)">INTERNATIONAL</span></h1>
        
        <p class="heroSub">
          Colecci√≥n oficial 2025. Dise√±ada para resistir la Baja.<br>
          <strong>√öNICO UNIFORMES:</strong> Patrocinador y Fabricante Oficial.
        </p>

        <div class="ctaGroup">
          <button class="btn primary" onclick="scrollToId('catalog')">COMPRAR AHORA</button>
          <button class="btn glass" onclick="scrollToId('drops')">VER DROPS</button>
        </div>
      </div>
    </section>

    <section class="section" id="drops">
      <div class="container">
        <div class="sectionHead">
          <h2>DROPS <span>LIMITADOS</span></h2>
          <div class="subHead">Ediciones especiales y lanzamientos exclusivos.</div>
        </div>
        <div class="grid" id="dropsGrid"></div>
      </div>
    </section>

    <section class="section" id="catalog">
      <div class="container">
        <div class="sectionHead">
          <h2>CAT√ÅLOGO <span>2025</span></h2>
          <div class="subHead">Ropa y accesorios oficiales de la temporada.</div>
        </div>

        <div class="filters">
          <input class="search" id="search" placeholder="Buscar producto..." type="search"/>
          <select class="select" id="filterCat">
            <option value="all">Todas las Categor√≠as</option>
          </select>
        </div>

        <div class="grid" id="catalogGrid"></div>
      </div>
    </section>

    <section class="section" style="background:#fff; border-top:1px solid #eee; border-bottom:1px solid #eee;">
      <div class="container" style="text-align:center;">
        <div class="sectionHead" style="border:none; margin-bottom:20px;">
          <h2>COTIZA TU <span>ENV√çO</span></h2>
          <p style="margin:0 auto;">Calcula el costo exacto a tu c√≥digo postal con nuestra integraci√≥n en tiempo real.</p>
        </div>
        
        <div style="max-width:500px; margin:0 auto; display:flex; gap:10px;">
          <input id="zipQuote" class="search" placeholder="C√≥digo Postal (5 d√≠gitos)" maxlength="5" style="width:100%;">
          <button class="btn primary" id="quoteBtn" style="font-size:18px; padding:10px 20px;">CALCULAR</button>
        </div>
        <div id="shipResult" style="margin-top:20px; font-weight:700; color:var(--red);"></div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="partnersGrid">
          <img src="/assets/logo-ford.webp" class="pLogo" alt="Ford">
          <img src="/assets/logo-rzr.webp" class="pLogo" alt="Polaris">
          <img src="/assets/logo-bfgodrich.webp" class="pLogo" alt="BFGoodrich">
          <img src="/assets/logo-unico.webp" class="pLogo" alt="Unico" style="opacity:1; filter:none; height:50px;">
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">
    <div class="container footerInner">
      
      <div class="fCol">
        <img src="/assets/logo-unico.webp" alt="√önico" class="footerLogo">
        <p class="footerText">
          Operador, Fabricante y Distribuidor Oficial de Merchandise SCORE International.<br>
          Calidad probada en el desierto.
        </p>
      </div>

      <div class="fCol">
        <div class="colTitle">SOPORTE</div>
        <a href="#" onclick="openLegal('shipping');return false;" class="footerLink">Rastreo de Env√≠os</a>
        <a href="#" onclick="openLegal('returns');return false;" class="footerLink">Devoluciones</a>
        <a href="#" onclick="openLegal('billing');return false;" class="footerLink">Facturaci√≥n</a>
      </div>

      <div class="fCol">
        <div class="colTitle">LEGAL</div>
        <a href="#" onclick="openLegal('terms');return false;" class="footerLink">T√©rminos y Condiciones</a>
        <a href="#" onclick="openLegal('privacy');return false;" class="footerLink">Aviso de Privacidad</a>
      </div>

      <div class="fCol">
        <div class="colTitle">CONTACTO</div>
        <div class="contactBox">
          <strong>√öNICO UNIFORMES</strong>
          <p>Palermo 6106 Interior JK,<br>Anexa Roma, 22614<br>Tijuana, B.C.</p>
          <a href="https://wa.me/526642368701" target="_blank" style="color:#00E676; text-decoration:none; font-weight:700; display:flex; align-items:center; gap:5px; font-size:14px;">
            üì± WhatsApp: 664 236 8701
          </a>
        </div>
      </div>

    </div>
    <div class="copy">SCORE Store ¬© 2025 ¬∑ Powered by √önico Uniformes</div>
  </footer>

  <div class="overlay" id="overlay" onclick="closeAll()"></div>

  <aside class="drawer" id="drawer">
    <div class="dHead">
      <h3 class="dTitle">TU CARRITO</h3>
      <button class="dClose" onclick="closeAll()">‚úï</button>
    </div>
    <div class="dBody">
      <div id="cartItems"></div>
      <div id="cartEmpty" style="text-align:center; padding:40px; color:#999;">Tu carrito est√° vac√≠o.</div>
    </div>
    <div class="dFoot">
      <div class="totalsRow"><span>Subtotal</span><strong id="subTotal">$0</strong></div>
      <div class="totalsRow"><span>Env√≠o</span><strong id="shipTotal">‚Äî</strong></div>
      <div class="totalsRow big"><span>TOTAL</span><strong id="grandTotal">$0</strong></div>
      
      <button class="btn primary" style="width:100%; margin-top:20px;" id="checkoutBtn" onclick="checkout()">PAGAR AHORA</button>
    </div>
  </aside>

  <aside class="drawer" id="legalModal" style="width:min(600px,100vw);">
    <div class="dHead"><h3 class="dTitle">INFORMACI√ìN</h3><button class="dClose" onclick="closeAll()">‚úï</button></div>
    <div class="dBody" style="padding:40px;">
       <div class="legalBlock" data-legal-block="shipping" style="display:none">
         <h4 style="color:var(--red);margin-bottom:10px;font-size:24px;font-family:var(--font-display);">Env√≠os</h4>
         <p style="color:#555;line-height:1.6;">Env√≠os a todo M√©xico (3-7 d√≠as h√°biles). Pickup gratuito en nuestras oficinas de Tijuana.</p>
       </div>
       </div>
  </aside>

  <div id="toast" class="toast">Mensaje</div>

  <script>
    const API_BASE = (location.hostname.includes('netlify')) ? '/.netlify/functions' : '/api';
    const CART_KEY = "score_cart_platinum";
    
    let cart = [], catalog = [], shipQuote = null;
    const $ = (id) => document.getElementById(id);
    const money = (n) => new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(n||0);
    function scrollToId(id){ const el=$(id); if(el) el.scrollIntoView({behavior:"smooth",block:"start"}); }
    function toast(msg){ const t=$("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),2500); }

    /* CORE LOGIC */
    async function init(){
        loadCart(); updateTotals(); renderCart();
        try {
            const res = await fetch("/data/catalog.json");
            const data = await res.json();
            catalog = data.products || [];
            
            // Populate Filters
            const cats = new Set();
            catalog.forEach(p => { if(p.category) cats.add(p.category); });
            const sel = $("filterCat");
            cats.forEach(c => { const o=document.createElement("option"); o.value=c; o.text=c; sel.appendChild(o); });

            renderCatalog(); renderDrops();
        } catch(e){ console.error(e); }
        
        $("search").addEventListener("input", renderCatalog);
        $("filterCat").addEventListener("change", renderCatalog);
    }

    function renderCatalog(){
        const grid = $("catalogGrid"); grid.innerHTML = "";
        const q = $("search").value.toLowerCase();
        const cat = $("filterCat").value;
        const filtered = catalog.filter(p => {
            if(q && !p.name.toLowerCase().includes(q)) return false;
            if(cat!=="all" && p.category!==cat) return false;
            return true;
        });
        if(!filtered.length) { grid.innerHTML="<div style='text-align:center;width:100%;color:#999;grid-column:1/-1;padding:40px;'>Sin resultados.</div>"; return; }
        filtered.forEach(p => grid.appendChild(createCard(p)));
    }

    function renderDrops(){
        const grid = $("dropsGrid");
        const drops = catalog.filter(p => p.tags && (p.tags.includes('limited') || p.tags.includes('drop')));
        if(!drops.length) return;
        drops.forEach(p => {
            const card = createCard(p);
            // Agregar badge
            const badge = document.createElement("div");
            badge.className = "dropBadge"; badge.innerText = "LIMITED DROP";
            card.querySelector(".cardImg").appendChild(badge);
            grid.appendChild(card);
        });
    }

    function createCard(p){
        const el = document.createElement("div"); el.className = "card";
        const sizes = p.sizes || ["Unitalla"];
        const sizeBtns = sizes.map(s => `<div class="sizePill" onclick="selectSize(this,'${s}')">${s}</div>`).join("");
        
        el.innerHTML = `
            <div class="cardImg"><img src="${p.img}" loading="lazy" alt="${p.name}"></div>
            <div class="cardBody">
                <div class="cardTitle">${p.name}</div>
                <div class="cardPrice">${money(p.baseMXN)}</div>
                <div class="sizeRow" id="sizes_${p.id}" data-selected="">${sizeBtns}</div>
                <button class="cardBtn" onclick="add('${p.id}')">AGREGAR</button>
            </div>
        `;
        return el;
    }

    /* ACTIONS */
    window.selectSize = (el, s) => {
        const p = el.parentElement;
        p.setAttribute("data-selected", s);
        p.querySelectorAll(".sizePill").forEach(b => b.classList.remove("active"));
        el.classList.add("active");
    };

    window.add = (id) => {
        const sizeCont = document.getElementById(`sizes_${id}`);
        let s = sizeCont.getAttribute("data-selected");
        if(!s && sizeCont.children.length===1) s = sizeCont.children[0].innerText; // Auto-select single size
        
        if(!s) { toast("‚ö†Ô∏è Selecciona talla"); return; }
        
        const p = catalog.find(x=>x.id===id);
        const key = `${id}_${s}`;
        const exist = cart.find(i=>i.key===key);
        if(exist) exist.qty++; else cart.push({key, id, name:p.name, variant:`Talla: ${s}`, price:p.baseMXN, qty:1, img:p.img});
        
        saveCart(); renderCart(); openDrawer(); toast("Agregado");
    };

    function loadCart(){ try{cart=JSON.parse(localStorage.getItem(CART_KEY)||"[]")}catch{cart=[]} }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    
    function renderCart(){
        const wrap = $("cartItems");
        const count = cart.reduce((a,b)=>a+b.qty,0);
        $("cartCount").innerText = count;
        
        if(!cart.length){ wrap.innerHTML=""; $("cartEmpty").style.display="block"; updateTotals(); return; }
        $("cartEmpty").style.display="none";
        
        wrap.innerHTML = cart.map((i,x) => `
            <div class="cartItem">
                <img src="${i.img}" class="cartThumb">
                <div style="flex:1;">
                    <div style="font-weight:700;font-size:14px;margin-bottom:5px;">${i.name}</div>
                    <div style="font-size:12px;color:#888;">${i.variant}</div>
                    <div style="color:var(--red);font-weight:700;margin-top:5px;">${money(i.price)}</div>
                </div>
                <div style="text-align:right;">
                    <button onclick="delCart(${x})" style="border:none;background:none;color:#999;cursor:pointer;font-size:18px;">&times;</button>
                    <div style="margin-top:10px;font-weight:700;font-size:13px;">x${i.qty}</div>
                </div>
            </div>
        `).join("");
        updateTotals();
    }
    window.delCart = (x)=>{ cart.splice(x,1); saveCart(); renderCart(); };

    function updateTotals(){
        const sub = cart.reduce((a,b)=>a+(b.price*b.qty),0);
        $("subTotal").innerText = money(sub);
        const ship = shipQuote ? shipQuote.mxn : 0;
        $("shipTotal").innerText = shipQuote ? money(ship) : "Por calcular";
        $("grandTotal").innerText = money(sub + ship);
    }

    /* QUOTE & CHECKOUT */
    $("quoteBtn").addEventListener("click", async ()=>{
        const zip = $("zipQuote").value;
        if(zip.length!==5) { toast("CP Inv√°lido"); return; }
        $("shipResult").innerText = "Calculando...";
        
        try {
            const r = await fetch(`${API_BASE}/quote_shipping`, {method:"POST", body:JSON.stringify({postal_code:zip, items:1})});
            const d = await r.json();
            if(d.ok) { shipQuote=d; $("shipResult").innerHTML=`${d.label}: ${money(d.mxn)}`; updateTotals(); }
            else { $("shipResult").innerText="Tarifa est√°ndar: $250"; shipQuote={mxn:250}; updateTotals(); }
        } catch(e) { $("shipResult").innerText="Error conexi√≥n"; }
    });

    window.checkout = async () => {
        if(!cart.length) return;
        const btn = $("checkoutBtn"); btn.disabled=true; btn.innerText="PROCESANDO...";
        try {
            const r = await fetch(`${API_BASE}/create_checkout`, {method:"POST", body:JSON.stringify({items:cart, mode:"mx"})});
            const d = await r.json();
            if(d.url) location.href=d.url; else throw new Error();
        } catch(e) { toast("Error checkout"); btn.disabled=false; btn.innerText="PAGAR AHORA"; }
    };

    window.openDrawer=()=>{ $("drawer").classList.add("open"); $("overlay").classList.add("open"); document.body.classList.add("lock"); };
    window.closeAll=()=>{ document.querySelectorAll(".open").forEach(e=>e.classList.remove("open")); document.body.classList.remove("lock"); };
    window.openLegal=(t)=>{ $("legalModal").classList.add("open"); $("overlay").classList.add("open"); document.querySelectorAll(".legalBlock").forEach(b=>b.style.display=(b.dataset.legalBlock===t)?"block":"none"); };

    init();
    if("serviceWorker" in navigator) navigator.serviceWorker.register("/sw.js");
  </script>
</body>
</html>
